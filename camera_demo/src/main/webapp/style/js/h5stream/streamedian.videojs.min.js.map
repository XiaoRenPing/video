{"version":3,"file":"streamedian.videojs.min.js","sources":["../node_modules/bp_logger/logger.js","../src/deps/bp_logger.js","../src/core/util/url.js","../node_modules/bp_event/event.js","../src/deps/bp_event.js","../src/core/iso-bmff/mp4-generator.js","../src/core/presentation/mse.js","../src/core/remuxer/base.js","../src/core/remuxer/aac.js","../src/core/util/exp-golomb.js","../src/core/util/binary.js","../src/core/elementary/NALU.js","../src/core/parsers/h264.js","../src/core/remuxer/h264.js","../src/core/defs.js","../src/core/remuxer/remuxer.js","../node_modules/bp_statemachine/statemachine.js","../src/deps/bp_statemachine.js","../src/core/parsers/sdp.js","../src/client/rtsp/stream.js","../src/core/util/md5.js","../src/client/rtsp/rtp/rtp.js","../src/client/rtsp/rtp/factory.js","../src/client/rtsp/message.js","../src/core/elementary/NALUAsm.js","../src/core/elementary/AACFrame.js","../src/core/elementary/AACAsm.js","../src/client/rtsp/rtp/payload/parser.js","../src/core/base_client.js","../src/core/parsers/aac.js","../src/client/rtsp/session.js","../src/client/rtsp/client.js","../node_modules/jsencrypt/lib/asn1js/asn1.js","../node_modules/jsencrypt/lib/jsbn/prng4.js","../node_modules/jsencrypt/lib/jsbn/rng.js","../node_modules/jsencrypt/lib/jsbn/jsbn.js","../node_modules/jsencrypt/lib/jsbn/jsbn2.js","../node_modules/jsencrypt/lib/jsbn/rsa.js","../node_modules/jsencrypt/lib/jsbn/rsa2.js","../node_modules/jsencrypt/lib/asn1js/base64.js","../node_modules/jsencrypt/lib/asn1js/hex.js","../node_modules/jsencrypt/lib/jsrsasign/asn1-1.0.js","../node_modules/jsencrypt/lib/jsbn/base64.js","../node_modules/jsencrypt/src/jsencrypt.js","../src/deps/jsencrypt.js","../src/core/base_transport.js","../src/core/util/browser.js","../src/transport/websocket.js","../src/player.js","../src/core/parsers/pes.js","../src/core/parsers/ts.js","../src/client/hls/pes_avc.js","../src/client/hls/adts.js","../src/client/hls/pes_aac.js","../src/core/parsers/m3u8.js","../src/client/hls/client.js","../plugins/videojs/src/videojs.streamedian.js"],"sourcesContent":["// ERROR=0, WARN=1, LOG=2, DEBUG=3\nexport const LogLevel = {\n    Error: 0,\n    Warn: 1,\n    Log: 2,\n    Debug: 3\n};\n\nlet DEFAULT_LOG_LEVEL = LogLevel.Debug;\n\nexport function setDefaultLogLevel(level) {\n    DEFAULT_LOG_LEVEL = level;\n}\nexport class Logger {\n    constructor(level = DEFAULT_LOG_LEVEL, tag) {\n        this.tag = tag;\n        this.setLevel(level);\n    }\n    \n    setLevel(level) {\n        this.level = level;\n    }\n    \n    static get level_map() { return {\n        [LogLevel.Debug]:'log',\n        [LogLevel.Log]:'log',\n        [LogLevel.Warn]:'warn',\n        [LogLevel.Error]:'error'\n    }};\n\n    _log(lvl, args) {\n        args = Array.prototype.slice.call(args);\n        if (this.tag) {\n            args.unshift(`[${this.tag}]`);\n        }\n        if (this.level>=lvl) console[Logger.level_map[lvl]].apply(console, args);\n    }\n    log(){\n        this._log(LogLevel.Log, arguments)\n    }\n    debug(){\n        this._log(LogLevel.Debug, arguments)\n    }\n    error(){\n        this._log(LogLevel.Error, arguments)\n    }\n    warn(){\n        this._log(LogLevel.Warn, arguments)\n    }\n}\n\nconst taggedLoggers = new Map();\nexport function getTagged(tag) {\n    if (!taggedLoggers.has(tag)) {\n        taggedLoggers.set(tag, new Logger(DEFAULT_LOG_LEVEL, tag));\n    }\n    return taggedLoggers.get(tag);\n}\nexport const Log = new Logger();\n","// export * from 'bp_logger';\r\nexport * from '../../node_modules/bp_logger/logger.js';","export class Url {\r\n    static parse(url) {\r\n        let ret = {};\r\n\r\n        let regex = /^([^:]+):\\/\\/([^\\/]+)(.*)$/;  //protocol, login, urlpath\r\n        let result = regex.exec(url);\r\n\r\n        if (!result) {\r\n            throw new Error(\"bad url\");\r\n        }\r\n\r\n        ret.full = url;\r\n        ret.protocol = result[1];\r\n        ret.urlpath = result[3];\r\n\r\n        let parts = ret.urlpath.split('/');\r\n        ret.basename = parts.pop().split(/\\?|#/)[0];\r\n        ret.basepath = parts.join('/');\r\n\r\n        let loginSplit = result[2].split('@');\r\n        let hostport = loginSplit[0].split(':');\r\n        let userpass = [ null, null ];\r\n        if (loginSplit.length === 2) {\r\n            userpass = loginSplit[0].split(':');\r\n            hostport = loginSplit[1].split(':');\r\n        }\r\n\r\n        ret.user = userpass[0];\r\n        ret.pass = userpass[1];\r\n        ret.host = hostport[0];\r\n        ret.auth = (ret.user && ret.pass) ? `${ret.user}:${ret.pass}` : '';\r\n\r\n        ret.port = (null == hostport[1]) ? Url.protocolDefaultPort(ret.protocol) : hostport[1];\r\n        ret.portDefined = (null != hostport[1]);\r\n        ret.location = `${ret.host}:${ret.port}`;\r\n\r\n        if (ret.protocol == 'unix') {\r\n            ret.socket = ret.port;\r\n            ret.port = undefined;\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    static full(parsed) {\r\n        return `${parsed.protocol}://${parsed.location}/${parsed.urlpath}`;\r\n    }\r\n\r\n    static isAbsolute(url) {\r\n        return /^[^:]+:\\/\\//.test(url);\r\n    }\r\n\r\n    static protocolDefaultPort(protocol) {\r\n        switch (protocol) {\r\n            case 'rtsp': return 554;\r\n            case 'http': return 80;\r\n            case 'https': return 443;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n}","const listener = Symbol(\"event_listener\");\nconst listeners = Symbol(\"event_listeners\");\n\nexport class DestructibleEventListener {\n    constructor(eventListener) {\n        this[listener] = eventListener;\n        this[listeners] = new Map();\n    }\n\n    clear() {\n        if (this[listeners]) {\n            for (let entry of this[listeners]) {\n                for (let fn of entry[1]) {\n                    this[listener].removeEventListener(entry[0], fn);\n                }\n            };\n        }\n        this[listeners].clear();\n    }\n\n    destroy() {\n        this.clear();\n        this[listeners] = null;\n    }\n\n    on(event, selector, fn) {\n        if (fn == undefined) {\n            fn = selector;\n            selector = null;\n        }\n        if (selector) {\n            return this.addEventListener(event, (e) => {\n                if (e.target.matches(selector)) {\n                    fn(e)\n                }\n            });\n        } else {\n            return this.addEventListener(event, fn);\n        }\n    }\n\n    addEventListener(event, fn) {\n        if (!this[listeners].has(event)) {\n            this[listeners].set(event, new Set());\n        }\n        this[listeners].get(event).add(fn);\n        this[listener].addEventListener(event, fn, false);\n        return fn;\n    }\n\n    removeEventListener(event, fn) {\n        this[listener].removeEventListener(event, fn, false);\n        if (this[listeners].has(event)) {\n            //this[listeners].set(event, new Set());\n            let ev = this[listeners].get(event);\n            ev.delete(fn);\n            if (!ev.size) {\n                this[listeners].delete(event);\n            }\n        }\n    }\n\n    dispatchEvent(event) {\n        if (this[listener]) {\n            this[listener].dispatchEvent(event);\n        }\n    }\n}\n\nexport class EventEmitter {\n    constructor(element=null) {\n        this[listener] = new DestructibleEventListener(element || document.createElement('div'));\n    }\n\n    clear() {\n        if (this[listener]) {\n            this[listener].clear();\n        }\n    }\n\n    destroy() {\n        if (this[listener]) {\n            this[listener].destroy();\n            this[listener] = null;\n        }\n    }\n\n    on(event, selector, fn) {\n        if (this[listener]) {\n            return this[listener].on(event, selector, fn);\n        }\n        return null;\n    }\n\n    addEventListener(event, fn) {\n        if (this[listener]) {\n            return this[listener].addEventListener(event, fn, false);\n        }\n        return null;\n    }\n\n    removeEventListener(event, fn) {\n        if (this[listener]) {\n            this[listener].removeEventListener(event, fn, false);\n        }\n    }\n\n    dispatchEvent(event, data) {\n        if (this[listener]) {\n            this[listener].dispatchEvent(new CustomEvent(event, {detail: data}));\n        }\n    }\n}\n\nexport class EventSourceWrapper {\n    constructor(eventSource) {\n        this.eventSource = eventSource;\n        this[listeners] = new Map();\n    }\n\n    on(event, selector, fn) {\n        if (!this[listeners].has(event)) {\n            this[listeners].set(event, new Set());\n        }\n        let listener = this.eventSource.on(event, selector, fn);\n        if (listener) {\n            this[listeners].get(event).add(listener);\n        }\n    }\n\n    off(event, fn){\n        this.eventSource.removeEventListener(event, fn);\n    }\n\n    clear() {\n        this.eventSource.clear();\n        this[listeners].clear();\n    }\n\n    destroy() {\n        this.eventSource.clear();\n        this[listeners] = null;\n        this.eventSource = null;\n    }\n}\n","// export * from 'bp_event';\r\nexport * from '../../node_modules/bp_event/event.js';","/**\r\n * Generate MP4 Box\r\n * got from: https://github.com/dailymotion/hls.js\r\n */\r\n\r\nexport class MP4 {\r\n    static init() {\r\n        MP4.types = {\r\n            avc1: [], // codingname\r\n            avcC: [],\r\n            btrt: [],\r\n            dinf: [],\r\n            dref: [],\r\n            esds: [],\r\n            ftyp: [],\r\n            hdlr: [],\r\n            mdat: [],\r\n            mdhd: [],\r\n            mdia: [],\r\n            mfhd: [],\r\n            minf: [],\r\n            moof: [],\r\n            moov: [],\r\n            mp4a: [],\r\n            mvex: [],\r\n            mvhd: [],\r\n            sdtp: [],\r\n            stbl: [],\r\n            stco: [],\r\n            stsc: [],\r\n            stsd: [],\r\n            stsz: [],\r\n            stts: [],\r\n            tfdt: [],\r\n            tfhd: [],\r\n            traf: [],\r\n            trak: [],\r\n            trun: [],\r\n            trex: [],\r\n            tkhd: [],\r\n            vmhd: [],\r\n            smhd: []\r\n        };\r\n\r\n        var i;\r\n        for (i in MP4.types) {\r\n            if (MP4.types.hasOwnProperty(i)) {\r\n                MP4.types[i] = [\r\n                    i.charCodeAt(0),\r\n                    i.charCodeAt(1),\r\n                    i.charCodeAt(2),\r\n                    i.charCodeAt(3)\r\n                ];\r\n            }\r\n        }\r\n\r\n        var videoHdlr = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // pre_defined\r\n            0x76, 0x69, 0x64, 0x65, // handler_type: 'vide'\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x56, 0x69, 0x64, 0x65,\r\n            0x6f, 0x48, 0x61, 0x6e,\r\n            0x64, 0x6c, 0x65, 0x72, 0x00 // name: 'VideoHandler'\r\n        ]);\r\n\r\n        var audioHdlr = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // pre_defined\r\n            0x73, 0x6f, 0x75, 0x6e, // handler_type: 'soun'\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x53, 0x6f, 0x75, 0x6e,\r\n            0x64, 0x48, 0x61, 0x6e,\r\n            0x64, 0x6c, 0x65, 0x72, 0x00 // name: 'SoundHandler'\r\n        ]);\r\n\r\n        MP4.HDLR_TYPES = {\r\n            'video': videoHdlr,\r\n            'audio': audioHdlr\r\n        };\r\n\r\n        var dref = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x01, // entry_count\r\n            0x00, 0x00, 0x00, 0x0c, // entry_size\r\n            0x75, 0x72, 0x6c, 0x20, // 'url' type\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x01 // entry_flags\r\n        ]);\r\n\r\n        var stco = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00 // entry_count\r\n        ]);\r\n\r\n        MP4.STTS = MP4.STSC = MP4.STCO = stco;\r\n\r\n        MP4.STSZ = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x00, // sample_size\r\n            0x00, 0x00, 0x00, 0x00, // sample_count\r\n        ]);\r\n        MP4.VMHD = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x01, // flags\r\n            0x00, 0x00, // graphicsmode\r\n            0x00, 0x00,\r\n            0x00, 0x00,\r\n            0x00, 0x00 // opcolor\r\n        ]);\r\n        MP4.SMHD = new Uint8Array([\r\n            0x00, // version\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, // balance\r\n            0x00, 0x00 // reserved\r\n        ]);\r\n\r\n        MP4.STSD = new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x01]);// entry_count\r\n\r\n        var majorBrand = new Uint8Array([105,115,111,109]); // isom\r\n        var avc1Brand = new Uint8Array([97,118,99,49]); // avc1\r\n        var minorVersion = new Uint8Array([0, 0, 0, 1]);\r\n\r\n        MP4.FTYP = MP4.box(MP4.types.ftyp, majorBrand, minorVersion, majorBrand, avc1Brand);\r\n        MP4.DINF = MP4.box(MP4.types.dinf, MP4.box(MP4.types.dref, dref));\r\n    }\r\n\r\n    static box(type, ...payload) {\r\n        var size = 8,\r\n            i = payload.length,\r\n            len = i,\r\n            result;\r\n        // calculate the total size we need to allocate\r\n        while (i--) {\r\n            size += payload[i].byteLength;\r\n        }\r\n        result = new Uint8Array(size);\r\n        result[0] = (size >> 24) & 0xff;\r\n        result[1] = (size >> 16) & 0xff;\r\n        result[2] = (size >> 8) & 0xff;\r\n        result[3] = size  & 0xff;\r\n        result.set(type, 4);\r\n        // copy the payload into the result\r\n        for (i = 0, size = 8; i < len; ++i) {\r\n            // copy payload[i] array @ offset size\r\n            result.set(payload[i], size);\r\n            size += payload[i].byteLength;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static hdlr(type) {\r\n        return MP4.box(MP4.types.hdlr, MP4.HDLR_TYPES[type]);\r\n    }\r\n\r\n    static mdat(data) {\r\n        return MP4.box(MP4.types.mdat, data);\r\n    }\r\n\r\n    static mdhd(timescale, duration) {\r\n        return MP4.box(MP4.types.mdhd, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            0x00, 0x00, 0x00, 0x02, // creation_time\r\n            0x00, 0x00, 0x00, 0x03, // modification_time\r\n            (timescale >> 24) & 0xFF,\r\n            (timescale >> 16) & 0xFF,\r\n            (timescale >>  8) & 0xFF,\r\n            timescale & 0xFF, // timescale\r\n            (duration >> 24),\r\n            (duration >> 16) & 0xFF,\r\n            (duration >>  8) & 0xFF,\r\n            duration & 0xFF, // duration\r\n            0x55, 0xc4, // 'und' language (undetermined)\r\n            0x00, 0x00\r\n        ]));\r\n    }\r\n\r\n    static mdia(track) {\r\n        return MP4.box(MP4.types.mdia, MP4.mdhd(track.timescale, track.duration), MP4.hdlr(track.type), MP4.minf(track));\r\n    }\r\n\r\n    static mfhd(sequenceNumber) {\r\n        return MP4.box(MP4.types.mfhd, new Uint8Array([\r\n            0x00,\r\n            0x00, 0x00, 0x00, // flags\r\n            (sequenceNumber >> 24),\r\n            (sequenceNumber >> 16) & 0xFF,\r\n            (sequenceNumber >>  8) & 0xFF,\r\n            sequenceNumber & 0xFF, // sequence_number\r\n        ]));\r\n    }\r\n\r\n    static minf(track) {\r\n        if (track.type === 'audio') {\r\n            return MP4.box(MP4.types.minf, MP4.box(MP4.types.smhd, MP4.SMHD), MP4.DINF, MP4.stbl(track));\r\n        } else {\r\n            return MP4.box(MP4.types.minf, MP4.box(MP4.types.vmhd, MP4.VMHD), MP4.DINF, MP4.stbl(track));\r\n        }\r\n    }\r\n\r\n    static moof(sn, baseMediaDecodeTime, track) {\r\n        return MP4.box(MP4.types.moof, MP4.mfhd(sn), MP4.traf(track,baseMediaDecodeTime));\r\n    }\r\n    /**\r\n     * @param tracks... (optional) {array} the tracks associated with this movie\r\n     */\r\n    static moov(tracks, duration, timescale) {\r\n        var\r\n            i = tracks.length,\r\n            boxes = [];\r\n\r\n        while (i--) {\r\n            boxes[i] = MP4.trak(tracks[i]);\r\n        }\r\n\r\n        return MP4.box.apply(null, [MP4.types.moov, MP4.mvhd(timescale, duration)].concat(boxes).concat(MP4.mvex(tracks)));\r\n    }\r\n\r\n    static mvex(tracks) {\r\n        var\r\n            i = tracks.length,\r\n            boxes = [];\r\n\r\n        while (i--) {\r\n            boxes[i] = MP4.trex(tracks[i]);\r\n        }\r\n        return MP4.box.apply(null, [MP4.types.mvex].concat(boxes));\r\n    }\r\n\r\n    static mvhd(timescale,duration) {\r\n        var\r\n            bytes = new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                0x00, 0x00, 0x00, 0x01, // creation_time\r\n                0x00, 0x00, 0x00, 0x02, // modification_time\r\n                (timescale >> 24) & 0xFF,\r\n                (timescale >> 16) & 0xFF,\r\n                (timescale >>  8) & 0xFF,\r\n                timescale & 0xFF, // timescale\r\n                (duration >> 24) & 0xFF,\r\n                (duration >> 16) & 0xFF,\r\n                (duration >>  8) & 0xFF,\r\n                duration & 0xFF, // duration\r\n                0x00, 0x01, 0x00, 0x00, // 1.0 rate\r\n                0x01, 0x00, // 1.0 volume\r\n                0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x01, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x40, 0x00, 0x00, 0x00, // transformation: unity matrix\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // pre_defined\r\n                0xff, 0xff, 0xff, 0xff // next_track_ID\r\n            ]);\r\n        return MP4.box(MP4.types.mvhd, bytes);\r\n    }\r\n\r\n    static sdtp(track) {\r\n        var\r\n            samples = track.samples || [],\r\n            bytes = new Uint8Array(4 + samples.length),\r\n            flags,\r\n            i;\r\n        // leave the full box header (4 bytes) all zero\r\n        // write the sample table\r\n        for (i = 0; i < samples.length; i++) {\r\n            flags = samples[i].flags;\r\n            bytes[i + 4] = (flags.dependsOn << 4) |\r\n                (flags.isDependedOn << 2) |\r\n                (flags.hasRedundancy);\r\n        }\r\n\r\n        return MP4.box(MP4.types.sdtp, bytes);\r\n    }\r\n\r\n    static stbl(track) {\r\n        return MP4.box(MP4.types.stbl, MP4.stsd(track), MP4.box(MP4.types.stts, MP4.STTS), MP4.box(MP4.types.stsc, MP4.STSC), MP4.box(MP4.types.stsz, MP4.STSZ), MP4.box(MP4.types.stco, MP4.STCO));\r\n    }\r\n\r\n    static avc1(track) {\r\n        var sps = [], pps = [], i, data, len;\r\n        // assemble the SPSs\r\n\r\n        for (i = 0; i < track.sps.length; i++) {\r\n            data = track.sps[i];\r\n            len = data.byteLength;\r\n            sps.push((len >>> 8) & 0xFF);\r\n            sps.push((len & 0xFF));\r\n            sps = sps.concat(Array.prototype.slice.call(data)); // SPS\r\n        }\r\n\r\n        // assemble the PPSs\r\n        for (i = 0; i < track.pps.length; i++) {\r\n            data = track.pps[i];\r\n            len = data.byteLength;\r\n            pps.push((len >>> 8) & 0xFF);\r\n            pps.push((len & 0xFF));\r\n            pps = pps.concat(Array.prototype.slice.call(data));\r\n        }\r\n\r\n        var avcc = MP4.box(MP4.types.avcC, new Uint8Array([\r\n                0x01,   // version\r\n                sps[3], // profile\r\n                sps[4], // profile compat\r\n                sps[5], // level\r\n                0xfc | 3, // lengthSizeMinusOne, hard-coded to 4 bytes\r\n                0xE0 | track.sps.length // 3bit reserved (111) + numOfSequenceParameterSets\r\n            ].concat(sps).concat([\r\n                track.pps.length // numOfPictureParameterSets\r\n            ]).concat(pps))), // \"PPS\"\r\n            width = track.width,\r\n            height = track.height;\r\n        //console.log('avcc:' + Hex.hexDump(avcc));\r\n        return MP4.box(MP4.types.avc1, new Uint8Array([\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // data_reference_index\r\n                0x00, 0x00, // pre_defined\r\n                0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // pre_defined\r\n                (width >> 8) & 0xFF,\r\n                width & 0xff, // width\r\n                (height >> 8) & 0xFF,\r\n                height & 0xff, // height\r\n                0x00, 0x48, 0x00, 0x00, // horizresolution\r\n                0x00, 0x48, 0x00, 0x00, // vertresolution\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // frame_count\r\n                0x12,\r\n                0x62, 0x69, 0x6E, 0x65, //binelpro.ru\r\n                0x6C, 0x70, 0x72, 0x6F,\r\n                0x2E, 0x72, 0x75, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, // compressorname\r\n                0x00, 0x18,   // depth = 24\r\n                0x11, 0x11]), // pre_defined = -1\r\n            avcc,\r\n            MP4.box(MP4.types.btrt, new Uint8Array([\r\n                0x00, 0x1c, 0x9c, 0x80, // bufferSizeDB\r\n                0x00, 0x2d, 0xc6, 0xc0, // maxBitrate\r\n                0x00, 0x2d, 0xc6, 0xc0])) // avgBitrate\r\n        );\r\n    }\r\n\r\n    static esds(track) {\r\n        var configlen = track.config.byteLength;\r\n        let data = new Uint8Array(26+configlen+3);\r\n        data.set([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n\r\n            0x03, // descriptor_type\r\n            0x17+configlen, // length\r\n            0x00, 0x01, //es_id\r\n            0x00, // stream_priority\r\n\r\n            0x04, // descriptor_type\r\n            0x0f+configlen, // length\r\n            0x40, //codec : mpeg4_audio\r\n            0x15, // stream_type\r\n            0x00, 0x00, 0x00, // buffer_size\r\n            0x00, 0x00, 0x00, 0x00, // maxBitrate\r\n            0x00, 0x00, 0x00, 0x00, // avgBitrate\r\n\r\n            0x05, // descriptor_type\r\n            configlen\r\n        ]);\r\n        data.set(track.config, 26);\r\n        data.set([0x06, 0x01, 0x02], 26+configlen);\r\n        // return new Uint8Array([\r\n        //     0x00, // version 0\r\n        //     0x00, 0x00, 0x00, // flags\r\n        //\r\n        //     0x03, // descriptor_type\r\n        //     0x17+configlen, // length\r\n        //     0x00, 0x01, //es_id\r\n        //     0x00, // stream_priority\r\n        //\r\n        //     0x04, // descriptor_type\r\n        //     0x0f+configlen, // length\r\n        //     0x40, //codec : mpeg4_audio\r\n        //     0x15, // stream_type\r\n        //     0x00, 0x00, 0x00, // buffer_size\r\n        //     0x00, 0x00, 0x00, 0x00, // maxBitrate\r\n        //     0x00, 0x00, 0x00, 0x00, // avgBitrate\r\n        //\r\n        //     0x05 // descriptor_type\r\n        // ].concat([configlen]).concat(track.config).concat([0x06, 0x01, 0x02])); // GASpecificConfig)); // length + audio config descriptor\r\n        return data;\r\n    }\r\n\r\n    static mp4a(track) {\r\n        var audiosamplerate = track.audiosamplerate;\r\n        return MP4.box(MP4.types.mp4a, new Uint8Array([\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x00, 0x00, // reserved\r\n                0x00, 0x01, // data_reference_index\r\n                0x00, 0x00, 0x00, 0x00,\r\n                0x00, 0x00, 0x00, 0x00, // reserved\r\n                0x00, track.channelCount, // channelcount\r\n                0x00, 0x10, // sampleSize:16bits\r\n                0x00, 0x00, // pre_defined\r\n                0x00, 0x00, // reserved2\r\n                (audiosamplerate >> 8) & 0xFF,\r\n                audiosamplerate & 0xff, //\r\n                0x00, 0x00]),\r\n            MP4.box(MP4.types.esds, MP4.esds(track)));\r\n    }\r\n\r\n    static stsd(track) {\r\n        if (track.type === 'audio') {\r\n            return MP4.box(MP4.types.stsd, MP4.STSD, MP4.mp4a(track));\r\n        } else {\r\n            return MP4.box(MP4.types.stsd, MP4.STSD, MP4.avc1(track));\r\n        }\r\n    }\r\n\r\n    static tkhd(track) {\r\n        var id = track.id,\r\n            duration = track.duration,\r\n            width = track.width,\r\n            height = track.height,\r\n            volume = track.volume;\r\n        return MP4.box(MP4.types.tkhd, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x07, // flags\r\n            0x00, 0x00, 0x00, 0x00, // creation_time\r\n            0x00, 0x00, 0x00, 0x00, // modification_time\r\n            (id >> 24) & 0xFF,\r\n            (id >> 16) & 0xFF,\r\n            (id >> 8) & 0xFF,\r\n            id & 0xFF, // track_ID\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            (duration >> 24),\r\n            (duration >> 16) & 0xFF,\r\n            (duration >>  8) & 0xFF,\r\n            duration & 0xFF, // duration\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00, // reserved\r\n            0x00, 0x00, // layer\r\n            0x00, 0x00, // alternate_group\r\n            (volume>>0)&0xff, (((volume%1)*10)>>0)&0xff, // track volume // FIXME\r\n            0x00, 0x00, // reserved\r\n            0x00, 0x01, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x01, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x00, 0x00, 0x00, 0x00,\r\n            0x40, 0x00, 0x00, 0x00, // transformation: unity matrix\r\n            (width >> 8) & 0xFF,\r\n            width & 0xFF,\r\n            0x00, 0x00, // width\r\n            (height >> 8) & 0xFF,\r\n            height & 0xFF,\r\n            0x00, 0x00 // height\r\n        ]));\r\n    }\r\n\r\n    static traf(track,baseMediaDecodeTime) {\r\n        var sampleDependencyTable = MP4.sdtp(track),\r\n            id = track.id;\r\n        return MP4.box(MP4.types.traf,\r\n            MP4.box(MP4.types.tfhd, new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                (id >> 24),\r\n                (id >> 16) & 0XFF,\r\n                (id >> 8) & 0XFF,\r\n                (id & 0xFF) // track_ID\r\n            ])),\r\n            MP4.box(MP4.types.tfdt, new Uint8Array([\r\n                0x00, // version 0\r\n                0x00, 0x00, 0x00, // flags\r\n                (baseMediaDecodeTime >>24),\r\n                (baseMediaDecodeTime >> 16) & 0XFF,\r\n                (baseMediaDecodeTime >> 8) & 0XFF,\r\n                (baseMediaDecodeTime & 0xFF) // baseMediaDecodeTime\r\n            ])),\r\n            MP4.trun(track,\r\n                sampleDependencyTable.length +\r\n                16 + // tfhd\r\n                16 + // tfdt\r\n                8 +  // traf header\r\n                16 + // mfhd\r\n                8 +  // moof header\r\n                8),  // mdat header\r\n            sampleDependencyTable);\r\n    }\r\n\r\n    /**\r\n     * Generate a track box.\r\n     * @param track {object} a track definition\r\n     * @return {Uint8Array} the track box\r\n     */\r\n    static trak(track) {\r\n        track.duration = track.duration || 0xffffffff;\r\n        return MP4.box(MP4.types.trak, MP4.tkhd(track), MP4.mdia(track));\r\n    }\r\n\r\n    static trex(track) {\r\n        var id = track.id;\r\n        return MP4.box(MP4.types.trex, new Uint8Array([\r\n            0x00, // version 0\r\n            0x00, 0x00, 0x00, // flags\r\n            (id >> 24),\r\n            (id >> 16) & 0XFF,\r\n            (id >> 8) & 0XFF,\r\n            (id & 0xFF), // track_ID\r\n            0x00, 0x00, 0x00, 0x01, // default_sample_description_index\r\n            0x00, 0x00, 0x00, 0x00, // default_sample_duration\r\n            0x00, 0x00, 0x00, 0x00, // default_sample_size\r\n            0x00, 0x01, 0x00, 0x01 // default_sample_flags\r\n        ]));\r\n    }\r\n\r\n    static trun(track, offset) {\r\n        var samples= track.samples || [],\r\n            len = samples.length,\r\n            arraylen = 12 + (16 * len),\r\n            array = new Uint8Array(arraylen),\r\n            i,sample,duration,size,flags,cts;\r\n        offset += 8 + arraylen;\r\n        array.set([\r\n            0x00, // version 0\r\n            0x00, 0x0f, 0x01, // flags\r\n            (len >>> 24) & 0xFF,\r\n            (len >>> 16) & 0xFF,\r\n            (len >>> 8) & 0xFF,\r\n            len & 0xFF, // sample_count\r\n            (offset >>> 24) & 0xFF,\r\n            (offset >>> 16) & 0xFF,\r\n            (offset >>> 8) & 0xFF,\r\n            offset & 0xFF // data_offset\r\n        ],0);\r\n        for (i = 0; i < len; i++) {\r\n            sample = samples[i];\r\n            duration = sample.duration;\r\n            size = sample.size;\r\n            flags = sample.flags;\r\n            cts = sample.cts;\r\n            array.set([\r\n                (duration >>> 24) & 0xFF,\r\n                (duration >>> 16) & 0xFF,\r\n                (duration >>> 8) & 0xFF,\r\n                duration & 0xFF, // sample_duration\r\n                (size >>> 24) & 0xFF,\r\n                (size >>> 16) & 0xFF,\r\n                (size >>> 8) & 0xFF,\r\n                size & 0xFF, // sample_size\r\n                (flags.isLeading << 2) | flags.dependsOn,\r\n                (flags.isDependedOn << 6) |\r\n                (flags.hasRedundancy << 4) |\r\n                (flags.paddingValue << 1) |\r\n                flags.isNonSync,\r\n                flags.degradPrio & 0xF0 << 8,\r\n                flags.degradPrio & 0x0F, // sample_flags\r\n                (cts >>> 24) & 0xFF,\r\n                (cts >>> 16) & 0xFF,\r\n                (cts >>> 8) & 0xFF,\r\n                cts & 0xFF // sample_composition_time_offset\r\n            ],12+16*i);\r\n        }\r\n        return MP4.box(MP4.types.trun, array);\r\n    }\r\n\r\n    static initSegment(tracks, duration, timescale) {\r\n        if (!MP4.types) {\r\n            MP4.init();\r\n        }\r\n        var movie = MP4.moov(tracks, duration, timescale), result;\r\n        result = new Uint8Array(MP4.FTYP.byteLength + movie.byteLength);\r\n        result.set(MP4.FTYP);\r\n        result.set(movie, MP4.FTYP.byteLength);\r\n        return result;\r\n    }\r\n}\r\n","import {EventEmitter} from '../../deps/bp_event.js';\r\nimport {getTagged} from '../../deps/bp_logger.js';\r\n//import {MP4Inspect} from '../iso-bmff/mp4-inspector.js';\r\n\r\nconst LOG_TAG = \"mse\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class MSEBuffer {\r\n    constructor(parent, codec) {\r\n        this.mediaSource = parent.mediaSource;\r\n        this.players = parent.players;\r\n        this.cleaning = false;\r\n        this.parent = parent;\r\n        this.queue = [];\r\n        this.cleanResolvers = [];\r\n        this.codec = codec;\r\n        this.cleanRanges = [];\r\n\r\n        Log.debug(`Use codec: ${codec}`);\r\n\r\n        this.sourceBuffer = this.mediaSource.addSourceBuffer(codec);\r\n        this.eventSource = new EventEmitter(this.sourceBuffer);\r\n\r\n        this.eventSource.addEventListener('updatestart', (e)=> {\r\n            // this.updating = true;\r\n            // Log.debug('update start');\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning start`);\r\n            }\r\n        });\r\n\r\n        this.eventSource.addEventListener('update', (e)=> {\r\n            // this.updating = true;\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning update`);\r\n            }\r\n        });\r\n\r\n        this.eventSource.addEventListener('updateend', (e)=> {\r\n            // Log.debug('update end');\r\n            // this.updating = false;\r\n            if (this.cleaning) {\r\n                Log.debug(`${this.codec} cleaning end`);\r\n\r\n                try {\r\n                    if (this.sourceBuffer.buffered.length && this.players[0].currentTime < this.sourceBuffer.buffered.start(0)) {\r\n                        this.players[0].currentTime = this.sourceBuffer.buffered.start(0);\r\n                    }\r\n                } catch (e) {\r\n                    // TODO: do something?\r\n                }\r\n                while (this.cleanResolvers.length) {\r\n                    let resolver = this.cleanResolvers.shift();\r\n                    resolver();\r\n                }\r\n                this.cleaning = false;\r\n\r\n                if (this.cleanRanges.length) {\r\n                    this.doCleanup();\r\n                    return;\r\n                }\r\n            } else {\r\n                // Log.debug(`buffered: ${this.sourceBuffer.buffered.end(0)}, current ${this.players[0].currentTime}`);\r\n            }\r\n            this.feedNext();\r\n        });\r\n\r\n        this.eventSource.addEventListener('error', (e)=> {\r\n            Log.debug(`Source buffer error: ${this.mediaSource.readyState}`);\r\n            if (this.mediaSource.sourceBuffers.length) {\r\n                this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        });\r\n\r\n        this.eventSource.addEventListener('abort', (e)=> {\r\n            Log.debug(`Source buffer aborted: ${this.mediaSource.readyState}`);\r\n            if (this.mediaSource.sourceBuffers.length) {\r\n                this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        });\r\n\r\n        if (!this.sourceBuffer.updating) {\r\n            this.feedNext();\r\n        }\r\n        // TODO: cleanup every hour for live streams\r\n    }\r\n\r\n    destroy() {\r\n        this.eventSource.destroy();\r\n        this.clear();\r\n        this.queue = [];\r\n        this.mediaSource.removeSourceBuffer(this.sourceBuffer);\r\n    }\r\n\r\n    clear() {\r\n        this.queue = [];\r\n        let promises = [];\r\n        for (let i=0; i< this.sourceBuffer.buffered.length; ++i) {\r\n            // TODO: await remove\r\n            this.cleaning = true;\r\n            promises.push(new Promise((resolve, reject)=>{\r\n                this.cleanResolvers.push(resolve);\r\n                if (!this.sourceBuffer.updating) {\r\n                    this.sourceBuffer.remove(this.sourceBuffer.buffered.start(i), this.sourceBuffer.buffered.end(i));\r\n                    resolve();\r\n                } else {\r\n                    this.sourceBuffer.onupdateend = () => {\r\n                        if (this.sourceBuffer) {\r\n                            this.sourceBuffer.remove(this.sourceBuffer.buffered.start(i), this.sourceBuffer.buffered.end(i));\r\n                        }\r\n                        resolve();\r\n                    };\r\n                }\r\n            }));\r\n        }\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    setLive(is_live) {\r\n        this.is_live = is_live;\r\n    }\r\n\r\n    feedNext() {\r\n        // Log.debug(\"feed next \", this.sourceBuffer.updating);\r\n        if (!this.sourceBuffer.updating && !this.cleaning && this.queue.length) {\r\n            this.doAppend(this.queue.shift());\r\n            // TODO: if is live and current position > 1hr => clean all and restart\r\n        }\r\n    }\r\n\r\n    doCleanup() {\r\n        if (!this.cleanRanges.length) {\r\n            this.cleaning = false;\r\n            this.feedNext();\r\n            return;\r\n        }\r\n        let range = this.cleanRanges.shift();\r\n        Log.debug(`${this.codec} remove range [${range[0]} - ${range[1]}). \r\n                    \\nUpdating: ${this.sourceBuffer.updating}\r\n                    `);\r\n        this.cleaning = true;\r\n        this.sourceBuffer.remove(range[0], range[1]);\r\n    }\r\n\r\n    initCleanup() {\r\n        if (this.sourceBuffer.buffered.length && !this.sourceBuffer.updating && !this.cleaning) {\r\n            Log.debug(`${this.codec} cleanup`);\r\n            let removeBound = this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1) - 2;\r\n\r\n            for (let i=0; i< this.sourceBuffer.buffered.length; ++i) {\r\n                let removeStart = this.sourceBuffer.buffered.start(i);\r\n                let removeEnd = this.sourceBuffer.buffered.end(i);\r\n                if ((this.players[0].currentTime <= removeStart) || (removeBound <= removeStart)) continue;\r\n\r\n                if ((removeBound <= removeEnd) && (removeBound >= removeStart)) {\r\n                    Log.debug(`Clear [${removeStart}, ${removeBound}), leave [${removeBound}, ${removeEnd}]`);\r\n                    removeEnd = removeBound;\r\n                    if (removeEnd!=removeStart) {\r\n                        this.cleanRanges.push([removeStart, removeEnd]);\r\n                    }\r\n                    continue; // Do not cleanup buffered range after current position\r\n                }\r\n                this.cleanRanges.push([removeStart, removeEnd]);\r\n            }\r\n\r\n            this.doCleanup();\r\n\r\n            // let bufferStart = this.sourceBuffer.buffered.start(0);\r\n            // let removeEnd = this.sourceBuffer.buffered.start(0) + (this.sourceBuffer.buffered.end(0) - this.sourceBuffer.buffered.start(0))/2;\r\n            // if (this.players[0].currentTime < removeEnd) {\r\n            //     this.players[0].currentTime = removeEnd;\r\n            // }\r\n            // let removeEnd = Math.max(this.players[0].currentTime - 3, this.sourceBuffer.buffered.end(0) - 3);\r\n            //\r\n            // if (removeEnd < bufferStart) {\r\n            //     removeEnd = this.sourceBuffer.buffered.start(0) + (this.sourceBuffer.buffered.end(0) - this.sourceBuffer.buffered.start(0))/2;\r\n            //     if (this.players[0].currentTime < removeEnd) {\r\n            //         this.players[0].currentTime = removeEnd;\r\n            //     }\r\n            // }\r\n\r\n            // if (removeEnd > bufferStart && (removeEnd - bufferStart > 0.5 )) {\r\n            //     // try {\r\n            //         Log.debug(`${this.codec} remove range [${bufferStart} - ${removeEnd}).\r\n            //         \\nBuffered end: ${this.sourceBuffer.buffered.end(0)}\r\n            //         \\nUpdating: ${this.sourceBuffer.updating}\r\n            //         `);\r\n            //         this.cleaning = true;\r\n            //         this.sourceBuffer.remove(bufferStart, removeEnd);\r\n            //     // } catch (e) {\r\n            //     //     // TODO: implement\r\n            //     //     Log.error(e);\r\n            //     // }\r\n            // } else {\r\n            //     this.feedNext();\r\n            // }\r\n        } else {\r\n            this.feedNext();\r\n        }\r\n    }\r\n\r\n    doAppend(data) {\r\n        // console.log(MP4Inspect.mp4toJSON(data));\r\n        let err = this.players[0].error;\r\n        if (err) {\r\n            Log.error(`Error occured: ${MSE.ErrorNotes[err.code]}`);\r\n            try {\r\n                this.players.forEach((video)=>{video.stop();});\r\n                this.mediaSource.endOfStream();\r\n            } catch (e){\r\n\r\n            }\r\n            this.parent.eventSource.dispatchEvent('error');\r\n        } else {\r\n            try {\r\n                this.sourceBuffer.appendBuffer(data);\r\n            } catch (e) {\r\n                if (e.name === 'QuotaExceededError') {\r\n                    Log.debug(`${this.codec} quota fail`);\r\n                    this.queue.unshift(data);\r\n                    this.initCleanup();\r\n                    return;\r\n                }\r\n\r\n                // reconnect on fail\r\n                Log.error(`Error occured while appending buffer. ${e.name}: ${e.message}`);\r\n                this.parent.eventSource.dispatchEvent('error');\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    feed(data) {\r\n        this.queue = this.queue.concat(data);\r\n        // Log.debug(this.sourceBuffer.updating, this.updating, this.queue.length);\r\n        if (this.sourceBuffer && !this.sourceBuffer.updating && !this.cleaning) {\r\n            // Log.debug('enq feed');\r\n            this.feedNext();\r\n        }\r\n    }\r\n}\r\n\r\nexport class MSE {\r\n    // static CODEC_AVC_BASELINE = \"avc1.42E01E\";\r\n    // static CODEC_AVC_MAIN = \"avc1.4D401E\";\r\n    // static CODEC_AVC_HIGH = \"avc1.64001E\";\r\n    // static CODEC_VP8 = \"vp8\";\r\n    // static CODEC_AAC = \"mp4a.40.2\";\r\n    // static CODEC_VORBIS = \"vorbis\";\r\n    // static CODEC_THEORA = \"theora\";\r\n\r\n    static get ErrorNotes() {return  {\r\n        [MediaError.MEDIA_ERR_ABORTED]: 'fetching process aborted by user',\r\n        [MediaError.MEDIA_ERR_NETWORK]: 'error occurred when downloading',\r\n        [MediaError.MEDIA_ERR_DECODE]: 'error occurred when decoding',\r\n        [MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]: 'audio/video not supported'\r\n    }};\r\n\r\n    static isSupported(codecs) {\r\n        return (window.MediaSource && window.MediaSource.isTypeSupported(`video/mp4; codecs=\"${codecs.join(',')}\"`));\r\n    }\r\n\r\n    constructor (players) {\r\n        this.players = players;\r\n        const playing = this.players.map((video, idx) => {\r\n            video.onplaying = function () {\r\n                playing[idx] = true;\r\n            };\r\n            video.onpause = function () {\r\n                playing[idx] = false;\r\n            };\r\n            return !video.paused;\r\n        });\r\n        this.playing = playing;\r\n        this.mediaSource = new MediaSource();\r\n        this.eventSource = new EventEmitter(this.mediaSource);\r\n        this.reset();\r\n    }\r\n\r\n    destroy() {\r\n        this.reset();\r\n        this.eventSource.destroy();\r\n        this.mediaSource = null;\r\n        this.eventSource = null;\r\n    }\r\n\r\n    play() {\r\n        this.players.forEach((video, idx)=>{\r\n            if (video.paused && !this.playing[idx]) {\r\n                Log.debug(`player ${idx}: play`);\r\n                video.play();\r\n            }\r\n        });\r\n    }\r\n\r\n    setLive(is_live) {\r\n        for (let idx in this.buffers) {\r\n            this.buffers[idx].setLive(is_live);\r\n        }\r\n        this.is_live = is_live;\r\n    }\r\n\r\n    resetBuffers() {\r\n        this.players.forEach((video, idx)=>{\r\n            if (!video.paused && this.playing[idx]) {\r\n                video.pause();\r\n                video.currentTime = 0;\r\n            }\r\n        });\r\n\r\n        let promises = [];\r\n        for (let buffer of this.buffers.values()) {\r\n            promises.push(buffer.clear());\r\n        }\r\n        return Promise.all(promises).then(()=>{\r\n            this.mediaSource.endOfStream();\r\n            this.mediaSource.duration = 0;\r\n            this.mediaSource.clearLiveSeekableRange();\r\n            this.play();\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        this.reset();\r\n        this.players.forEach((video)=>{video.src = URL.createObjectURL(this.mediaSource)});\r\n\r\n        return this.setupEvents();\r\n    }\r\n\r\n    setupEvents() {\r\n        this.eventSource.clear();\r\n        this.resolved = false;\r\n        this.mediaReady = new Promise((resolve, reject)=> {\r\n            this._sourceOpen = ()=> {\r\n                Log.debug(`Media source opened: ${this.mediaSource.readyState}`);\r\n                if (!this.resolved) {\r\n                    this.resolved = true;\r\n                    resolve();\r\n                }\r\n            };\r\n            this._sourceEnded = ()=>{\r\n                Log.debug(`Media source ended: ${this.mediaSource.readyState}`);\r\n            };\r\n            this._sourceClose = ()=>{\r\n                Log.debug(`Media source closed: ${this.mediaSource.readyState}`);\r\n                if (this.resolved) {\r\n                    this.eventSource.dispatchEvent('sourceclosed');\r\n                }\r\n            };\r\n            this.eventSource.addEventListener('sourceopen', this._sourceOpen);\r\n            this.eventSource.addEventListener('sourceended', this._sourceEnded);\r\n            this.eventSource.addEventListener('sourceclose', this._sourceClose);\r\n        });\r\n        return this.mediaReady;\r\n    }\r\n\r\n    reset() {\r\n        this.ready = false;\r\n        for (let track in this.buffers) {\r\n            this.buffers[track].destroy();\r\n            delete this.buffers[track];\r\n        }\r\n        if (this.mediaSource.readyState == 'open') {\r\n            this.mediaSource.duration = 0;\r\n            this.mediaSource.endOfStream();\r\n        }\r\n        this.updating = false;\r\n        this.resolved = false;\r\n        this.buffers = {};\r\n        // this.players.forEach((video)=>{video.src = URL.createObjectURL(this.mediaSource)});\r\n        // TODO: remove event listeners for existing media source\r\n        // this.setupEvents();\r\n        // this.clear();\r\n    }\r\n\r\n    setCodec(track, mimeCodec) {\r\n        return this.mediaReady.then(()=>{\r\n            this.buffers[track] = new MSEBuffer(this, mimeCodec);\r\n            this.buffers[track].setLive(this.is_live);\r\n        });\r\n    }\r\n\r\n    feed(track, data) {\r\n        if (this.buffers[track]) {\r\n            this.buffers[track].feed(data);\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nconst Log = getTagged('remuxer:base');\r\nlet track_id = 1;\r\nexport class BaseRemuxer {\r\n\r\n    static get MP4_TIMESCALE() { return 90000;}\r\n\r\n    // TODO: move to ts parser\r\n    // static PTSNormalize(value, reference) {\r\n    //\r\n    //     let offset;\r\n    //     if (reference === undefined) {\r\n    //         return value;\r\n    //     }\r\n    //     if (reference < value) {\r\n    //         // - 2^33\r\n    //         offset = -8589934592;\r\n    //     } else {\r\n    //         // + 2^33\r\n    //         offset = 8589934592;\r\n    //     }\r\n    //     /* PTS is 33bit (from 0 to 2^33 -1)\r\n    //      if diff between value and reference is bigger than half of the amplitude (2^32) then it means that\r\n    //      PTS looping occured. fill the gap */\r\n    //     while (Math.abs(value - reference) > 4294967296) {\r\n    //         value += offset;\r\n    //     }\r\n    //     return value;\r\n    // }\r\n\r\n    static getTrackID() {\r\n        return track_id++;\r\n    }\r\n\r\n    constructor(timescale, scaleFactor, params) {\r\n        this.timeOffset = 0;\r\n        this.timescale = timescale;\r\n        this.scaleFactor = scaleFactor;\r\n        this.readyToDecode = false;\r\n        this.samples = [];\r\n        this.seq = 1;\r\n        this.tsAlign = 1;\r\n    }\r\n\r\n    scaled(timestamp) {\r\n        return timestamp / this.scaleFactor;\r\n    }\r\n\r\n    unscaled(timestamp) {\r\n        return timestamp * this.scaleFactor;\r\n    }\r\n\r\n    remux(unit) {\r\n        if (unit) {\r\n            this.samples.push({\r\n                unit: unit,\r\n                pts: unit.pts,\r\n                dts: unit.dts\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    static toMS(timestamp) {\r\n        return timestamp/90;\r\n    }\r\n    \r\n    setConfig(config) {\r\n        \r\n    }\r\n\r\n    insertDscontinuity() {\r\n        this.samples.push(null);\r\n    }\r\n\r\n    init(initPTS, initDTS, shouldInitialize=true) {\r\n        this.initPTS = Math.min(initPTS, this.samples[0].dts /*- this.unscaled(this.timeOffset)*/);\r\n        this.initDTS = Math.min(initDTS, this.samples[0].dts /*- this.unscaled(this.timeOffset)*/);\r\n        Log.debug(`Initial pts=${this.initPTS} dts=${this.initDTS} offset=${this.unscaled(this.timeOffset)}`);\r\n        this.initialized = shouldInitialize;\r\n    }\r\n\r\n    flush() {\r\n        this.seq++;\r\n        this.mp4track.len = 0;\r\n        this.mp4track.samples = [];\r\n    }\r\n\r\n    static dtsSortFunc(a,b) {\r\n        return (a.dts-b.dts);\r\n    }\r\n\r\n    getPayloadBase(sampleFunction, setupSample) {\r\n        if (!this.readyToDecode || !this.initialized || !this.samples.length) return null;\r\n        this.samples.sort(BaseRemuxer.dtsSortFunc);\r\n        return true;\r\n        //\r\n        // let payload = new Uint8Array(this.mp4track.len);\r\n        // let offset = 0;\r\n        // let samples=this.mp4track.samples;\r\n        // let mp4Sample, lastDTS, pts, dts;\r\n        //\r\n        // while (this.samples.length) {\r\n        //     let sample = this.samples.shift();\r\n        //     if (sample === null) {\r\n        //         // discontinuity\r\n        //         this.nextDts = undefined;\r\n        //         break;\r\n        //     }\r\n        //\r\n        //     let unit = sample.unit;\r\n        //\r\n        //     pts = Math.round((sample.pts - this.initDTS)/this.tsAlign)*this.tsAlign;\r\n        //     dts = Math.round((sample.dts - this.initDTS)/this.tsAlign)*this.tsAlign;\r\n        //     // ensure DTS is not bigger than PTS\r\n        //     dts = Math.min(pts, dts);\r\n        //\r\n        //     // sampleFunction(pts, dts);   // TODO:\r\n        //\r\n        //     // mp4Sample = setupSample(unit, pts, dts);    // TODO:\r\n        //\r\n        //     payload.set(unit.getData(), offset);\r\n        //     offset += unit.getSize();\r\n        //\r\n        //     samples.push(mp4Sample);\r\n        //     lastDTS = dts;\r\n        // }\r\n        // if (!samples.length) return null;\r\n        //\r\n        // // samplesPostFunction(samples); // TODO:\r\n        //\r\n        // return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {MSE} from '../presentation/mse.js';\r\nimport {BaseRemuxer} from './base.js';\r\n\r\nconst Log = getTagged(\"remuxer:aac\");\r\n// TODO: asm.js\r\nexport class AACRemuxer extends BaseRemuxer {\r\n\r\n    constructor(timescale, scaleFactor = 1, params={}) {\r\n        super(timescale, scaleFactor);\r\n\r\n        this.codecstring=MSE.CODEC_AAC;\r\n        this.units = [];\r\n        this.initDTS = undefined;\r\n        this.nextAacPts = undefined;\r\n        this.lastPts = 0;\r\n        this.firstDTS = 0;\r\n        this.firstPTS = 0;\r\n        this.duration = params.duration || 1;\r\n        this.initialized = false;\r\n\r\n        this.mp4track={\r\n            id:BaseRemuxer.getTrackID(),\r\n            type: 'audio',\r\n            fragmented:true,\r\n            channelCount:0,\r\n            audiosamplerate: this.timescale,\r\n            duration: 0,\r\n            timescale: this.timescale,\r\n            volume: 1,\r\n            samples: [],\r\n            config: '',\r\n            len: 0\r\n        };\r\n        if (params.config) {\r\n            this.setConfig(params.config);\r\n        }\r\n    }\r\n\r\n    setConfig(config) {\r\n        this.mp4track.channelCount = config.channels;\r\n        this.mp4track.audiosamplerate = config.samplerate;\r\n        if (!this.mp4track.duration) {\r\n            this.mp4track.duration = (this.duration?this.duration:1)*config.samplerate;\r\n        }\r\n        this.mp4track.timescale = config.samplerate;\r\n        this.mp4track.config = config.config;\r\n        this.mp4track.codec = config.codec;\r\n        this.timescale = config.samplerate;\r\n        this.scaleFactor = BaseRemuxer.MP4_TIMESCALE / config.samplerate;\r\n        this.expectedSampleDuration = 1024 * this.scaleFactor;\r\n        this.readyToDecode = true;\r\n    }\r\n\r\n    remux(aac) {\r\n        if (super.remux.call(this, aac)) {\r\n            this.mp4track.len += aac.getSize();\r\n        }\r\n    }\r\n\r\n    getPayload() {\r\n        if (!this.readyToDecode || !this.samples.length) return null;\r\n        this.samples.sort(function(a, b) {\r\n            return (a.dts-b.dts);\r\n        });\r\n\r\n        let payload = new Uint8Array(this.mp4track.len);\r\n        let offset = 0;\r\n        let samples=this.mp4track.samples;\r\n        let mp4Sample, lastDTS, pts, dts;\r\n\r\n        while (this.samples.length) {\r\n            let sample = this.samples.shift();\r\n            if (sample === null) {\r\n                // discontinuity\r\n                this.nextDts = undefined;\r\n                break;\r\n            }\r\n            let unit = sample.unit;\r\n            pts = sample.pts - this.initDTS;\r\n            dts = sample.dts - this.initDTS;\r\n\r\n            if (lastDTS === undefined) {\r\n                if (this.nextDts) {\r\n                    let delta = Math.round(this.scaled(pts - this.nextAacPts));\r\n                    // if fragment are contiguous, or delta less than 600ms, ensure there is no overlap/hole between fragments\r\n                    if (/*contiguous || */Math.abs(delta) < 600) {\r\n                        // log delta\r\n                        if (delta) {\r\n                            if (delta > 0) {\r\n                                Log.log(`${delta} ms hole between AAC samples detected,filling it`);\r\n                                // if we have frame overlap, overlapping for more than half a frame duraion\r\n                            } else if (delta < -12) {\r\n                                // drop overlapping audio frames... browser will deal with it\r\n                                Log.log(`${(-delta)} ms overlapping between AAC samples detected, drop frame`);\r\n                                this.mp4track.len -= unit.getSize();\r\n                                continue;\r\n                            }\r\n                            // set DTS to next DTS\r\n                            pts = dts = this.nextAacPts;\r\n                        }\r\n                    }\r\n                }\r\n                // remember first PTS of our aacSamples, ensure value is positive\r\n                this.firstDTS = Math.max(0, dts);\r\n            }\r\n\r\n            mp4Sample = {\r\n                size: unit.getSize(),\r\n                cts: 0,\r\n                duration:1024,\r\n                flags: {\r\n                    isLeading: 0,\r\n                    isDependedOn: 0,\r\n                    hasRedundancy: 0,\r\n                    degradPrio: 0,\r\n                    dependsOn: 1\r\n                }\r\n            };\r\n\r\n            payload.set(unit.getData(), offset);\r\n            offset += unit.getSize();\r\n            samples.push(mp4Sample);\r\n            lastDTS = dts;\r\n        }\r\n        if (!samples.length) return null;\r\n        this.nextDts =pts+this.expectedSampleDuration;\r\n        return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}\r\n//test.bundle.js:42 [remuxer:h264] skip frame from the past at DTS=18397972271140676 with expected DTS=18397998040950484","/**\r\n * Parser for exponential Golomb codes, a variable-bitwidth number encoding scheme used by h264.\r\n*/\r\n// TODO: asm.js\r\nimport {Log as logger} from '../../deps/bp_logger.js';\r\n\r\nexport class ExpGolomb {\r\n\r\n  constructor(data) {\r\n    this.data = data;\r\n    // the number of bytes left to examine in this.data\r\n    this.bytesAvailable = this.data.byteLength;\r\n    // the current word being examined\r\n    this.word = 0; // :uint\r\n    // the number of bits left to examine in the current word\r\n    this.bitsAvailable = 0; // :uint\r\n  }\r\n\r\n  // ():void\r\n  loadWord() {\r\n    var\r\n      position = this.data.byteLength - this.bytesAvailable,\r\n      workingBytes = new Uint8Array(4),\r\n      availableBytes = Math.min(4, this.bytesAvailable);\r\n    if (availableBytes === 0) {\r\n      throw new Error('no bytes available');\r\n    }\r\n    workingBytes.set(this.data.subarray(position, position + availableBytes));\r\n    this.word = new DataView(workingBytes.buffer, workingBytes.byteOffset, workingBytes.byteLength).getUint32(0);\r\n    // track the amount of this.data that has been processed\r\n    this.bitsAvailable = availableBytes * 8;\r\n    this.bytesAvailable -= availableBytes;\r\n  }\r\n\r\n  // (count:int):void\r\n  skipBits(count) {\r\n    var skipBytes; // :int\r\n    if (this.bitsAvailable > count) {\r\n      this.word <<= count;\r\n      this.bitsAvailable -= count;\r\n    } else {\r\n      count -= this.bitsAvailable;\r\n      skipBytes = count >> 3;\r\n      count -= (skipBytes << 3);\r\n      this.bytesAvailable -= skipBytes;\r\n      this.loadWord();\r\n      this.word <<= count;\r\n      this.bitsAvailable -= count;\r\n    }\r\n  }\r\n\r\n  // (size:int):uint\r\n  readBits(size) {\r\n    var\r\n      bits = Math.min(this.bitsAvailable, size), // :uint\r\n      valu = this.word >>> (32 - bits); // :uint\r\n    if (size > 32) {\r\n      logger.error('Cannot read more than 32 bits at a time');\r\n    }\r\n    this.bitsAvailable -= bits;\r\n    if (this.bitsAvailable > 0) {\r\n      this.word <<= bits;\r\n    } else if (this.bytesAvailable > 0) {\r\n      this.loadWord();\r\n    }\r\n    bits = size - bits;\r\n    if (bits > 0) {\r\n      return valu << bits | this.readBits(bits);\r\n    } else {\r\n      return valu;\r\n    }\r\n  }\r\n\r\n  // ():uint\r\n  skipLZ() {\r\n    var leadingZeroCount; // :uint\r\n    for (leadingZeroCount = 0; leadingZeroCount < this.bitsAvailable; ++leadingZeroCount) {\r\n      if (0 !== (this.word & (0x80000000 >>> leadingZeroCount))) {\r\n        // the first bit of working word is 1\r\n        this.word <<= leadingZeroCount;\r\n        this.bitsAvailable -= leadingZeroCount;\r\n        return leadingZeroCount;\r\n      }\r\n    }\r\n    // we exhausted word and still have not found a 1\r\n    this.loadWord();\r\n    return leadingZeroCount + this.skipLZ();\r\n  }\r\n\r\n  // ():void\r\n  skipUEG() {\r\n    this.skipBits(1 + this.skipLZ());\r\n  }\r\n\r\n  // ():void\r\n  skipEG() {\r\n    this.skipBits(1 + this.skipLZ());\r\n  }\r\n\r\n  // ():uint\r\n  readUEG() {\r\n    var clz = this.skipLZ(); // :uint\r\n    return this.readBits(clz + 1) - 1;\r\n  }\r\n\r\n  // ():int\r\n  readEG() {\r\n    var valu = this.readUEG(); // :int\r\n    if (0x01 & valu) {\r\n      // the number is odd if the low order bit is set\r\n      return (1 + valu) >>> 1; // add 1 to make it even, and divide by 2\r\n    } else {\r\n      return -1 * (valu >>> 1); // divide by two then make it negative\r\n    }\r\n  }\r\n\r\n  // Some convenience functions\r\n  // :Boolean\r\n  readBoolean() {\r\n    return 1 === this.readBits(1);\r\n  }\r\n\r\n  // ():int\r\n  readUByte() {\r\n    return this.readBits(8);\r\n  }\r\n\r\n  // ():int\r\n  readUShort() {\r\n    return this.readBits(16);\r\n  }\r\n    // ():int\r\n  readUInt() {\r\n    return this.readBits(32);\r\n  }  \r\n}\r\n","// TODO: asm.js\r\n\r\nexport function appendByteArray(buffer1, buffer2) {\r\n    let tmp = new Uint8Array((buffer1.byteLength|0) + (buffer2.byteLength|0));\r\n    tmp.set(buffer1, 0);\r\n    tmp.set(buffer2, buffer1.byteLength|0);\r\n    return tmp;\r\n}\r\n\r\nexport function appendByteArrayAsync(buffer1, buffer2) {\r\n    return new Promise((resolve, reject)=>{\r\n        let blob = new Blob([buffer1, buffer2]);\r\n        let reader = new FileReader();\r\n        reader.addEventListener(\"loadend\", function() {\r\n            resolve();\r\n        });\r\n        reader.readAsArrayBuffer(blob);\r\n    });\r\n}\r\nexport function base64ToArrayBuffer(base64) {\r\n    var binary_string =  window.atob(base64);\r\n    var len = binary_string.length;\r\n    var bytes = new Uint8Array( len );\r\n    for (var i = 0; i < len; i++)        {\r\n        bytes[i] = binary_string.charCodeAt(i);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\nexport function hexToByteArray(hex) {\r\n    let len = hex.length >> 1;\r\n    var bufView = new Uint8Array(len);\r\n    for (var i = 0; i < len; i++) {\r\n        bufView[i] = parseInt(hex.substr(i<<1,2),16);\r\n    }\r\n    return bufView;\r\n}\r\n\r\nexport function concatenate(resultConstructor, ...arrays) {\r\n    let totalLength = 0;\r\n    for (let arr of arrays) {\r\n        totalLength += arr.length;\r\n    }\r\n    let result = new resultConstructor(totalLength);\r\n    let offset = 0;\r\n    for (let arr of arrays) {\r\n        result.set(arr, offset);\r\n        offset += arr.length;\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function bitSlice(bytearray, start=0, end=bytearray.byteLength*8) {\r\n    let byteLen = Math.ceil((end-start)/8);\r\n    let res = new Uint8Array(byteLen);\r\n    let startByte = start >>> 3;   // /8\r\n    let endByte = (end>>>3) - 1;    // /8\r\n    let bitOffset = start & 0x7;     // %8\r\n    let nBitOffset = 8 - bitOffset;\r\n    let endOffset = 8 - end & 0x7;   // %8\r\n    for (let i=0; i<byteLen; ++i) {\r\n        let tail = 0;\r\n        if (i<endByte) {\r\n            tail = bytearray[startByte+i+1] >> nBitOffset;\r\n            if (i == endByte-1 && endOffset < 8) {\r\n                tail >>= endOffset;\r\n                tail <<= endOffset;\r\n            }\r\n        }\r\n        res[i]=(bytearray[startByte+i]<<bitOffset) | tail;\r\n    }\r\n    return res;\r\n}\r\n\r\nexport class BitArray {\r\n\r\n    constructor(src) {\r\n        this.src    = new DataView(src.buffer, src.byteOffset, src.byteLength);\r\n        this.bitpos = 0;\r\n        this.byte   = this.src.getUint8(0); /* This should really be undefined, uint wont allow it though */\r\n        this.bytepos = 0;\r\n    }\r\n\r\n    readBits(length) {\r\n        if (32 < (length|0) || 0 === (length|0)) {\r\n            /* To big for an uint */\r\n            throw new Error(\"too big\");\r\n        }\r\n\r\n        let result = 0;\r\n        for (let i = length; i > 0; --i) {\r\n\r\n            /* Shift result one left to make room for another bit,\r\n             then add the next bit on the stream. */\r\n            result = ((result|0) << 1) | (((this.byte|0) >> (8 - (++this.bitpos))) & 0x01);\r\n            if ((this.bitpos|0)>=8) {\r\n                this.byte = this.src.getUint8(++this.bytepos);\r\n                this.bitpos &= 0x7;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n    skipBits(length) {\r\n        this.bitpos += (length|0) & 0x7; // %8\r\n        this.bytepos += (length|0) >>> 3;  // *8\r\n        if (this.bitpos > 7) {\r\n            this.bitpos &= 0x7;\r\n            ++this.bytepos;\r\n        }\r\n\r\n        if (!this.finished()) {\r\n            this.byte = this.src.getUint8(this.bytepos);\r\n            return 0;\r\n        } else {\r\n            return this.bytepos-this.src.byteLength-this.src.bitpos;\r\n        }\r\n    }\r\n    \r\n    finished() {\r\n        return this.bytepos >= this.src.byteLength;\r\n    }\r\n}","import {appendByteArray} from '../util/binary.js';\r\n\r\nexport class NALU {\r\n\r\n    static get NDR() {return 1;}\r\n    static get SLICE_PART_A() {return 2;}\r\n    static get SLICE_PART_B() {return 3;}\r\n    static get SLICE_PART_C() {return 4;}\r\n    static get IDR() {return 5;}\r\n    static get SEI() {return 6;}\r\n    static get SPS() {return 7;}\r\n    static get PPS() {return 8;}\r\n    static get DELIMITER() {return 9;}\r\n    static get EOSEQ() {return 10;}\r\n    static get EOSTR() {return 11;}\r\n    static get FILTER() {return 12;}\r\n    static get STAP_A() {return 24;}\r\n    static get STAP_B() {return 25;}\r\n    static get FU_A() {return 28;}\r\n    static get FU_B() {return 29;}\r\n\r\n    static get TYPES() {return {\r\n        [NALU.IDR]: 'IDR',\r\n        [NALU.SEI]: 'SEI',\r\n        [NALU.SPS]: 'SPS',\r\n        [NALU.PPS]: 'PPS',\r\n        [NALU.NDR]: 'NDR'\r\n    }};\r\n\r\n    static type(nalu) {\r\n        if (nalu.ntype in NALU.TYPES) {\r\n            return NALU.TYPES[nalu.ntype];\r\n        } else {\r\n            return 'UNKNOWN';\r\n        }\r\n    }\r\n\r\n    constructor(ntype, nri, data, dts, pts) {\r\n\r\n        this.data = data;\r\n        this.ntype = ntype;\r\n        this.nri = nri;\r\n        this.dts = dts;\r\n        this.pts = pts ? pts : this.dts;\r\n        this.sliceType = null;\r\n    }\r\n\r\n    appendData(idata) {\r\n        this.data = appendByteArray(this.data, idata);\r\n    }\r\n\r\n    toString() {\r\n        return `${NALU.type(this)}(${this.data.byteLength}): NRI: ${this.getNri()}, PTS: ${this.pts}, DTS: ${this.dts}`;\r\n    }\r\n\r\n    getNri() {\r\n        return this.nri >> 5;\r\n    }\r\n\r\n    type() {\r\n        return this.ntype;\r\n    }\r\n\r\n    isKeyframe() {\r\n        return this.ntype === NALU.IDR || this.sliceType === 7;\r\n    }\r\n\r\n    getSize() {\r\n        return 4 + 1 + this.data.byteLength;\r\n    }\r\n\r\n    getData() {\r\n        let header = new Uint8Array(5 + this.data.byteLength);\r\n        let view = new DataView(header.buffer);\r\n        view.setUint32(0, this.data.byteLength + 1);\r\n        view.setUint8(4, (0x0 & 0x80) | (this.nri & 0x60) | (this.ntype & 0x1F));\r\n        header.set(this.data, 5);\r\n        return header;\r\n    }\r\n}\r\n","import {ExpGolomb} from '../util/exp-golomb.js';\r\nimport {NALU} from '../elementary/NALU.js';\r\n\r\nexport class H264Parser {\r\n\r\n    constructor(remuxer) {\r\n        this.remuxer = remuxer;\r\n        this.track = remuxer.mp4track;\r\n        this.firstFound = false;\r\n    }\r\n\r\n    msToScaled(timestamp) {\r\n        return (timestamp - this.remuxer.timeOffset) * this.remuxer.scaleFactor;\r\n    }\r\n\r\n    parseSPS(sps) {\r\n        var config = H264Parser.readSPS(new Uint8Array(sps));\r\n\r\n        this.track.width = config.width;\r\n        this.track.height = config.height;\r\n        this.track.sps = [new Uint8Array(sps)];\r\n        // this.track.timescale = this.remuxer.timescale;\r\n        // this.track.duration = this.remuxer.timescale; // TODO: extract duration for non-live client\r\n        this.track.codec = 'avc1.';\r\n\r\n        let codecarray = new DataView(sps.buffer, sps.byteOffset+1, 4);\r\n        for (let i = 0; i < 3; ++i) {\r\n            var h = codecarray.getUint8(i).toString(16);\r\n            if (h.length < 2) {\r\n                h = '0' + h;\r\n            }\r\n            this.track.codec  += h;\r\n        }\r\n    }\r\n\r\n    parsePPS(pps) {\r\n        this.track.pps = [new Uint8Array(pps)];\r\n    }\r\n\r\n    parseNAL(unit) {\r\n        if (!unit) return false;\r\n        \r\n        let push = null;\r\n        // console.log(unit.toString());\r\n        switch (unit.type()) {\r\n            case NALU.NDR:\r\n            case NALU.IDR:\r\n                unit.sliceType = H264Parser.parceSliceHeader(unit.data);\r\n                if (unit.isKeyframe() && !this.firstFound)  {\r\n                    this.firstFound = true;\r\n                }\r\n                if (this.firstFound) {\r\n                    push = true;\r\n                } else {\r\n                    push = false;\r\n                }\r\n                break;\r\n            case NALU.PPS:\r\n                push = false;\r\n                if (!this.track.pps) {\r\n                    this.parsePPS(unit.getData().subarray(4));\r\n                    if (!this.remuxer.readyToDecode && this.track.pps && this.track.sps) {\r\n                        this.remuxer.readyToDecode = true;\r\n                    }\r\n                }\r\n                break;\r\n            case NALU.SPS:\r\n                push = false;\r\n                if(!this.track.sps) {\r\n                    this.parseSPS(unit.getData().subarray(4));\r\n                    if (!this.remuxer.readyToDecode && this.track.pps && this.track.sps) {\r\n                        this.remuxer.readyToDecode = true;\r\n                    }\r\n                }\r\n                break;\r\n            case NALU.SEI:\r\n                push = false;\r\n                let data = new DataView(unit.data.buffer, unit.data.byteOffset, unit.data.byteLength);\r\n                let byte_idx = 0;\r\n                let pay_type = data.getUint8(byte_idx);\r\n                ++byte_idx;\r\n                let pay_size = 0;\r\n                let sz = data.getUint8(byte_idx);\r\n                ++byte_idx;\r\n                while (sz === 255) {\r\n                    pay_size+=sz;\r\n                    sz = data.getUint8(byte_idx);\r\n                    ++byte_idx;\r\n                }\r\n                pay_size+=sz;\r\n\r\n                let uuid = unit.data.subarray(byte_idx, byte_idx+16);\r\n                byte_idx+=16;\r\n                console.log(`PT: ${pay_type}, PS: ${pay_size}, UUID: ${Array.from(uuid).map(function(i) {\r\n                    return ('0' + i.toString(16)).slice(-2);\r\n                }).join('')}`);\r\n                // debugger;\r\n                break;\r\n            case NALU.EOSEQ:\r\n            case NALU.EOSTR:\r\n                push = false;\r\n            default:\r\n        }\r\n        if (push === null && unit.getNri() > 0 ) {\r\n            push=true;\r\n        }\r\n        return push;\r\n    }\r\n\r\n    static parceSliceHeader(data) {\r\n        let decoder = new ExpGolomb(data);\r\n        let first_mb = decoder.readUEG();\r\n        let slice_type = decoder.readUEG();\r\n        let ppsid = decoder.readUEG();\r\n        let frame_num = decoder.readUByte();\r\n        // console.log(`first_mb: ${first_mb}, slice_type: ${slice_type}, ppsid: ${ppsid}, frame_num: ${frame_num}`);\r\n        return slice_type;\r\n    }\r\n\r\n    /**\r\n     * Advance the ExpGolomb decoder past a scaling list. The scaling\r\n     * list is optionally transmitted as part of a sequence parameter\r\n     * set and is not relevant to transmuxing.\r\n     * @param decoder {ExpGolomb} exp golomb decoder\r\n     * @param count {number} the number of entries in this scaling list\r\n     * @see Recommendation ITU-T H.264, Section 7.3.2.1.1.1\r\n     */\r\n    static skipScalingList(decoder, count) {\r\n        let lastScale = 8,\r\n            nextScale = 8,\r\n            deltaScale;\r\n        for (let j = 0; j < count; j++) {\r\n            if (nextScale !== 0) {\r\n                deltaScale = decoder.readEG();\r\n                nextScale = (lastScale + deltaScale + 256) % 256;\r\n            }\r\n            lastScale = (nextScale === 0) ? lastScale : nextScale;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Read a sequence parameter set and return some interesting video\r\n     * properties. A sequence parameter set is the H264 metadata that\r\n     * describes the properties of upcoming video frames.\r\n     * @param data {Uint8Array} the bytes of a sequence parameter set\r\n     * @return {object} an object with configuration parsed from the\r\n     * sequence parameter set, including the dimensions of the\r\n     * associated video frames.\r\n     */\r\n    static readSPS(data) {\r\n        let decoder = new ExpGolomb(data);\r\n        let frameCropLeftOffset = 0,\r\n            frameCropRightOffset = 0,\r\n            frameCropTopOffset = 0,\r\n            frameCropBottomOffset = 0,\r\n            sarScale = 1,\r\n            profileIdc,profileCompat,levelIdc,\r\n            numRefFramesInPicOrderCntCycle, picWidthInMbsMinus1,\r\n            picHeightInMapUnitsMinus1,\r\n            frameMbsOnlyFlag,\r\n            scalingListCount;\r\n        decoder.readUByte();\r\n        profileIdc = decoder.readUByte(); // profile_idc\r\n        profileCompat = decoder.readBits(5); // constraint_set[0-4]_flag, u(5)\r\n        decoder.skipBits(3); // reserved_zero_3bits u(3),\r\n        levelIdc = decoder.readUByte(); //level_idc u(8)\r\n        decoder.skipUEG(); // seq_parameter_set_id\r\n        // some profiles have more optional data we don't need\r\n        if (profileIdc === 100 ||\r\n            profileIdc === 110 ||\r\n            profileIdc === 122 ||\r\n            profileIdc === 244 ||\r\n            profileIdc === 44  ||\r\n            profileIdc === 83  ||\r\n            profileIdc === 86  ||\r\n            profileIdc === 118 ||\r\n            profileIdc === 128) {\r\n            var chromaFormatIdc = decoder.readUEG();\r\n            if (chromaFormatIdc === 3) {\r\n                decoder.skipBits(1); // separate_colour_plane_flag\r\n            }\r\n            decoder.skipUEG(); // bit_depth_luma_minus8\r\n            decoder.skipUEG(); // bit_depth_chroma_minus8\r\n            decoder.skipBits(1); // qpprime_y_zero_transform_bypass_flag\r\n            if (decoder.readBoolean()) { // seq_scaling_matrix_present_flag\r\n                scalingListCount = (chromaFormatIdc !== 3) ? 8 : 12;\r\n                for (let i = 0; i < scalingListCount; ++i) {\r\n                    if (decoder.readBoolean()) { // seq_scaling_list_present_flag[ i ]\r\n                        if (i < 6) {\r\n                            H264Parser.skipScalingList(decoder, 16);\r\n                        } else {\r\n                            H264Parser.skipScalingList(decoder, 64);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        decoder.skipUEG(); // log2_max_frame_num_minus4\r\n        var picOrderCntType = decoder.readUEG();\r\n        if (picOrderCntType === 0) {\r\n            decoder.readUEG(); //log2_max_pic_order_cnt_lsb_minus4\r\n        } else if (picOrderCntType === 1) {\r\n            decoder.skipBits(1); // delta_pic_order_always_zero_flag\r\n            decoder.skipEG(); // offset_for_non_ref_pic\r\n            decoder.skipEG(); // offset_for_top_to_bottom_field\r\n            numRefFramesInPicOrderCntCycle = decoder.readUEG();\r\n            for(let i = 0; i < numRefFramesInPicOrderCntCycle; ++i) {\r\n                decoder.skipEG(); // offset_for_ref_frame[ i ]\r\n            }\r\n        }\r\n        decoder.skipUEG(); // max_num_ref_frames\r\n        decoder.skipBits(1); // gaps_in_frame_num_value_allowed_flag\r\n        picWidthInMbsMinus1 = decoder.readUEG();\r\n        picHeightInMapUnitsMinus1 = decoder.readUEG();\r\n        frameMbsOnlyFlag = decoder.readBits(1);\r\n        if (frameMbsOnlyFlag === 0) {\r\n            decoder.skipBits(1); // mb_adaptive_frame_field_flag\r\n        }\r\n        decoder.skipBits(1); // direct_8x8_inference_flag\r\n        if (decoder.readBoolean()) { // frame_cropping_flag\r\n            frameCropLeftOffset = decoder.readUEG();\r\n            frameCropRightOffset = decoder.readUEG();\r\n            frameCropTopOffset = decoder.readUEG();\r\n            frameCropBottomOffset = decoder.readUEG();\r\n        }\r\n        if (decoder.readBoolean()) {\r\n            // vui_parameters_present_flag\r\n            if (decoder.readBoolean()) {\r\n                // aspect_ratio_info_present_flag\r\n                let sarRatio;\r\n                const aspectRatioIdc = decoder.readUByte();\r\n                switch (aspectRatioIdc) {\r\n                    case 1: sarRatio = [1,1]; break;\r\n                    case 2: sarRatio = [12,11]; break;\r\n                    case 3: sarRatio = [10,11]; break;\r\n                    case 4: sarRatio = [16,11]; break;\r\n                    case 5: sarRatio = [40,33]; break;\r\n                    case 6: sarRatio = [24,11]; break;\r\n                    case 7: sarRatio = [20,11]; break;\r\n                    case 8: sarRatio = [32,11]; break;\r\n                    case 9: sarRatio = [80,33]; break;\r\n                    case 10: sarRatio = [18,11]; break;\r\n                    case 11: sarRatio = [15,11]; break;\r\n                    case 12: sarRatio = [64,33]; break;\r\n                    case 13: sarRatio = [160,99]; break;\r\n                    case 14: sarRatio = [4,3]; break;\r\n                    case 15: sarRatio = [3,2]; break;\r\n                    case 16: sarRatio = [2,1]; break;\r\n                    case 255: {\r\n                        sarRatio = [decoder.readUByte() << 8 | decoder.readUByte(), decoder.readUByte() << 8 | decoder.readUByte()];\r\n                        break;\r\n                    }\r\n                }\r\n                if (sarRatio) {\r\n                    sarScale = sarRatio[0] / sarRatio[1];\r\n                }\r\n            }\r\n            if (decoder.readBoolean()) {decoder.skipBits(1);}\r\n\r\n            if (decoder.readBoolean()) {\r\n                decoder.skipBits(4);\r\n                if (decoder.readBoolean()) {\r\n                    decoder.skipBits(24);\r\n                }\r\n            }\r\n            if (decoder.readBoolean()) {\r\n                decoder.skipUEG();\r\n                decoder.skipUEG();\r\n            }\r\n            if (decoder.readBoolean()) {\r\n                let unitsInTick = decoder.readUInt();\r\n                let timeScale = decoder.readUInt();\r\n                let fixedFrameRate = decoder.readBoolean();\r\n                let frameDuration = timeScale/(2*unitsInTick);\r\n                console.log(`timescale: ${timeScale}; unitsInTick: ${unitsInTick}; fixedFramerate: ${fixedFrameRate}; avgFrameDuration: ${frameDuration}`);\r\n            }\r\n        }\r\n        return {\r\n            width: Math.ceil((((picWidthInMbsMinus1 + 1) * 16) - frameCropLeftOffset * 2 - frameCropRightOffset * 2) * sarScale),\r\n            height: ((2 - frameMbsOnlyFlag) * (picHeightInMapUnitsMinus1 + 1) * 16) - ((frameMbsOnlyFlag? 2 : 4) * (frameCropTopOffset + frameCropBottomOffset))\r\n        };\r\n    }\r\n\r\n    static readSliceType(decoder) {\r\n        // skip NALu type\r\n        decoder.readUByte();\r\n        // discard first_mb_in_slice\r\n        decoder.readUEG();\r\n        // return slice_type\r\n        return decoder.readUEG();\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {H264Parser} from '../parsers/h264.js';\r\nimport {BaseRemuxer} from './base.js';\r\n\r\nconst Log = getTagged(\"remuxer:h264\"); \r\n// TODO: asm.js\r\nexport class H264Remuxer extends BaseRemuxer {\r\n\r\n    constructor(timescale, scaleFactor=1, params={}) {\r\n        super(timescale, scaleFactor);\r\n\r\n        this.nextDts = undefined;\r\n        this.readyToDecode = false;\r\n        this.initialized = false;\r\n\r\n        this.firstDTS=0;\r\n        this.firstPTS=0;\r\n        this.lastDTS=undefined;\r\n        this.lastSampleDuration = 0;\r\n        this.lastDurations = [];\r\n        // this.timescale = 90000;\r\n        this.tsAlign = Math.round(this.timescale/60);\r\n\r\n        this.mp4track={\r\n            id:BaseRemuxer.getTrackID(),\r\n            type: 'video',\r\n            len:0,\r\n            fragmented:true,\r\n            sps:'',\r\n            pps:'',\r\n            width:0,\r\n            height:0,\r\n            timescale: timescale,\r\n            duration: timescale,\r\n            samples: []\r\n        };\r\n        this.samples = [];\r\n        this.lastGopDTS = -99999999999999;\r\n        this.gop=[];\r\n        this.firstUnit = true;\r\n\r\n        this.h264 = new H264Parser(this);\r\n\r\n        if (params.sps) {\r\n            let arr = new Uint8Array(params.sps);\r\n            if ((arr[0] & 0x1f) === 7) {\r\n                this.setSPS(arr);\r\n            } else {\r\n                Log.warn(\"bad SPS in SDP\")\r\n            }\r\n        }\r\n        if (params.pps) {\r\n            let arr = new Uint8Array(params.pps);\r\n            if ((arr[0] & 0x1f) === 8) {\r\n                this.setPPS(arr);\r\n            } else {\r\n                Log.warn(\"bad PPS in SDP\")\r\n            }\r\n        }\r\n\r\n        if (this.mp4track.pps && this.mp4track.sps) {\r\n            this.readyToDecode = true;\r\n        }\r\n    }\r\n\r\n    _scaled(timestamp) {\r\n        return timestamp >>> this.scaleFactor;\r\n    }\r\n\r\n    _unscaled(timestamp) {\r\n        return timestamp << this.scaleFactor;\r\n    }\r\n\r\n    setSPS(sps) {\r\n        this.h264.parseSPS(sps);\r\n    }\r\n\r\n    setPPS(pps) {\r\n        this.h264.parsePPS(pps);\r\n    }\r\n\r\n    remux(nalu) {\r\n        if (this.lastGopDTS < nalu.dts) {\r\n            this.gop.sort(BaseRemuxer.dtsSortFunc);\r\n            for (let unit of this.gop) {\r\n                // if (this.firstUnit) {\r\n                //     unit.ntype = 5;//NALU.IDR;\r\n                //     this.firstUnit = false;\r\n                // }\r\n                if (super.remux.call(this, unit)) {\r\n                    this.mp4track.len += unit.getSize();\r\n                }\r\n            }\r\n            this.gop = [];\r\n            this.lastGopDTS = nalu.dts\r\n        }\r\n        if (this.h264.parseNAL(nalu)) {\r\n            this.gop.push(nalu);\r\n        }\r\n    }\r\n\r\n    getPayload() {\r\n        if (!this.getPayloadBase()) {\r\n            return null;\r\n        }\r\n\r\n        let payload = new Uint8Array(this.mp4track.len);\r\n        let offset = 0;\r\n        let samples=this.mp4track.samples;\r\n        let mp4Sample, lastDTS, pts, dts;\r\n\r\n\r\n        // Log.debug(this.samples.map((e)=>{\r\n        //     return Math.round((e.dts - this.initDTS));\r\n        // }));\r\n\r\n        // let minDuration = Number.MAX_SAFE_INTEGER;\r\n        while (this.samples.length) {\r\n            let sample = this.samples.shift();\r\n            if (sample === null) {\r\n                // discontinuity\r\n                this.nextDts = undefined;\r\n                break;\r\n            }\r\n\r\n            let unit = sample.unit;\r\n            \r\n            pts = sample.pts- this.initDTS; // /*Math.round(*/(sample.pts - this.initDTS)/*/this.tsAlign)*this.tsAlign*/;\r\n            dts = sample.dts - this.initDTS; ///*Math.round(*/(sample.dts - this.initDTS)/*/this.tsAlign)*this.tsAlign*/;\r\n            // ensure DTS is not bigger than PTS\r\n            dts = Math.min(pts,dts);\r\n            // if not first AVC sample of video track, normalize PTS/DTS with previous sample value\r\n            // and ensure that sample duration is positive\r\n            if (lastDTS !== undefined) {\r\n                let sampleDuration = this.scaled(dts - lastDTS);\r\n                // Log.debug(`Sample duration: ${sampleDuration}`);\r\n                if (sampleDuration < 0) {\r\n                    Log.log(`invalid AVC sample duration at PTS/DTS: ${pts}/${dts}|lastDTS: ${lastDTS}:${sampleDuration}`);\r\n                    this.mp4track.len -= unit.getSize();\r\n                    continue;\r\n                }\r\n                // minDuration = Math.min(sampleDuration, minDuration);\r\n                this.lastDurations.push(sampleDuration);\r\n                if (this.lastDurations.length > 100) {\r\n                    this.lastDurations.shift();\r\n                }\r\n                mp4Sample.duration = sampleDuration;\r\n            } else {\r\n                if (this.nextDts) {\r\n                    let delta = dts - this.nextDts;\r\n                    // if fragment are contiguous, or delta less than 600ms, ensure there is no overlap/hole between fragments\r\n                    if (/*contiguous ||*/ Math.abs(Math.round(BaseRemuxer.toMS(delta))) < 600) {\r\n\r\n                        if (delta) {\r\n                            // set DTS to next DTS\r\n                            // Log.debug(`Video/PTS/DTS adjusted: ${pts}->${Math.max(pts - delta, this.nextDts)}/${dts}->${this.nextDts},delta:${delta}`);\r\n                            dts = this.nextDts;\r\n                            // offset PTS as well, ensure that PTS is smaller or equal than new DTS\r\n                            pts = Math.max(pts - delta, dts);\r\n                        }\r\n                    } else {\r\n                        if (delta < 0) {\r\n                            Log.log(`skip frame from the past at DTS=${dts} with expected DTS=${this.nextDts}`);\r\n                            this.mp4track.len -= unit.getSize();\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n                // remember first DTS of our avcSamples, ensure value is positive\r\n                this.firstDTS = Math.max(0, dts);\r\n            }\r\n\r\n            mp4Sample = {\r\n                size: unit.getSize(),\r\n                duration: 0,\r\n                cts: this.scaled(pts - dts),\r\n                flags: {\r\n                    isLeading: 0,\r\n                    isDependedOn: 0,\r\n                    hasRedundancy: 0,\r\n                    degradPrio: 0\r\n                }\r\n            };\r\n            let flags = mp4Sample.flags;\r\n            if (sample.unit.isKeyframe() === true) {\r\n                // the current sample is a key frame\r\n                flags.dependsOn = 2;\r\n                flags.isNonSync = 0;\r\n            } else {\r\n                flags.dependsOn = 1;\r\n                flags.isNonSync = 1;\r\n            }\r\n\r\n            payload.set(unit.getData(), offset);\r\n            offset += unit.getSize();\r\n\r\n            samples.push(mp4Sample);\r\n            lastDTS = dts;\r\n        }\r\n\r\n        if (!samples.length) return null;\r\n\r\n        let avgDuration = this.lastDurations.reduce(function(a, b) { return (a|0) + (b|0); }, 0) / (this.lastDurations.length||1)|0;\r\n        if (samples.length >= 2) {\r\n            this.lastSampleDuration = avgDuration;\r\n            mp4Sample.duration = avgDuration;\r\n        } else {\r\n            mp4Sample.duration = this.lastSampleDuration;\r\n        }\r\n\r\n        if(samples.length && (!this.nextDts || navigator.userAgent.toLowerCase().indexOf('chrome') > -1)) {\r\n            let flags = samples[0].flags;\r\n            // chrome workaround, mark first sample as being a Random Access Point to avoid sourcebuffer append issue\r\n            // https://code.google.com/p/chromium/issues/detail?id=229412\r\n            flags.dependsOn = 2;\r\n            flags.isNonSync = 0;\r\n        }\r\n\r\n        // next AVC sample DTS should be equal to last sample DTS + last sample duration\r\n        this.nextDts = dts + this.unscaled(this.lastSampleDuration);\r\n        // Log.debug(`next dts: ${this.nextDts}, last duration: ${this.lastSampleDuration}, last dts: ${dts}`);\r\n\r\n        return new Uint8Array(payload.buffer, 0, this.mp4track.len);\r\n    }\r\n}\r\n","export class StreamType {\r\n    static get VIDEO() {return 1;}\r\n    static get AUDIO() {return 2;}\r\n\r\n    static get map() {return {\r\n        [StreamType.VIDEO]: 'video',\r\n        [StreamType.AUDIO]: 'audio'\r\n    }};\r\n}\r\n\r\nexport class PayloadType {\r\n    static get H264() {return 1;}\r\n    static get AAC() {return 2;}\r\n\r\n    static get map() {return {\r\n        [PayloadType.H264]: 'video',\r\n        [PayloadType.AAC]: 'audio'\r\n    }};\r\n\r\n    static get string_map() {return  {\r\n        H264: PayloadType.H264,\r\n        AAC: PayloadType.AAC,\r\n        'MP4A-LATM': PayloadType.AAC,\r\n        'MPEG4-GENERIC': PayloadType.AAC\r\n    }}\r\n}","import {EventEmitter, EventSourceWrapper} from '../../deps/bp_event.js';\r\nimport {getTagged} from \"../../deps/bp_logger.js\";\r\nimport {MP4} from '../iso-bmff/mp4-generator.js';\r\nimport {AACRemuxer} from './aac.js';\r\nimport {H264Remuxer} from './h264.js';\r\nimport {MSE} from '../presentation/mse.js';\r\nimport {PayloadType} from \"../defs.js\";\r\n\r\nconst LOG_TAG = \"remuxer\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class Remuxer {\r\n    static get TrackConverters() {return {\r\n        [PayloadType.H264]: H264Remuxer,\r\n        [PayloadType.AAC]:  AACRemuxer\r\n    }};\r\n\r\n    static get TrackScaleFactor() {return {\r\n        [PayloadType.H264]: 1,//4,\r\n        [PayloadType.AAC]:  0\r\n    }};\r\n\r\n    static get TrackTimescale() {return {\r\n        [PayloadType.H264]: 90000,//22500,\r\n        [PayloadType.AAC]:  0\r\n    }};\r\n\r\n    constructor(mediaElement) {\r\n        this.mse = new MSE([mediaElement]);\r\n        this.eventSource = new EventEmitter();\r\n        this.mseEventSource = new EventSourceWrapper(this.mse.eventSource);\r\n        this.mse_ready = true;\r\n\r\n        this.reset();\r\n\r\n        this.errorListener = this.mseClose.bind(this);\r\n        this.closeListener = this.mseClose.bind(this);\r\n        this.errorDecodeListener = this.mseErrorDecode.bind(this);\r\n\r\n        this.eventSource.addEventListener('ready', this.init.bind(this));\r\n    }\r\n\r\n    initMSEHandlers() {\r\n        this.mseEventSource.on('error', this.errorListener);\r\n        this.mseEventSource.on('sourceclosed', this.closeListener);\r\n        this.mseEventSource.on('errordecode', this.errorDecodeListener);\r\n    }\r\n\r\n    async reset() {\r\n        this.tracks = {};\r\n        this.initialized = false;\r\n        this.initSegments = {};\r\n        this.codecs = [];\r\n        this.streams = {};\r\n        this.enabled = false;\r\n        await this.mse.clear();\r\n        this.initMSEHandlers();\r\n    }\r\n\r\n    destroy() {\r\n        this.mseEventSource.destroy();\r\n        this.mse.destroy();\r\n        this.mse = null;\r\n\r\n        this.detachClient();\r\n\r\n        this.eventSource.destroy();\r\n    }\r\n\r\n    onTracks(tracks) {\r\n        Log.debug(`ontracks: `, tracks.detail);\r\n        // store available track types\r\n        for (let track of tracks.detail) {\r\n            this.tracks[track.type] = new Remuxer.TrackConverters[track.type](Remuxer.TrackTimescale[track.type], Remuxer.TrackScaleFactor[track.type], track.params);\r\n            if (track.offset) {\r\n                this.tracks[track.type].timeOffset = track.offset;\r\n            }\r\n            if (track.duration) {\r\n                this.tracks[track.type].mp4track.duration = track.duration*(this.tracks[track.type].timescale || Remuxer.TrackTimescale[track.type]);\r\n                this.tracks[track.type].duration = track.duration;\r\n            } else {\r\n                this.tracks[track.type].duration = 1;\r\n            }\r\n\r\n            // this.tracks[track.type].duration\r\n        }\r\n        this.mse.setLive(!this.client.seekable);\r\n    }\r\n\r\n    setTimeOffset(timeOffset, track) {\r\n        if (this.tracks[track.type]) {\r\n            this.tracks[track.type].timeOffset = timeOffset;///this.tracks[track.type].scaleFactor;\r\n        }\r\n    }\r\n\r\n    init() {\r\n        let tracks = [];\r\n        this.codecs = [];\r\n        let initmse = [];\r\n        let initPts = Infinity;\r\n        let initDts = Infinity;\r\n        for (let track_type in this.tracks) {\r\n            let track = this.tracks[track_type];\r\n            if (!MSE.isSupported([track.mp4track.codec])) {\r\n                throw new Error(`${track.mp4track.type} codec ${track.mp4track.codec} is not supported`);\r\n            }\r\n            tracks.push(track.mp4track);\r\n            this.codecs.push(track.mp4track.codec);\r\n            track.init(initPts, initDts/*, false*/);\r\n            // initPts = Math.min(track.initPTS, initPts);\r\n            // initDts = Math.min(track.initDTS, initDts);\r\n        }\r\n\r\n        for (let track_type in this.tracks) {\r\n            let track = this.tracks[track_type];\r\n            //track.init(initPts, initDts);\r\n            this.initSegments[track_type] = MP4.initSegment([track.mp4track], track.duration*track.timescale, track.timescale);\r\n            initmse.push(this.initMSE(track_type, track.mp4track.codec));\r\n        }\r\n        this.initialized = true;\r\n        return Promise.all(initmse).then(()=>{\r\n            //this.mse.play();\r\n            this.enabled = true;\r\n        });\r\n        \r\n    }\r\n\r\n    initMSE(track_type, codec) {\r\n        if (MSE.isSupported(this.codecs)) {\r\n            return this.mse.setCodec(track_type, `${PayloadType.map[track_type]}/mp4; codecs=\"${codec}\"`).then(()=>{\r\n                this.mse.feed(track_type, this.initSegments[track_type]);\r\n                // this.mse.play();\r\n                // this.enabled = true;\r\n            });\r\n        } else {\r\n            throw new Error('Codecs are not supported');\r\n        }\r\n    }\r\n\r\n    mseClose() {\r\n        // this.mse.clear();\r\n        this.client.stop();\r\n        this.eventSource.dispatchEvent('stopped');\r\n    }\r\n\r\n    mseErrorDecode() {\r\n        if(this.tracks[2]) {\r\n            console.warn(this.tracks[2].mp4track.type);\r\n            this.mse.buffers[2].destroy();\r\n            delete this.tracks[2];\r\n        }\r\n    }\r\n\r\n    flush() {\r\n        this.onSamples();\r\n\r\n        if (!this.initialized) {\r\n            // Log.debug(`Initialize...`);\r\n            if (Object.keys(this.tracks).length) {\r\n                for (let track_type in this.tracks) {\r\n                    if (!this.tracks[track_type].readyToDecode || !this.tracks[track_type].samples.length) return;\r\n                    Log.debug(`Init MSE for track ${this.tracks[track_type].mp4track.type}`);\r\n                }\r\n                this.eventSource.dispatchEvent('ready');\r\n            }\r\n        } else {\r\n            for (let track_type in this.tracks) {\r\n                let track = this.tracks[track_type];\r\n                let pay = track.getPayload();\r\n                if (pay && pay.byteLength) {\r\n                    this.mse.feed(track_type, [MP4.moof(track.seq, track.scaled(track.firstDTS), track.mp4track), MP4.mdat(pay)]);\r\n                    track.flush();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onSamples(ev) {\r\n        // TODO: check format\r\n        // let data = ev.detail;\r\n        // if (this.tracks[data.pay] && this.client.sampleQueues[data.pay].length) {\r\n            // console.log(`video ${data.units[0].dts}`);\r\n        for (let qidx in this.client.sampleQueues) {\r\n            let queue = this.client.sampleQueues[qidx];\r\n            while (queue.length) {\r\n                let units = queue.shift();\r\n                if(units){\r\n                    for (let chunk of units) {\r\n                        if(this.tracks[qidx]) {\r\n                            this.tracks[qidx].remux(chunk);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (!this.initialized) {\r\n                        delete this.tracks[qidx];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        // }\r\n    }\r\n\r\n    onAudioConfig(ev) {\r\n        if (this.tracks[ev.detail.pay]) {\r\n            this.tracks[ev.detail.pay].setConfig(ev.detail.config);\r\n        }\r\n    }\r\n\r\n    attachClient(client) {\r\n        this.detachClient();\r\n        this.client = client;\r\n        this.clientEventSource = new EventSourceWrapper(this.client.eventSource);\r\n        this.clientEventSource.on('samples', this.samplesListener);\r\n        this.clientEventSource.on('audio_config', this.audioConfigListener);\r\n        this.clientEventSource.on('tracks', this.onTracks.bind(this));\r\n        this.clientEventSource.on('flush', this.flush.bind(this));\r\n        this.clientEventSource.on('clear', ()=>{\r\n            this.reset();\r\n            this.mse.clear().then(()=>{\r\n                //this.mse.play();\r\n                this.initMSEHandlers();\r\n            });\r\n        });\r\n    }\r\n\r\n    detachClient() {\r\n        if (this.client) {\r\n            this.clientEventSource.destroy();\r\n            // this.client.eventSource.removeEventListener('samples', this.onSamples.bind(this));\r\n            // this.client.eventSource.removeEventListener('audio_config', this.onAudioConfig.bind(this));\r\n            // // TODO: clear other listeners\r\n            // this.client.eventSource.removeEventListener('clear', this._clearListener);\r\n            // this.client.eventSource.removeEventListener('tracks', this._tracksListener);\r\n            // this.client.eventSource.removeEventListener('flush', this._flushListener);\r\n            this.client = null;\r\n        }\r\n    }\r\n}","class State {\n    constructor(name, stateMachine) {\n        this.stateMachine = stateMachine;\n        this.transitions = new Set();\n        this.name = name;\n    }\n\n\n    activate() {\n        return Promise.resolve(null);\n    }\n\n    finishTransition() {}\n\n    failHandler() {}\n\n    deactivate() {\n        return Promise.resolve(null);\n    }\n}\n\nexport class StateMachine {\n    constructor() {\n        this.storage = {};\n        this.currentState = null;\n        this.states = new Map();\n    }\n\n    addState(name, {activate, finishTransition, deactivate}) {\n        let state = new State(name, this);\n        if (activate) state.activate = activate;\n        if (finishTransition) state.finishTransition = finishTransition;\n        if (deactivate) state.deactivate = deactivate;\n        this.states.set(name, state);\n        return this;\n    }\n\n    addTransition(fromName, toName){\n        if (!this.states.has(fromName)) {\n            throw ReferenceError(`No such state: ${fromName} while connecting to ${toName}`);\n        }\n        if (!this.states.has(toName)) {\n            throw ReferenceError(`No such state: ${toName} while connecting from ${fromName}`);\n        }\n        this.states.get(fromName).transitions.add(toName);\n        return this;\n    }\n\n    _promisify(res) {\n        let promise;\n        try {\n            promise = res;\n            if (!promise.then) {\n                promise = Promise.resolve(promise);\n            }\n        } catch (e) {\n            promise = Promise.reject(e);\n        }\n        return promise;\n    }\n\n    transitionTo(stateName) {\n        if (this.currentState == null) {\n            let state = this.states.get(stateName);\n            return this._promisify(state.activate.call(this))\n                .then((data)=> {\n                    this.currentState = state;\n                    return data;\n                }).then(state.finishTransition.bind(this)).catch((e)=>{\n                    state.failHandler();\n                    throw e;\n                });\n        }\n        if (this.currentState.name == stateName) return Promise.resolve();\n        if (this.currentState.transitions.has(stateName)) {\n            let state = this.states.get(stateName);\n            return this._promisify(state.deactivate.call(this))\n                .then(state.activate.bind(this)).then((data)=> {\n                    this.currentState = state;\n                    return data;\n                }).then(state.finishTransition.bind(this)).catch((e)=>{\n                    state.failHandler();\n                    throw e;\n                });\n        } else {\n            return Promise.reject(`No such transition: ${this.currentState.name} to ${stateName}`);\n        }\n    }\n\n}\n","// export * from 'bp_statemachine';\r\nexport * from '../../node_modules/bp_statemachine/statemachine.js';","import {getTagged} from '../../deps/bp_logger';\r\nimport {PayloadType} from '../defs.js';\r\n\r\nconst Log = getTagged(\"parser:sdp\");\r\n\r\nexport class SDPParser {\r\n    constructor() {\r\n        this.version = -1;\r\n        this.origin = null;\r\n        this.sessionName = null;\r\n        this.timing = null;\r\n        this.sessionBlock = {};\r\n        this.media = {};\r\n        this.tracks = {};\r\n        this.mediaMap = {};\r\n    }\r\n\r\n    parse(content) {\r\n        // Log.debug(content);\r\n        return new Promise((resolve, reject) => {\r\n            var dataString = content;\r\n            var success = true;\r\n            var currentMediaBlock = this.sessionBlock;\r\n\r\n            // TODO: multiple audio/video tracks\r\n\r\n            for (let line of dataString.split(\"\\n\")) {\r\n                line = line.replace(/\\r/, '');\r\n                if (0 === line.length) {\r\n                    /* Empty row (last row perhaps?), skip to next */\r\n                    continue;\r\n                }\r\n\r\n                switch (line.charAt(0)) {\r\n                    case 'v':\r\n                        if (-1 !== this.version) {\r\n                            Log.log('Version present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseVersion(line);\r\n                        break;\r\n\r\n                    case 'o':\r\n                        if (null !== this.origin) {\r\n                            Log.log('Origin present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseOrigin(line);\r\n                        break;\r\n\r\n                    case 's':\r\n                        if (null !== this.sessionName) {\r\n                            Log.log('Session Name present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseSessionName(line);\r\n                        break;\r\n\r\n                    case 't':\r\n                        if (null !== this.timing) {\r\n                            Log.log('Timing present multiple times in SDP');\r\n                            reject();\r\n                            return false;\r\n                        }\r\n                        success = success && this._parseTiming(line);\r\n                        break;\r\n\r\n                    case 'm':\r\n                        if (null !== currentMediaBlock && this.sessionBlock !== currentMediaBlock) {\r\n                            /* Complete previous block and store it */\r\n                            this.media[currentMediaBlock.type] = currentMediaBlock;\r\n                        }\r\n\r\n                        /* A wild media block appears */\r\n                        currentMediaBlock = {};\r\n                        currentMediaBlock.rtpmap = {};\r\n                        this._parseMediaDescription(line, currentMediaBlock);\r\n                        break;\r\n\r\n                    case 'a':\r\n                        SDPParser._parseAttribute(line, currentMediaBlock);\r\n                        break;\r\n\r\n                    default:\r\n                        Log.log('Ignored unknown SDP directive: ' + line);\r\n                        break;\r\n                }\r\n\r\n                if (!success) {\r\n                    reject();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.media[currentMediaBlock.type] = currentMediaBlock;\r\n\r\n            success ? resolve() : reject();\r\n        });\r\n    }\r\n\r\n    _parseVersion(line) {\r\n        let matches = line.match(/^v=([0-9]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'v=\\' (Version) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.version = matches[1];\r\n        if (0 != this.version) {\r\n            Log.log('Unsupported SDP version:' + this.version);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseOrigin(line) {\r\n        let matches = line.match(/^o=([^ ]+) (-?[0-9]+) (-?[0-9]+) (IN) (IP4|IP6) ([^ ]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'o=\\' (Origin) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.origin = {};\r\n        this.origin.username = matches[1];\r\n        this.origin.sessionid = matches[2];\r\n        this.origin.sessionversion = matches[3];\r\n        this.origin.nettype = matches[4];\r\n        this.origin.addresstype = matches[5];\r\n        this.origin.unicastaddress = matches[6];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseSessionName(line) {\r\n        let matches = line.match(/^s=([^\\r\\n]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'s=\\' (Session Name) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.sessionName = matches[1];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseTiming(line) {\r\n        let matches = line.match(/^t=([0-9]+) ([0-9]+)$/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'t=\\' (Timing) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        this.timing = {};\r\n        this.timing.start = matches[1];\r\n        this.timing.stop = matches[2];\r\n\r\n        return true;\r\n    }\r\n\r\n    _parseMediaDescription(line, media) {\r\n        let matches = line.match(/^m=([^ ]+) ([^ ]+) ([^ ]+)[ ]/);\r\n        if (!matches || !matches.length) {\r\n            Log.log('\\'m=\\' (Media) formatted incorrectly: ' + line);\r\n            return false;\r\n        }\r\n\r\n        media.type = matches[1];\r\n        media.port = matches[2];\r\n        media.proto = matches[3];\r\n        media.fmt = line.substr(matches[0].length).split(' ').map(function (fmt, index, array) {\r\n            return parseInt(fmt);\r\n        });\r\n\r\n        for (let fmt of media.fmt) {\r\n            this.mediaMap[fmt] = media;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    static _parseAttribute(line, media) {\r\n        if (null === media) {\r\n            /* Not in a media block, can't be bothered parsing attributes for session */\r\n            return true;\r\n        }\r\n\r\n        var matches;\r\n        /* Used for some cases of below switch-case */\r\n        var separator = line.indexOf(':');\r\n        var attribute = line.substr(0, (-1 === separator) ? 0x7FFFFFFF : separator);\r\n        /* 0x7FF.. is default */\r\n\r\n        switch (attribute) {\r\n            case 'a=recvonly':\r\n            case 'a=sendrecv':\r\n            case 'a=sendonly':\r\n            case 'a=inactive':\r\n                media.mode = line.substr('a='.length);\r\n                break;\r\n            case 'a=range':\r\n                matches = line.match(/^a=range:\\s*([a-zA-Z-]+)=([0-9.]+|now)\\s*-\\s*([0-9.]*)$/);\r\n                media.range = [Number(matches[2] == \"now\" ? -1 : matches[2]), Number(matches[3]), matches[1]];\r\n                break;\r\n            case 'a=control':\r\n                media.control = line.substr('a=control:'.length);\r\n                break;\r\n\r\n            case 'a=rtpmap':\r\n                matches = line.match(/^a=rtpmap:(\\d+) (.*)$/);\r\n                if (null === matches) {\r\n                    Log.log('Could not parse \\'rtpmap\\' of \\'a=\\'');\r\n                    return false;\r\n                }\r\n\r\n                var payload = parseInt(matches[1]);\r\n                media.rtpmap[payload] = {};\r\n\r\n                var attrs = matches[2].split('/');\r\n                media.rtpmap[payload].name = attrs[0].toUpperCase();\r\n                media.rtpmap[payload].clock = attrs[1];\r\n                if (undefined !== attrs[2]) {\r\n                    media.rtpmap[payload].encparams = attrs[2];\r\n                }\r\n                media.ptype = PayloadType.string_map[attrs[0].toUpperCase()];\r\n\r\n                break;\r\n\r\n            case 'a=fmtp':\r\n                matches = line.match(/^a=fmtp:(\\d+) (.*)$/);\r\n                if (0 === matches.length) {\r\n                    Log.log('Could not parse \\'fmtp\\'  of \\'a=\\'');\r\n                    return false;\r\n                }\r\n\r\n                media.fmtp = {};\r\n                for (var param of matches[2].split(';')) {\r\n                    var idx = param.indexOf('=');\r\n                    media.fmtp[param.substr(0, idx).toLowerCase().trim()] = param.substr(idx + 1).trim();\r\n                }\r\n                break;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    getSessionBlock() {\r\n        return this.sessionBlock;\r\n    }\r\n\r\n    hasMedia(mediaType) {\r\n        return this.media[mediaType] != undefined;\r\n    }\r\n\r\n    getMediaBlock(mediaType) {\r\n        return this.media[mediaType];\r\n    }\r\n\r\n    getMediaBlockByPayloadType(pt) {\r\n        // for (var m in this.media) {\r\n        //     if (-1 !== this.media[m].fmt.indexOf(pt)) {\r\n        //         return this.media[m];\r\n        //     }\r\n        // }\r\n        return this.mediaMap[pt] || null;\r\n\r\n        //ErrorManager.dispatchError(826, [pt], true);\r\n        // Log.error(`failed to find media with payload type ${pt}`);\r\n        //\r\n        // return null;\r\n    }\r\n\r\n    getMediaBlockList() {\r\n        var res = [];\r\n        for (var m in this.media) {\r\n            res.push(m);\r\n        }\r\n\r\n        return res;\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nimport {RTSPClientSM as RTSPClient} from './client.js';\r\nimport {Url} from '../../core/util/url.js';\r\nimport {RTSPError} from \"./client\";\r\n\r\nconst LOG_TAG = \"rtsp:stream\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTSPStream {\r\n\r\n    constructor(client, track) {\r\n        this.state = null;\r\n        this.client = client;\r\n        this.track = track;\r\n        this.rtpChannel = 1;\r\n\r\n        this.stopKeepAlive();\r\n        this.keepaliveInterval = null;\r\n        this.keepaliveTime = 30000;\r\n    }\r\n\r\n    reset() {\r\n        this.stopKeepAlive();\r\n        this.client.forgetRTPChannel(this.rtpChannel);\r\n        this.client = null;\r\n        this.track = null;\r\n    }\r\n\r\n    start() {\r\n        return this.sendSetup();//.then(this.sendPlay.bind(this));\r\n    }\r\n\r\n    stop() {\r\n        return this.sendTeardown();\r\n    }\r\n\r\n    getSetupURL(track) {\r\n        let sessionBlock = this.client.sdp.getSessionBlock();\r\n        if (Url.isAbsolute(track.control)) {\r\n            return track.control;\r\n        } else if (Url.isAbsolute(`${sessionBlock.control}${track.control}`)) {\r\n            return `${sessionBlock.control}${track.control}`;\r\n        } else if (Url.isAbsolute(`${this.client.contentBase}${track.control}`)) {\r\n            /* Should probably check session level control before this */\r\n            return `${this.client.contentBase}${track.control}`;\r\n        }\r\n        else {//need return default\r\n            return track.control;\r\n        }\r\n        Log.error('Can\\'t determine track URL from ' +\r\n            'block.control:' + track.control + ', ' +\r\n            'session.control:' + sessionBlock.control + ', and ' +\r\n            'content-base:' + this.client.contentBase);\r\n    }\r\n\r\n    getControlURL() {\r\n        let ctrl = this.client.sdp.getSessionBlock().control;\r\n        if (Url.isAbsolute(ctrl)) {\r\n            return ctrl;\r\n        } else if (!ctrl || '*' === ctrl) {\r\n            return this.client.contentBase;\r\n        } else {\r\n            return `${this.client.contentBase}${ctrl}`;\r\n        }\r\n    }\r\n\r\n    sendKeepalive() {\r\n        if (this.client.methods.includes('GET_PARAMETER')) {\r\n            return this.client.sendRequest('GET_PARAMETER', this.getSetupURL(this.track), {\r\n                'Session': this.session\r\n            });\r\n        } else {\r\n            return this.client.sendRequest('OPTIONS', '*');\r\n        }\r\n    }\r\n\r\n    stopKeepAlive() {\r\n        clearInterval(this.keepaliveInterval);\r\n    }\r\n\r\n    startKeepAlive() {\r\n        this.keepaliveInterval = setInterval(() => {\r\n            this.sendKeepalive().catch((e) => {\r\n                Log.error(e);\r\n                if (e instanceof RTSPError) {\r\n                    if (Number(e.data.parsed.code) == 501) {\r\n                        return;\r\n                    }\r\n                }\r\n                this.client.reconnect();\r\n            });\r\n        }, this.keepaliveTime);\r\n    }\r\n\r\n    sendRequest(_cmd, _params = {}) {\r\n        let params = {};\r\n        if (this.session) {\r\n            params['Session'] = this.session;\r\n        }\r\n        Object.assign(params, _params);\r\n        return this.client.sendRequest(_cmd, this.getControlURL(), params);\r\n    }\r\n\r\n    sendSetup() {\r\n        this.state = RTSPClient.STATE_SETUP;\r\n        this.rtpChannel = this.client.interleaveChannelIndex;\r\n        let interleavedChannels = this.client.interleaveChannelIndex++ + \"-\" + this.client.interleaveChannelIndex++;\r\n        return this.client.sendRequest('SETUP', this.getSetupURL(this.track), {\r\n            'Transport': `RTP/AVP/TCP;unicast;interleaved=${interleavedChannels}`,\r\n            'Date': new Date().toUTCString()\r\n        }).then((_data) => {\r\n            this.session = _data.headers['session'];\r\n            let transport = _data.headers['transport'];\r\n            if (transport) {\r\n                let interleaved = transport.match(/interleaved=([0-9]+)-([0-9]+)/)[1];\r\n                if (interleaved) {\r\n                    this.rtpChannel = Number(interleaved);\r\n                }\r\n            }\r\n            let sessionParamsChunks = this.session.split(';').slice(1);\r\n            let sessionParams = {};\r\n            for (let chunk of sessionParamsChunks) {\r\n                let kv = chunk.split('=');\r\n                sessionParams[kv[0]]=kv[1];\r\n            }\r\n            if (sessionParams['timeout']) {\r\n                this.keepaliveInterval = Number(sessionParams['timeout']) * 500; // * 1000 / 2\r\n            }\r\n            /*if (!/RTP\\/AVP\\/TCP;unicast;interleaved=/.test(_data.headers[\"transport\"])) {\r\n                // TODO: disconnect stream and notify client\r\n                throw new Error(\"Connection broken\");\r\n            }*/\r\n            this.client.useRTPChannel(this.rtpChannel);\r\n            this.startKeepAlive();\r\n            return {track: this.track, data: _data};\r\n        });\r\n    }\r\n}\r\n","/*\r\n * JavaScript MD5\r\n * https://github.com/blueimp/JavaScript-MD5\r\n *\r\n * Copyright 2011, Sebastian Tschan\r\n * https://blueimp.net\r\n *\r\n * Licensed under the MIT license:\r\n * https://opensource.org/licenses/MIT\r\n *\r\n * Based on\r\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\r\n * Digest Algorithm, as defined in RFC 1321.\r\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n * See http://pajhome.org.uk/crypt/md5 for more info.\r\n */\r\n\r\n\r\n/*\r\n* Add integers, wrapping at 2^32. This uses 16-bit operations internally\r\n* to work around bugs in some JS interpreters.\r\n*/\r\nfunction safeAdd(x, y) {\r\n    var lsw = (x & 0xFFFF) + (y & 0xFFFF)\r\n    var msw = (x >> 16) + (y >> 16) + (lsw >> 16)\r\n    return (msw << 16) | (lsw & 0xFFFF)\r\n}\r\n\r\n/*\r\n* Bitwise rotate a 32-bit number to the left.\r\n*/\r\nfunction bitRotateLeft(num, cnt) {\r\n    return (num << cnt) | (num >>> (32 - cnt))\r\n}\r\n\r\n/*\r\n* These functions implement the four basic operations the algorithm uses.\r\n*/\r\nfunction md5cmn(q, a, b, x, s, t) {\r\n    return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b)\r\n}\r\nfunction md5ff(a, b, c, d, x, s, t) {\r\n    return md5cmn((b & c) | ((~b) & d), a, b, x, s, t)\r\n}\r\nfunction md5gg(a, b, c, d, x, s, t) {\r\n    return md5cmn((b & d) | (c & (~d)), a, b, x, s, t)\r\n}\r\nfunction md5hh(a, b, c, d, x, s, t) {\r\n    return md5cmn(b ^ c ^ d, a, b, x, s, t)\r\n}\r\nfunction md5ii(a, b, c, d, x, s, t) {\r\n    return md5cmn(c ^ (b | (~d)), a, b, x, s, t)\r\n}\r\n\r\n/*\r\n* Calculate the MD5 of an array of little-endian words, and a bit length.\r\n*/\r\nfunction binlMD5(x, len) {\r\n    /* append padding */\r\n    x[len >> 5] |= 0x80 << (len % 32)\r\n    x[(((len + 64) >>> 9) << 4) + 14] = len\r\n\r\n    var i\r\n    var olda\r\n    var oldb\r\n    var oldc\r\n    var oldd\r\n    var a = 1732584193\r\n    var b = -271733879\r\n    var c = -1732584194\r\n    var d = 271733878\r\n\r\n    for (i = 0; i < x.length; i += 16) {\r\n        olda = a\r\n        oldb = b\r\n        oldc = c\r\n        oldd = d\r\n\r\n        a = md5ff(a, b, c, d, x[i], 7, -680876936)\r\n        d = md5ff(d, a, b, c, x[i + 1], 12, -389564586)\r\n        c = md5ff(c, d, a, b, x[i + 2], 17, 606105819)\r\n        b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330)\r\n        a = md5ff(a, b, c, d, x[i + 4], 7, -176418897)\r\n        d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426)\r\n        c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341)\r\n        b = md5ff(b, c, d, a, x[i + 7], 22, -45705983)\r\n        a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416)\r\n        d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417)\r\n        c = md5ff(c, d, a, b, x[i + 10], 17, -42063)\r\n        b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162)\r\n        a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682)\r\n        d = md5ff(d, a, b, c, x[i + 13], 12, -40341101)\r\n        c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290)\r\n        b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329)\r\n\r\n        a = md5gg(a, b, c, d, x[i + 1], 5, -165796510)\r\n        d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632)\r\n        c = md5gg(c, d, a, b, x[i + 11], 14, 643717713)\r\n        b = md5gg(b, c, d, a, x[i], 20, -373897302)\r\n        a = md5gg(a, b, c, d, x[i + 5], 5, -701558691)\r\n        d = md5gg(d, a, b, c, x[i + 10], 9, 38016083)\r\n        c = md5gg(c, d, a, b, x[i + 15], 14, -660478335)\r\n        b = md5gg(b, c, d, a, x[i + 4], 20, -405537848)\r\n        a = md5gg(a, b, c, d, x[i + 9], 5, 568446438)\r\n        d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690)\r\n        c = md5gg(c, d, a, b, x[i + 3], 14, -187363961)\r\n        b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501)\r\n        a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467)\r\n        d = md5gg(d, a, b, c, x[i + 2], 9, -51403784)\r\n        c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473)\r\n        b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734)\r\n\r\n        a = md5hh(a, b, c, d, x[i + 5], 4, -378558)\r\n        d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463)\r\n        c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562)\r\n        b = md5hh(b, c, d, a, x[i + 14], 23, -35309556)\r\n        a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060)\r\n        d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353)\r\n        c = md5hh(c, d, a, b, x[i + 7], 16, -155497632)\r\n        b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640)\r\n        a = md5hh(a, b, c, d, x[i + 13], 4, 681279174)\r\n        d = md5hh(d, a, b, c, x[i], 11, -358537222)\r\n        c = md5hh(c, d, a, b, x[i + 3], 16, -722521979)\r\n        b = md5hh(b, c, d, a, x[i + 6], 23, 76029189)\r\n        a = md5hh(a, b, c, d, x[i + 9], 4, -640364487)\r\n        d = md5hh(d, a, b, c, x[i + 12], 11, -421815835)\r\n        c = md5hh(c, d, a, b, x[i + 15], 16, 530742520)\r\n        b = md5hh(b, c, d, a, x[i + 2], 23, -995338651)\r\n\r\n        a = md5ii(a, b, c, d, x[i], 6, -198630844)\r\n        d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415)\r\n        c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905)\r\n        b = md5ii(b, c, d, a, x[i + 5], 21, -57434055)\r\n        a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571)\r\n        d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606)\r\n        c = md5ii(c, d, a, b, x[i + 10], 15, -1051523)\r\n        b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799)\r\n        a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359)\r\n        d = md5ii(d, a, b, c, x[i + 15], 10, -30611744)\r\n        c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380)\r\n        b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649)\r\n        a = md5ii(a, b, c, d, x[i + 4], 6, -145523070)\r\n        d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379)\r\n        c = md5ii(c, d, a, b, x[i + 2], 15, 718787259)\r\n        b = md5ii(b, c, d, a, x[i + 9], 21, -343485551)\r\n\r\n        a = safeAdd(a, olda)\r\n        b = safeAdd(b, oldb)\r\n        c = safeAdd(c, oldc)\r\n        d = safeAdd(d, oldd)\r\n    }\r\n    return [a, b, c, d]\r\n}\r\n\r\n/*\r\n* Convert an array of little-endian words to a string\r\n*/\r\nfunction binl2rstr(input) {\r\n    var i\r\n    var output = ''\r\n    var length32 = input.length * 32\r\n    for (i = 0; i < length32; i += 8) {\r\n        output += String.fromCharCode((input[i >> 5] >>> (i % 32)) & 0xFF)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Convert a raw string to an array of little-endian words\r\n* Characters >255 have their high-byte silently ignored.\r\n*/\r\nfunction rstr2binl(input) {\r\n    var i\r\n    var output = []\r\n    output[(input.length >> 2) - 1] = undefined\r\n    for (i = 0; i < output.length; i += 1) {\r\n        output[i] = 0\r\n    }\r\n    var length8 = input.length * 8\r\n    for (i = 0; i < length8; i += 8) {\r\n        output[i >> 5] |= (input.charCodeAt(i / 8) & 0xFF) << (i % 32)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Calculate the MD5 of a raw string\r\n*/\r\nfunction rstrMD5(s) {\r\n    return binl2rstr(binlMD5(rstr2binl(s), s.length * 8))\r\n}\r\n\r\n/*\r\n* Calculate the HMAC-MD5, of a key and some data (raw strings)\r\n*/\r\nfunction rstrHMACMD5(key, data) {\r\n    var i\r\n    var bkey = rstr2binl(key)\r\n    var ipad = []\r\n    var opad = []\r\n    var hash\r\n    ipad[15] = opad[15] = undefined\r\n    if (bkey.length > 16) {\r\n        bkey = binlMD5(bkey, key.length * 8)\r\n    }\r\n    for (i = 0; i < 16; i += 1) {\r\n        ipad[i] = bkey[i] ^ 0x36363636\r\n        opad[i] = bkey[i] ^ 0x5C5C5C5C\r\n    }\r\n    hash = binlMD5(ipad.concat(rstr2binl(data)), 512 + data.length * 8)\r\n    return binl2rstr(binlMD5(opad.concat(hash), 512 + 128))\r\n}\r\n\r\n/*\r\n* Convert a raw string to a hex string\r\n*/\r\nfunction rstr2hex(input) {\r\n    var hexTab = '0123456789abcdef'\r\n    var output = ''\r\n    var x\r\n    var i\r\n    for (i = 0; i < input.length; i += 1) {\r\n        x = input.charCodeAt(i)\r\n        output += hexTab.charAt((x >>> 4) & 0x0F) +\r\n            hexTab.charAt(x & 0x0F)\r\n    }\r\n    return output\r\n}\r\n\r\n/*\r\n* Encode a string as utf-8\r\n*/\r\nfunction str2rstrUTF8(input) {\r\n    return unescape(encodeURIComponent(input))\r\n}\r\n\r\n/*\r\n* Take string arguments and return either raw or hex encoded strings\r\n*/\r\nfunction rawMD5(s) {\r\n    return rstrMD5(str2rstrUTF8(s))\r\n}\r\nfunction hexMD5(s) {\r\n    return rstr2hex(rawMD5(s))\r\n}\r\nfunction rawHMACMD5(k, d) {\r\n    return rstrHMACMD5(str2rstrUTF8(k), str2rstrUTF8(d))\r\n}\r\nfunction hexHMACMD5(k, d) {\r\n    return rstr2hex(rawHMACMD5(k, d))\r\n}\r\n\r\nexport default function md5(string, key, raw) {\r\n    if (!key) {\r\n        if (!raw) {\r\n            return hexMD5(string)\r\n        }\r\n        return rawMD5(string)\r\n    }\r\n    if (!raw) {\r\n        return hexHMACMD5(key, string)\r\n    }\r\n    return rawHMACMD5(key, string)\r\n}\r\n","// TODO: asm.js\r\nimport {Log} from '../../../deps/bp_logger.js';\r\nexport default class RTP {\r\n    constructor(pkt/*uint8array*/, sdp) {\r\n        let bytes = new DataView(pkt.buffer, pkt.byteOffset, pkt.byteLength);\r\n\r\n        this.version   = bytes.getUint8(0) >>> 6;\r\n        this.padding   = bytes.getUint8(0) & 0x20 >>> 5;\r\n        this.has_extension = bytes.getUint8(0) & 0x10 >>> 4;\r\n        this.csrc      = bytes.getUint8(0) & 0x0F;\r\n        this.marker    = bytes.getUint8(1) >>> 7;\r\n        this.pt        = bytes.getUint8(1) & 0x7F;\r\n        this.sequence  = bytes.getUint16(2) ;\r\n        this.timestamp = bytes.getUint32(4);\r\n        this.ssrc      = bytes.getUint32(8);\r\n        this.csrcs     = [];\r\n\r\n        let pktIndex=12;\r\n        if (this.csrc>0) {\r\n            this.csrcs.push(bytes.getUint32(pktIndex));\r\n            pktIndex+=4;\r\n        }\r\n        if (this.has_extension==1) {\r\n            this.extension = bytes.getUint16(pktIndex);\r\n            this.ehl = bytes.getUint16(pktIndex+2);\r\n            pktIndex+=4;\r\n            this.header_data = pkt.slice(pktIndex, this.ehl);\r\n            pktIndex += this.ehl;\r\n        }\r\n\r\n        this.headerLength = pktIndex;\r\n        let padLength = 0;\r\n        if (this.padding) {\r\n            padLength = bytes.getUint8(pkt.byteLength-1);\r\n        }\r\n\r\n        // this.bodyLength   = pkt.byteLength-this.headerLength-padLength;\r\n\r\n        this.media = sdp.getMediaBlockByPayloadType(this.pt);\r\n        if (null === this.media) {\r\n            Log.log(`Media description for payload type: ${this.pt} not provided.`);\r\n        } else {\r\n            this.type = this.media.ptype;//PayloadType.string_map[this.media.rtpmap[this.media.fmt[0]].name];\r\n        }\r\n\r\n        this.data = pkt.subarray(pktIndex);\r\n        // this.timestamp = 1000 * (this.timestamp / this.media.rtpmap[this.pt].clock);\r\n        // console.log(this);\r\n    }\r\n    getPayload() {\r\n        return this.data;\r\n    }\r\n\r\n    getTimestampMS() {\r\n        return this.timestamp; //1000 * (this.timestamp / this.media.rtpmap[this.pt].clock);\r\n    }\r\n\r\n    toString() {\r\n        return \"RTP(\" +\r\n            \"version:\"   + this.version   + \", \" +\r\n            \"padding:\"   + this.padding   + \", \" +\r\n            \"has_extension:\" + this.has_extension + \", \" +\r\n            \"csrc:\"      + this.csrc      + \", \" +\r\n            \"marker:\"    + this.marker    + \", \" +\r\n            \"pt:\"        + this.pt        + \", \" +\r\n            \"sequence:\"  + this.sequence  + \", \" +\r\n            \"timestamp:\" + this.timestamp + \", \" +\r\n            \"ssrc:\"      + this.ssrc      + \")\";\r\n    }\r\n\r\n    isVideo(){return this.media.type == 'video';}\r\n    isAudio(){return this.media.type == 'audio';}\r\n\r\n    \r\n}","import RTP from './rtp.js';\r\n\r\nexport default class RTPFactory {\r\n    constructor(sdp) {\r\n        this.tsOffsets={};\r\n        for (let pay in sdp.media) {\r\n            for (let pt of sdp.media[pay].fmt) {\r\n                this.tsOffsets[pt] = {last: 0, overflow: 0};\r\n            }\r\n        }\r\n    }\r\n\r\n    build(pkt/*uint8array*/, sdp) {\r\n        let rtp = new RTP(pkt, sdp);\r\n\r\n        let tsOffset = this.tsOffsets[rtp.pt];\r\n        if (tsOffset) {\r\n            rtp.timestamp += tsOffset.overflow;\r\n            if (tsOffset.last && Math.abs(rtp.timestamp - tsOffset.last) > 0x7fffffff) {\r\n                console.log(`\\nlast ts: ${tsOffset.last}\\n\r\n                            new ts: ${rtp.timestamp}\\n\r\n                            new ts adjusted: ${rtp.timestamp+0xffffffff}\\n\r\n                            last overflow: ${tsOffset.overflow}\\n\r\n                            new overflow: ${tsOffset.overflow+0xffffffff}\\n\r\n                            `);\r\n                tsOffset.overflow += 0xffffffff;\r\n                rtp.timestamp += 0xffffffff;\r\n            }\r\n            /*if (rtp.timestamp>0xffffffff) {\r\n                console.log(`ts: ${rtp.timestamp}, seq: ${rtp.sequence}`);\r\n            }*/\r\n            tsOffset.last = rtp.timestamp;\r\n        }\r\n\r\n        return rtp;\r\n    }\r\n}","export class RTSPMessage {\r\n    static get RTSP_1_0() {return  \"RTSP/1.0\";}\r\n\r\n    constructor(_rtsp_version) {\r\n        this.version = _rtsp_version;\r\n    }\r\n\r\n    build(_cmd, _host, _params={}, _payload=null) {\r\n        let requestString = `${_cmd} ${_host} ${this.version}\\r\\n`;\r\n        for (let param in _params) {\r\n            requestString+=`${param}: ${_params[param]}\\r\\n`\r\n        }\r\n        // TODO: binary payload\r\n        if (_payload) {\r\n            requestString+=`Content-Length: ${_payload.length}\\r\\n`\r\n        }\r\n        requestString+='\\r\\n';\r\n        if (_payload) {\r\n            requestString+=_payload;\r\n        }\r\n        return requestString;\r\n    }\r\n\r\n    parse(_data) {\r\n        let lines = _data.split('\\r\\n');\r\n        let parsed = {\r\n            headers:{},\r\n            body:null,\r\n            code: 0,\r\n            statusLine: ''\r\n        };\r\n\r\n        let match;\r\n        [match, parsed.code, parsed.statusLine] = lines[0].match(new RegExp(`${this.version}[ ]+([0-9]{3})[ ]+(.*)`));\r\n        parsed.code = Number(parsed.code);\r\n        let lineIdx = 1;\r\n\r\n        while (lines[lineIdx]) {\r\n            let [k,v] = lines[lineIdx].split(/:(.+)/);\r\n            parsed.headers[k.toLowerCase()] = v.trim();\r\n            lineIdx++;\r\n        }\r\n\r\n        parsed.body = lines.slice(lineIdx).join('\\n\\r');\r\n\r\n        return parsed;\r\n    }\r\n\r\n}\r\n\r\nexport const MessageBuilder = new RTSPMessage(RTSPMessage.RTSP_1_0);","import {Log} from '../../deps/bp_logger.js';\r\nimport {NALU} from './NALU.js';\r\n\r\n// TODO: asm.js\r\nexport class NALUAsm {\r\n\r\n    constructor() {\r\n        this.fragmented_nalu = null;\r\n    }\r\n\r\n\r\n    static parseNALHeader(hdr) {\r\n        return {\r\n            nri: hdr & 0x60,\r\n            type: hdr & 0x1F\r\n        }\r\n    }\r\n\r\n    parseSingleNALUPacket(rawData, header, dts, pts) {\r\n        return new NALU(header.type,  header.nri, rawData.subarray(0), dts, pts);\r\n    }\r\n\r\n    parseAggregationPacket(rawData, header, dts, pts) {\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n        let nal_start_idx = 0;\r\n        let don = null;\r\n        if (NALU.STAP_B === header.type) {\r\n            don = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n        }\r\n        let ret = [];\r\n        while (nal_start_idx < data.byteLength) {\r\n            let size = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n            let header = NALUAsm.parseNALHeader(data.getInt8(nal_start_idx));\r\n            nal_start_idx++;\r\n            let nalu = this.parseSingleNALUPacket(rawData.subarray(nal_start_idx, nal_start_idx+size), header, dts, pts);\r\n            if (nalu !== null) {\r\n                ret.push(nalu);\r\n            }\r\n            nal_start_idx+=size;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    parseFragmentationUnit(rawData, header, dts, pts) {\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n        let nal_start_idx = 0;\r\n        let fu_header = data.getUint8(nal_start_idx);\r\n        let is_start = (fu_header & 0x80) >>> 7;\r\n        let is_end = (fu_header & 0x40) >>> 6;\r\n        let payload_type = fu_header & 0x1F;\r\n        let ret = null;\r\n\r\n        nal_start_idx++;\r\n        let don = 0;\r\n        if (NALU.FU_B === header.type) {\r\n            don = data.getUint16(nal_start_idx);\r\n            nal_start_idx += 2;\r\n        }\r\n\r\n        if (is_start) {\r\n            this.fragmented_nalu = new NALU(payload_type, header.nri, rawData.subarray(nal_start_idx), dts, pts);\r\n        }\r\n        if (this.fragmented_nalu && this.fragmented_nalu.ntype === payload_type) {\r\n            if (!is_start) {\r\n                this.fragmented_nalu.appendData(rawData.subarray(nal_start_idx));\r\n            }\r\n            if (is_end) {\r\n                ret = this.fragmented_nalu;\r\n                this.fragmented_nalu = null;\r\n                return ret;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    onNALUFragment(rawData, dts, pts) {\r\n\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n\r\n        let header = NALUAsm.parseNALHeader(data.getUint8(0));\r\n\r\n        let nal_start_idx = 1;\r\n\r\n        let unit = null;\r\n        if (header.type > 0 && header.type < 24) {\r\n            unit = this.parseSingleNALUPacket(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else if (NALU.FU_A ===  header.type || NALU.FU_B ===  header.type) {\r\n            unit = this.parseFragmentationUnit(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else if (NALU.STAP_A === header.type || NALU.STAP_B === header.type) {\r\n            return this.parseAggregationPacket(rawData.subarray(nal_start_idx), header, dts, pts);\r\n        } else {\r\n            /* 30 - 31 is undefined, ignore those (RFC3984). */\r\n            Log.log('Undefined NAL unit, type: ' + header.type);\r\n            return null;\r\n        }\r\n        if (unit) {\r\n            return [unit];\r\n        }\r\n        return null;\r\n    }\r\n}\r\n","export class AACFrame {\r\n\r\n    constructor(data, dts, pts) {\r\n        this.dts = dts;\r\n        this.pts = pts ? pts : this.dts;\r\n\r\n        this.data=data;//.subarray(offset);\r\n    }\r\n\r\n    getData() {\r\n        return this.data;\r\n    }\r\n\r\n    getSize() {\r\n        return this.data.byteLength;\r\n    }\r\n}","import {AACFrame} from './AACFrame.js';\r\nimport {BitArray} from '../util/binary';\r\n// import {AACParser} from \"../parsers/aac.js\";\r\n// TODO: asm.js\r\nexport class AACAsm {\r\n    constructor() {\r\n        this.config = null;\r\n    }\r\n\r\n    onAACFragment(pkt) {\r\n        let rawData = pkt.getPayload();\r\n        if (!pkt.media) {\r\n            return null;\r\n        }\r\n        let data = new DataView(rawData.buffer, rawData.byteOffset, rawData.byteLength);\r\n\r\n        let sizeLength = Number(pkt.media.fmtp['sizelength'] || 0);\r\n        let indexLength = Number(pkt.media.fmtp['indexlength'] || 0);\r\n        let indexDeltaLength = Number(pkt.media.fmtp['indexdeltalength'] || 0);\r\n        let CTSDeltaLength = Number(pkt.media.fmtp['ctsdeltalength'] || 0);\r\n        let DTSDeltaLength = Number(pkt.media.fmtp['dtsdeltalength'] || 0);\r\n        let RandomAccessIndication = Number(pkt.media.fmtp['randomaccessindication'] || 0);\r\n        let StreamStateIndication = Number(pkt.media.fmtp['streamstateindication'] || 0);\r\n        let AuxiliaryDataSizeLength = Number(pkt.media.fmtp['auxiliarydatasizelength'] || 0);\r\n\r\n        let configHeaderLength =\r\n            sizeLength + Math.max(indexLength, indexDeltaLength) + CTSDeltaLength + DTSDeltaLength +\r\n            RandomAccessIndication + StreamStateIndication + AuxiliaryDataSizeLength;\r\n\r\n\r\n        let auHeadersLengthPadded = 0;\r\n        let offset = 0;\r\n        let ts = (Math.round(pkt.getTimestampMS()/1024) << 10) * 90000 / this.config.samplerate;\r\n        if (0 !== configHeaderLength) {\r\n            /* The AU header section is not empty, read it from payload */\r\n            let auHeadersLengthInBits = data.getUint16(0); // Always 2 octets, without padding\r\n            auHeadersLengthPadded = 2 + (auHeadersLengthInBits>>>3) + ((auHeadersLengthInBits & 0x7)?1:0); // Add padding\r\n\r\n            //this.config = AACParser.parseAudioSpecificConfig(new Uint8Array(rawData, 0 , auHeadersLengthPadded));\r\n            // TODO: parse config\r\n            let frames = [];\r\n            let frameOffset=0;\r\n            let bits = new BitArray(rawData.subarray(2 + offset));\r\n            let cts = 0;\r\n            let dts = 0;\r\n            for (let offset=0; offset<auHeadersLengthInBits;) {\r\n                let size = bits.readBits(sizeLength);\r\n                let idx = bits.readBits(offset?indexDeltaLength:indexLength);\r\n                offset+=sizeLength+(offset?indexDeltaLength:indexLength)/*+2*/;\r\n                if (/*ctsPresent &&*/ CTSDeltaLength) {\r\n                    let ctsPresent = bits.readBits(1);\r\n                    cts = bits.readBits(CTSDeltaLength);\r\n                    offset+=CTSDeltaLength;\r\n                }\r\n                if (/*dtsPresent && */DTSDeltaLength) {\r\n                    let dtsPresent = bits.readBits(1);\r\n                    dts = bits.readBits(DTSDeltaLength);\r\n                    offset+=CTSDeltaLength;\r\n                }\r\n                if (RandomAccessIndication) {\r\n                    bits.skipBits(1);\r\n                    offset+=1;\r\n                }\r\n                if (StreamStateIndication) {\r\n                    bits.skipBits(StreamStateIndication);\r\n                    offset+=StreamStateIndication;\r\n                }\r\n                frames.push(new AACFrame(rawData.subarray(auHeadersLengthPadded + frameOffset, auHeadersLengthPadded + frameOffset + size), ts+dts, ts+cts));\r\n                frameOffset+=size;\r\n            }\r\n            return frames;\r\n        } else {\r\n            let aacData = rawData.subarray(auHeadersLengthPadded);\r\n            while (true) {\r\n                if (aacData[offset] !=255) break;\r\n                ++offset;\r\n            }\r\n            ++offset;\r\n            return [new AACFrame(rawData.subarray(auHeadersLengthPadded+offset), ts)];\r\n        }\r\n    }\r\n}","import {NALUAsm} from \"../../../../core/elementary/NALUAsm.js\";\r\nimport {AACAsm} from \"../../../../core/elementary/AACAsm.js\";\r\n\r\nexport class RTPPayloadParser {\r\n\r\n    constructor() {\r\n        this.h264parser = new RTPH264Parser();\r\n        this.aacparser = new RTPAACParser();\r\n    }\r\n\r\n    parse(rtp) {\r\n        if (rtp.media.type=='video') {\r\n            return this.h264parser.parse(rtp);\r\n        } else if (rtp.media.type == 'audio') {\r\n            return this.aacparser.parse(rtp);\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nclass RTPH264Parser {\r\n    constructor() {\r\n        this.naluasm = new NALUAsm();\r\n    }\r\n\r\n    parse(rtp) {\r\n        return this.naluasm.onNALUFragment(rtp.getPayload(), rtp.getTimestampMS());\r\n    }\r\n}\r\n\r\nclass RTPAACParser {\r\n\r\n    constructor() {\r\n        this.scale = 1;\r\n        this.asm = new AACAsm();\r\n    }\r\n\r\n    setConfig(conf) {\r\n        this.asm.config = conf;\r\n    }\r\n\r\n    parse(rtp) {\r\n        return this.asm.onAACFragment(rtp);\r\n    }\r\n}","import {Log} from '../deps/bp_logger.js';\r\nimport {EventEmitter} from '../deps/bp_event.js';\r\n\r\nexport class BaseClient {\r\n    constructor(options={flush: 100}) {\r\n        this.options = options;\r\n        this.eventSource = new EventEmitter();\r\n\r\n        Object.defineProperties(this, {\r\n            sourceUrl: {value: null, writable: true},   // TODO: getter with validator\r\n            paused: {value: true, writable: true},\r\n            seekable: {value: false, writable: true},\r\n            connected: {value: false, writable: true}\r\n        });\r\n\r\n        this._onData = ()=>{\r\n            if (this.connected) {\r\n                while (this.transport.dataQueue.length) {\r\n                    this.onData(this.transport.dataQueue.pop());\r\n                }\r\n            }\r\n        };\r\n        this._onConnect = this.onConnected.bind(this);\r\n        this._onDisconnect = this.onDisconnected.bind(this);\r\n    }\r\n\r\n    static streamType() {\r\n        return null;    \r\n    }\r\n    \r\n    destroy() {\r\n        this.detachTransport();\r\n    }\r\n\r\n    attachTransport(transport) {\r\n        if (this.transport) {\r\n            this.detachTransport();\r\n        }\r\n        this.transport = transport;\r\n        this.transport.eventSource.addEventListener('data', this._onData);\r\n        this.transport.eventSource.addEventListener('connected', this._onConnect);\r\n        this.transport.eventSource.addEventListener('disconnected', this._onDisconnect);\r\n    }\r\n\r\n    detachTransport() {\r\n        if (this.transport) {\r\n            this.transport.eventSource.removeEventListener('data', this._onData);\r\n            this.transport.eventSource.removeEventListener('connected', this._onConnect);\r\n            this.transport.eventSource.removeEventListener('disconnected', this._onDisconnect);\r\n            this.transport = null;\r\n        }\r\n    }\r\n    reset() {\r\n\r\n    }\r\n\r\n    start() {\r\n        Log.log('Client started');\r\n        this.paused = false;\r\n        // this.startStreamFlush();\r\n    }\r\n\r\n    stop() {\r\n        Log.log('Client paused');\r\n        this.paused = true;\r\n        // this.stopStreamFlush();\r\n    }\r\n\r\n    seek(timeOffset) {\r\n\r\n    }\r\n\r\n    setSource(source) {\r\n        this.stop();\r\n        this.endpoint = source;\r\n        this.sourceUrl = source.urlpath;\r\n    }\r\n\r\n    startStreamFlush() {\r\n        this.flushInterval = setInterval(()=>{\r\n            if (!this.paused) {\r\n                this.eventSource.dispatchEvent('flush');\r\n            }\r\n        }, this.options.flush);\r\n    }\r\n\r\n    stopStreamFlush() {\r\n        clearInterval(this.flushInterval);\r\n    }\r\n\r\n    onData(data) {\r\n\r\n    }\r\n\r\n    onConnected() {\r\n        if (!this.seekable) {\r\n            this.transport.dataQueue = [];\r\n            this.eventSource.dispatchEvent('clear');\r\n        }\r\n        this.connected = true;\r\n    }\r\n\r\n    onDisconnected() {\r\n        this.connected = false;\r\n    }\r\n\r\n    queryCredentials() {\r\n        return Promise.resolve();\r\n    }\r\n\r\n    setCredentials(user, password) {\r\n        this.endpoint.user = user;\r\n        this.endpoint.pass = password;\r\n        this.endpoint.auth = `${user}:${password}`;\r\n    }\r\n}","import {BitArray, bitSlice} from '../util/binary.js';\r\n\r\nexport class AACParser {\r\n    static get SampleRates() {return  [\r\n        96000, 88200,\r\n        64000, 48000,\r\n        44100, 32000,\r\n        24000, 22050,\r\n        16000, 12000,\r\n        11025, 8000,\r\n        7350];}\r\n\r\n    // static Profile = [\r\n    //     0: Null\r\n    //     1: AAC Main\r\n    //     2: AAC LC (Low Complexity)\r\n    //     3: AAC SSR (Scalable Sample Rate)\r\n    //     4: AAC LTP (Long Term Prediction)\r\n    //     5: SBR (Spectral Band Replication)\r\n    //     6: AAC Scalable\r\n    // ]\r\n\r\n    static parseAudioSpecificConfig(bytesOrBits) {\r\n        let config;\r\n        if (bytesOrBits.byteLength) { // is byteArray\r\n            config = new BitArray(bytesOrBits);\r\n        } else {\r\n            config = bytesOrBits;\r\n        }\r\n\r\n        let bitpos = config.bitpos+(config.src.byteOffset+config.bytepos)*8;\r\n        let prof = config.readBits(5);\r\n        this.codec = `mp4a.40.${prof}`;\r\n        let sfi = config.readBits(4);\r\n        if (sfi == 0xf) config.skipBits(24);\r\n        let channels = config.readBits(4);\r\n\r\n        return {\r\n            config: bitSlice(new Uint8Array(config.src.buffer), bitpos, bitpos+16),\r\n            codec: `mp4a.40.${prof}`,\r\n            samplerate: AACParser.SampleRates[sfi],\r\n            channels: channels\r\n        }\r\n    }\r\n\r\n    static parseStreamMuxConfig(bytes) {\r\n        // ISO_IEC_14496-3 Part 3 Audio. StreamMuxConfig\r\n        let config = new BitArray(bytes);\r\n\r\n        if (!config.readBits(1)) {\r\n            config.skipBits(14);\r\n            return AACParser.parseAudioSpecificConfig(config);\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\n\r\nimport {RTSPClientSM as RTSPClient} from './client.js';\r\nimport {Url} from '../../core/util/url.js';\r\nimport {RTSPError} from \"./client\";\r\n\r\nconst LOG_TAG = \"rtsp:session\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTSPSession {\r\n\r\n    constructor(client, sessionId) {\r\n        this.state = null;\r\n        this.client = client;\r\n        this.sessionId = sessionId;\r\n        this.url = this.getControlURL();\r\n    }\r\n\r\n    reset() {\r\n        this.client = null;\r\n    }\r\n\r\n    start() {\r\n        return this.sendPlay();\r\n    }\r\n\r\n    stop() {\r\n        return this.sendTeardown();\r\n    }\r\n\r\n    getControlURL() {\r\n        let ctrl = this.client.sdp.getSessionBlock().control;\r\n        if (Url.isAbsolute(ctrl)) {\r\n            return ctrl;\r\n        } else if (!ctrl || '*' === ctrl) {\r\n            return this.client.contentBase;\r\n        } else {\r\n            return `${this.client.contentBase}${ctrl}`;\r\n        }\r\n    }\r\n\r\n    sendRequest(_cmd, _params = {}) {\r\n        let params = {};\r\n        if (this.sessionId) {\r\n            params['Session'] = this.sessionId;\r\n        }\r\n        Object.assign(params, _params);\r\n        return this.client.sendRequest(_cmd, this.getControlURL(), params);\r\n    }\r\n\r\n    async sendPlay(pos = 0) {\r\n        this.state = RTSPClient.STATE_PLAY;\r\n        let params = {};\r\n        let range = this.client.sdp.sessionBlock.range;\r\n        if (range) {\r\n            // TODO: seekable\r\n            if (range[0] == -1) {\r\n                range[0] = 0;// Do not handle now at the moment\r\n            }\r\n            // params['Range'] = `${range[2]}=${range[0]}-`;\r\n        }\r\n        let data = await this.sendRequest('PLAY', params);\r\n        this.state = RTSPClient.STATE_PLAYING;\r\n        return {data: data};\r\n    }\r\n\r\n    async sendPause() {\r\n        if (!this.client.supports(\"PAUSE\")) {\r\n            return;\r\n        }\r\n        this.state = RTSPClient.STATE_PAUSE;\r\n        await this.sendRequest(\"PAUSE\");\r\n        this.state = RTSPClient.STATE_PAUSED;\r\n    }\r\n\r\n    async sendTeardown() {\r\n        if (this.state != RTSPClient.STATE_TEARDOWN) {\r\n            this.state = RTSPClient.STATE_TEARDOWN;\r\n            await this.sendRequest(\"TEARDOWN\");\r\n            Log.log('RTSPClient: STATE_TEARDOWN');\r\n            ///this.client.connection.disconnect();\r\n            // TODO: Notify client\r\n        }\r\n    }\r\n}\r\n","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {StateMachine} from '../../deps/bp_statemachine.js';\r\nimport {SDPParser} from '../../core/parsers/sdp.js';\r\nimport {RTSPStream} from './stream.js';\r\nimport md5 from '../../core/util/md5';\r\n// import {RTP} from './rtp/rtp';\r\nimport RTPFactory from './rtp/factory.js';\r\nimport {MessageBuilder} from './message.js';\r\nimport {RTPPayloadParser} from './rtp/payload/parser.js';\r\nimport {BaseClient} from '../../core/base_client.js';\r\nimport {PayloadType} from '../../core/defs.js';\r\nimport {base64ToArrayBuffer, hexToByteArray} from '../../core/util/binary.js';\r\nimport {AACParser} from '../../core/parsers/aac.js';\r\nimport {RTSPSession} from \"./session\";\r\n\r\nconst LOG_TAG = \"client:rtsp\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\nexport class RTPError {\r\n    constructor(message, file, line) {\r\n        //super(message, file, line);\r\n    }\r\n}\r\n\r\nexport default class RTSPClient extends BaseClient {\r\n    constructor(options={flush: 200}) {\r\n        super(options);\r\n        this.clientSM = new RTSPClientSM(this);\r\n        this.clientSM.ontracks = (tracks) => {\r\n            this.eventSource.dispatchEvent('tracks', tracks);\r\n            this.startStreamFlush();\r\n        };\r\n        this.sampleQueues={};\r\n    }\r\n    \r\n    static streamType() {\r\n        return 'rtsp';\r\n    }\r\n\r\n    setSource(url) {\r\n        super.setSource(url);\r\n        this.clientSM.setSource(url);\r\n    }\r\n    attachTransport(transport) {\r\n        super.attachTransport(transport);\r\n        this.clientSM.transport = transport;\r\n    }\r\n\r\n    detachTransport() {\r\n        super.detachTransport();\r\n        this.clientSM.transport = null;\r\n    }\r\n\r\n    reset() {\r\n        super.reset();\r\n        this.sampleQueues={};\r\n    }\r\n\r\n    destroy() {\r\n        this.clientSM.destroy();\r\n        return super.destroy();\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        if (this.transport) {\r\n            return this.transport.ready.then(() => {\r\n                return this.clientSM.start();\r\n            });\r\n        } else {\r\n            return Promise.reject(\"no transport attached\");\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        super.stop();\r\n        return this.clientSM.stop();\r\n    }\r\n\r\n    onData(data) {\r\n        this.clientSM.onData(data);\r\n    }\r\n\r\n    onConnected() {\r\n        this.clientSM.onConnected();\r\n        super.onConnected();\r\n    }\r\n\r\n    onDisconnected() {\r\n        super.onDisconnected();\r\n        this.clientSM.onDisconnected();\r\n    }\r\n}\r\n\r\nclass AuthError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n    }\r\n}\r\n\r\nexport class RTSPError extends Error {\r\n    constructor(data) {\r\n        super(data.msg);\r\n        this.data = data;\r\n    }\r\n}\r\n\r\nexport class RTSPClientSM extends StateMachine {\r\n    static get USER_AGENT() {return 'SFRtsp 0.3';}\r\n    static get STATE_INITIAL() {return  1 << 0;}\r\n    static get STATE_OPTIONS() {return 1 << 1;}\r\n    static get STATE_DESCRIBE () {return  1 << 2;}\r\n    static get STATE_SETUP() {return  1 << 3;}\r\n    static get STATE_STREAMS() {return 1 << 4;}\r\n    static get STATE_TEARDOWN() {return  1 << 5;}\r\n    static get STATE_PLAY() {return  1 << 6;}\r\n    static get STATE_PLAYING() {return  1 << 7;}\r\n    static get STATE_PAUSE() {return  1 << 8;}\r\n    static get STATE_PAUSED() {return  1 << 9;}\r\n    // static STATE_PAUSED = 1 << 6;\r\n\r\n    constructor(parent) {\r\n        super();\r\n\r\n        this.parent = parent;\r\n        this.transport = null;\r\n        this.payParser = new RTPPayloadParser();\r\n        this.rtp_channels = new Set();\r\n        this.sessions = {};\r\n        this.ontracks = null;\r\n\r\n        this.addState(RTSPClientSM.STATE_INITIAL,{\r\n        }).addState(RTSPClientSM.STATE_OPTIONS, {\r\n            activate: this.sendOptions,\r\n            finishTransition: this.onOptions\r\n        }).addState(RTSPClientSM.STATE_DESCRIBE, {\r\n            activate: this.sendDescribe,\r\n            finishTransition: this.onDescribe\r\n        }).addState(RTSPClientSM.STATE_SETUP, {\r\n            activate: this.sendSetup,\r\n            finishTransition: this.onSetup\r\n        }).addState(RTSPClientSM.STATE_STREAMS, {\r\n\r\n        }).addState(RTSPClientSM.STATE_TEARDOWN, {\r\n            activate: ()=>{\r\n                this.started = false;\r\n            },\r\n            finishTransition: ()=>{\r\n                return this.transitionTo(RTSPClientSM.STATE_INITIAL)\r\n            }\r\n        }).addTransition(RTSPClientSM.STATE_INITIAL, RTSPClientSM.STATE_OPTIONS)\r\n            .addTransition(RTSPClientSM.STATE_INITIAL, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_OPTIONS, RTSPClientSM.STATE_DESCRIBE)\r\n            .addTransition(RTSPClientSM.STATE_DESCRIBE, RTSPClientSM.STATE_SETUP)\r\n            .addTransition(RTSPClientSM.STATE_SETUP, RTSPClientSM.STATE_STREAMS)\r\n            .addTransition(RTSPClientSM.STATE_TEARDOWN, RTSPClientSM.STATE_INITIAL)\r\n            // .addTransition(RTSPClientSM.STATE_STREAMS, RTSPClientSM.STATE_PAUSED)\r\n            // .addTransition(RTSPClientSM.STATE_PAUSED, RTSPClientSM.STATE_STREAMS)\r\n            .addTransition(RTSPClientSM.STATE_STREAMS, RTSPClientSM.STATE_TEARDOWN)\r\n            // .addTransition(RTSPClientSM.STATE_PAUSED, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_SETUP, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_DESCRIBE, RTSPClientSM.STATE_TEARDOWN)\r\n            .addTransition(RTSPClientSM.STATE_OPTIONS, RTSPClientSM.STATE_TEARDOWN);\r\n\r\n        this.reset();\r\n\r\n        this.shouldReconnect = false;\r\n\r\n        // TODO: remove listeners\r\n        // this.connection.eventSource.addEventListener('connected', ()=>{\r\n        //     if (this.shouldReconnect) {\r\n        //         this.reconnect();\r\n        //     }\r\n        // });\r\n        // this.connection.eventSource.addEventListener('disconnected', ()=>{\r\n        //     if (this.started) {\r\n        //         this.shouldReconnect = true;\r\n        //     }\r\n        // });\r\n        // this.connection.eventSource.addEventListener('data', (data)=>{\r\n        //     let channel = new DataView(data).getUint8(1);\r\n        //     if (this.rtp_channels.has(channel)) {\r\n        //         this.onRTP({packet: new Uint8Array(data, 4), type: channel});\r\n        //     }\r\n        //\r\n        // });\r\n    }\r\n\r\n    destroy() {\r\n        this.parent = null;\r\n    }\r\n\r\n    setSource(url) {\r\n        this.reset();\r\n        this.endpoint = url;\r\n        this.url = `${url.protocol}://${url.location}${url.urlpath}`;\r\n    }\r\n\r\n    onConnected() {\r\n        if (this.rtpFactory) {\r\n            this.rtpFactory = null;\r\n        }\r\n        if (this.shouldReconnect) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    async onDisconnected() {\r\n        this.reset();\r\n        this.shouldReconnect = true;\r\n        await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n        await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n    }\r\n\r\n    start() {\r\n        if (this.currentState.name !== RTSPClientSM.STATE_STREAMS) {\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        } else {\r\n            // TODO: seekable\r\n            let promises = [];\r\n            for (let session in this.sessions) {\r\n                promises.push(this.sessions[session].sendPlay());\r\n            }\r\n            return Promise.all(promises);\r\n        }\r\n    }\r\n\r\n    onData(data) {\r\n        let channel = data[1];\r\n        if (this.rtp_channels.has(channel)) {\r\n            this.onRTP({packet: data.subarray(4), type: channel});\r\n        }\r\n    }\r\n\r\n    useRTPChannel(channel) {\r\n        this.rtp_channels.add(channel);\r\n    }\r\n\r\n    forgetRTPChannel(channel) {\r\n        this.rtp_channels.delete(channel);\r\n    }\r\n\r\n    stop() {\r\n        this.shouldReconnect = false;\r\n        let promises = [];\r\n        for (let session in this.sessions) {\r\n            promises.push(this.sessions[session].sendPause());\r\n        }\r\n        return Promise.all(promises);\r\n        // this.mse = null;\r\n    }\r\n\r\n    async reset() {\r\n        this.authenticator = '';\r\n        this.methods = [];\r\n        this.tracks = [];\r\n        this.rtpBuffer={};\r\n        for (let stream in this.streams) {\r\n            this.streams[stream].reset();\r\n        }\r\n        for (let session in this.sessions) {\r\n            this.sessions[session].reset();\r\n        }\r\n        this.streams={};\r\n        this.sessions={};\r\n        this.contentBase = \"\";\r\n        if (this.currentState) {\r\n            if (this.currentState.name != RTSPClientSM.STATE_INITIAL) {\r\n                await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n                await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n            }\r\n        } else {\r\n            await this.transitionTo(RTSPClientSM.STATE_INITIAL);\r\n        }\r\n        this.sdp = null;\r\n        this.interleaveChannelIndex = 0;\r\n        this.session = null;\r\n        this.timeOffset = {};\r\n        this.lastTimestamp = {};\r\n    }\r\n\r\n    async reconnect() {\r\n        //this.parent.eventSource.dispatchEvent('clear');\r\n        await this.reset();\r\n        if (this.currentState.name != RTSPClientSM.STATE_INITIAL) {\r\n            await this.transitionTo(RTSPClientSM.STATE_TEARDOWN);\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        } else {\r\n            return this.transitionTo(RTSPClientSM.STATE_OPTIONS);\r\n        }\r\n    }\r\n\r\n    supports(method) {\r\n        return this.methods.includes(method)\r\n    }\r\n\r\n    parse(_data) {\r\n        Log.debug(_data.payload);\r\n        let d=_data.payload.split('\\r\\n\\r\\n');\r\n        let parsed =  MessageBuilder.parse(d[0]);\r\n        let len = Number(parsed.headers['content-length']);\r\n        if (len) {\r\n            let d=_data.payload.split('\\r\\n\\r\\n');\r\n            parsed.body = d[1];\r\n        } else {\r\n            parsed.body=\"\";\r\n        }\r\n        return parsed\r\n    }\r\n\r\n    sendRequest(_cmd, _host, _params={}, _payload=null) {\r\n        this.cSeq++;\r\n        Object.assign(_params, {\r\n            CSeq: this.cSeq,\r\n            'User-Agent': RTSPClientSM.USER_AGENT\r\n        });\r\n        if (this.authenticator) {\r\n            _params['Authorization'] = this.authenticator(_cmd);\r\n        }\r\n        return this.send(MessageBuilder.build(_cmd, _host, _params, _payload), _cmd).catch((e)=>{\r\n            if ((e instanceof AuthError) && !_params['Authorization'] ) {\r\n                return this.sendRequest(_cmd, _host, _params, _payload);\r\n            } else {\r\n                throw e;\r\n            }\r\n        });\r\n    }\r\n\r\n    async send(_data, _method) {\r\n        if (this.transport) {\r\n            try {\r\n                await this.transport.ready;\r\n            } catch(e) {\r\n                this.onDisconnected();\r\n                throw e;\r\n            }\r\n            Log.debug(_data);\r\n            let response = await this.transport.send(_data);\r\n            let parsed = this.parse(response);\r\n            // TODO: parse status codes\r\n            if (parsed.code == 401 /*&& !this.authenticator */) {\r\n                Log.debug(parsed.headers['www-authenticate']);\r\n                let auth = parsed.headers['www-authenticate'];\r\n                let method = auth.substring(0, auth.indexOf(' '));\r\n                auth = auth.substr(method.length+1);\r\n                let chunks = auth.split(',');\r\n\r\n                let ep = this.parent.endpoint;\r\n                if (!ep.user || !ep.pass) {\r\n                    try {\r\n                        await this.parent.queryCredentials.call(this.parent);\r\n                    } catch (e) {\r\n                        throw new AuthError();\r\n                    }\r\n                }\r\n\r\n                if (method.toLowerCase() == 'digest') {\r\n                    let parsedChunks = {};\r\n                    for (let chunk of chunks) {\r\n                        let c = chunk.trim();\r\n                        let [k,v] = c.split('=');\r\n                        parsedChunks[k] = v.substr(1, v.length-2);\r\n                    }\r\n                    this.authenticator = (_method)=>{\r\n                        let ep = this.parent.endpoint;\r\n                        let ha1 = md5(`${ep.user}:${parsedChunks.realm}:${ep.pass}`);\r\n                        let ha2 = md5(`${_method}:${this.url}`);\r\n                        let response = md5(`${ha1}:${parsedChunks.nonce}:${ha2}`);\r\n                        let tail=''; // TODO: handle other params\r\n                        return `Digest username=\"${ep.user}\", realm=\"${parsedChunks.realm}\", nonce=\"${parsedChunks.nonce}\", uri=\"${this.url}\", response=\"${response}\"${tail}`;\r\n                    }\r\n                } else {\r\n                    this.authenticator = ()=>{return `Basic ${btoa(this.parent.endpoint.auth)}`;};\r\n                }\r\n\r\n                throw new AuthError(parsed);\r\n            }\r\n            if (parsed.code >= 300) {\r\n                Log.error(parsed.statusLine);\r\n                throw new RTSPError({msg: `RTSP error: ${parsed.code} ${parsed.statusLine}`, parsed: parsed});\r\n            }\r\n            return parsed;\r\n        } else {\r\n            return Promise.reject(\"No transport attached\");\r\n        }\r\n    }\r\n\r\n    sendOptions() {\r\n        this.reset();\r\n        this.started = true;\r\n        this.cSeq = 0;\r\n        return this.sendRequest('OPTIONS', '*', {});\r\n    }\r\n\r\n    onOptions(data) {\r\n        this.methods = data.headers['public'].split(',').map((e)=>e.trim());\r\n        this.transitionTo(RTSPClientSM.STATE_DESCRIBE);\r\n    }\r\n\r\n    sendDescribe() {\r\n        return this.sendRequest('DESCRIBE', this.url, {\r\n            'Accept': 'application/sdp'\r\n        }).then((data)=>{\r\n            this.sdp = new SDPParser();\r\n            return this.sdp.parse(data.body).catch(()=>{\r\n                throw new Error(\"Failed to parse SDP\");\r\n            }).then(()=>{return data;});\r\n        });\r\n    }\r\n\r\n    onDescribe(data) {\r\n        this.contentBase = data.headers['content-base'] || this.url;// `${this.endpoint.protocol}://${this.endpoint.location}${this.endpoint.urlpath}/`;\r\n        this.tracks = this.sdp.getMediaBlockList();\r\n        this.rtpFactory = new RTPFactory(this.sdp);\r\n\r\n        Log.log('SDP contained ' + this.tracks.length + ' track(s). Calling SETUP for each.');\r\n\r\n        if (data.headers['session']) {\r\n            this.session = data.headers['session'];\r\n        }\r\n\r\n        if (!this.tracks.length) {\r\n            throw new Error(\"No tracks in SDP\");\r\n        }\r\n\r\n        this.transitionTo(RTSPClientSM.STATE_SETUP);\r\n    }\r\n\r\n    sendSetup() {\r\n        let streams=[];\r\n\r\n        // TODO: select first video and first audio tracks\r\n        for (let track_type of this.tracks) {\r\n            Log.log(\"setup track: \"+track_type);\r\n            // if (track_type=='audio') continue;\r\n            // if (track_type=='video') continue;\r\n            let track = this.sdp.getMediaBlock(track_type);\r\n            if (!PayloadType.string_map[track.rtpmap[track.fmt[0]].name]) continue;\r\n\r\n            this.streams[track_type] = new RTSPStream(this, track);\r\n            let setupPromise = this.streams[track_type].start();\r\n            this.parent.sampleQueues[PayloadType.string_map[track.rtpmap[track.fmt[0]].name]]=[];\r\n            this.rtpBuffer[track.fmt[0]]=[];\r\n            streams.push(setupPromise.then(({track, data})=>{\r\n                let timeOffset = 0;\r\n                this.timeOffset[track.fmt[0]] = 0;\r\n                try {\r\n                    let rtp_info = data.headers[\"rtp-info\"].split(';');\r\n                    for (let chunk of rtp_info) {\r\n                        let [key, val] = chunk.split(\"=\");\r\n                        if (key === \"rtptime\") {\r\n                            this.timeOffset[track.fmt[0]] = 0;//Number(val);\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    // new Date().getTime();\r\n                }\r\n                let params = {\r\n                    timescale: 0,\r\n                    scaleFactor: 0\r\n                };\r\n                if (track.fmtp['sprop-parameter-sets']) {\r\n                    let sps_pps = track.fmtp['sprop-parameter-sets'].split(',');\r\n                    params = {\r\n                        sps:base64ToArrayBuffer(sps_pps[0]),\r\n                        pps:base64ToArrayBuffer(sps_pps[1])\r\n                    };\r\n                } else if (track.fmtp['config']) {\r\n                    let config = track.fmtp['config'];\r\n                    this.has_config = track.fmtp['cpresent']!='0';\r\n                    let generic = track.rtpmap[track.fmt[0]].name == 'MPEG4-GENERIC';\r\n                    if (generic) {\r\n                        params={config:\r\n                            AACParser.parseAudioSpecificConfig(hexToByteArray(config))\r\n                        };\r\n                        this.payParser.aacparser.setConfig(params.config);\r\n                    } else if (config) {\r\n                        // todo: parse audio specific config for mpeg4-generic\r\n                        params={config:\r\n                            AACParser.parseStreamMuxConfig(hexToByteArray(config))\r\n                        };\r\n                        this.payParser.aacparser.setConfig(params.config);\r\n                    }\r\n                }\r\n                params.duration = this.sdp.sessionBlock.range?this.sdp.sessionBlock.range[1]-this.sdp.sessionBlock.range[0]:1;\r\n                this.parent.seekable = (params.duration > 1);\r\n                let res = {\r\n                    track: track,\r\n                    offset: this.timeOffset[track.fmt[0]],\r\n                    type: PayloadType.string_map[track.rtpmap[track.fmt[0]].name],\r\n                    params: params,\r\n                    duration: params.duration\r\n                };\r\n                console.log(res, this.timeOffset);\r\n                let session = data.headers.session.split(';')[0];\r\n                if (!this.sessions[session]) {\r\n                    this.sessions[session] = new RTSPSession(this, session);\r\n                }\r\n                return res;\r\n            }));\r\n        }\r\n        return Promise.all(streams).then((tracks)=>{\r\n            let sessionPromises = [];\r\n            for (let session in this.sessions) {\r\n                sessionPromises.push(this.sessions[session].start());\r\n            }\r\n            return Promise.all(sessionPromises).then(()=>{\r\n                if (this.ontracks) {\r\n                    this.ontracks(tracks);\r\n                }\r\n            })\r\n        }).catch((e)=>{\r\n            console.error(e);\r\n            this.stop();\r\n            this.reset();\r\n        });\r\n    }\r\n\r\n    onSetup() {\r\n        this.transitionTo(RTSPClientSM.STATE_STREAMS);\r\n    }\r\n\r\n    onRTP(_data) {\r\n        if (!this.rtpFactory) return;\r\n\r\n        let rtp = this.rtpFactory.build(_data.packet, this.sdp);\r\n        if (!rtp.type) {\r\n            return;\r\n        }\r\n\r\n        if (this.timeOffset[rtp.pt] === undefined) {\r\n            //console.log(rtp.pt, this.timeOffset[rtp.pt]);\r\n            this.rtpBuffer[rtp.pt].push(rtp);\r\n            return;\r\n        }\r\n\r\n        if (this.lastTimestamp[rtp.pt] === undefined) {\r\n            this.lastTimestamp[rtp.pt] = rtp.timestamp-this.timeOffset[rtp.pt];\r\n        }\r\n\r\n        let queue = this.rtpBuffer[rtp.pt];\r\n        queue.push(rtp);\r\n\r\n        while (queue.length) {\r\n            let rtp = queue.shift();\r\n\r\n            rtp.timestamp = rtp.timestamp-this.timeOffset[rtp.pt]-this.lastTimestamp[rtp.pt];\r\n            // TODO: overflow\r\n            // if (rtp.timestamp < 0) {\r\n            //     rtp.timestamp = (rtp.timestamp + Number.MAX_SAFE_INTEGER) % 0x7fffffff;\r\n            // }\r\n            if (rtp.media) {\r\n                let pay = this.payParser.parse(rtp);\r\n                if (pay) {\r\n                    // if (typeof pay == typeof []) {\r\n                    this.parent.sampleQueues[rtp.type].push(pay);\r\n                    // } else {\r\n                    //     this.parent.sampleQueues[rtp.type].push([pay]);\r\n                    // }\r\n                } else {\r\n                    this.parent.sampleQueues[rtp.type].push(pay);\r\n                }\r\n            }\r\n        }\r\n        // this.remuxer.feedRTP();\r\n    }\r\n}","// ASN.1 JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\n/*global oids */\r\n\r\nvar hardLimit = 100,\r\n    ellipsis = \"\\u2026\",\r\n    DOM = {\r\n        tag: function (tagName, className) {\r\n            var t = document.createElement(tagName);\r\n            t.className = className;\r\n            return t;\r\n        },\r\n        text: function (str) {\r\n            return document.createTextNode(str);\r\n        }\r\n    };\r\n\r\nclass Stream {\r\n    static get hexDigits() {\r\n        return \"0123456789ABCDEF\";\r\n    };\r\n\r\n    static get reTime() {\r\n        return /^((?:1[89]|2\\d)?\\d\\d)(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])([01]\\d|2[0-3])(?:([0-5]\\d)(?:([0-5]\\d)(?:[.,](\\d{1,3}))?)?)?(Z|[-+](?:[0]\\d|1[0-2])([0-5]\\d)?)?$/;\r\n    }\r\n\r\n\r\n    constructor(enc, pos) {\r\n        if (enc instanceof Stream) {\r\n            this.enc = enc.enc;\r\n            this.pos = enc.pos;\r\n        } else {\r\n            this.enc = enc;\r\n            this.pos = pos;\r\n        }\r\n    }\r\n\r\n    get(pos) {\r\n        if (pos === undefined)\r\n            pos = this.pos++;\r\n        if (pos >= this.enc.length)\r\n            throw 'Requesting byte offset ' + pos + ' on a stream of length ' + this.enc.length;\r\n        return this.enc[pos];\r\n    };\r\n\r\n    hexByte(b) {\r\n        return Stream.hexDigits.charAt((b >> 4) & 0xF) + Stream.hexDigits.charAt(b & 0xF);\r\n    };\r\n\r\n    hexDump(start, end, raw) {\r\n        var s = \"\";\r\n        for (var i = start; i < end; ++i) {\r\n            s += this.hexByte(this.get(i));\r\n            if (raw !== true)\r\n                switch (i & 0xF) {\r\n                    case 0x7:\r\n                        s += \"  \";\r\n                        break;\r\n                    case 0xF:\r\n                        s += \"\\n\";\r\n                        break;\r\n                    default:\r\n                        s += \" \";\r\n                }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseStringISO(start, end) {\r\n        var s = \"\";\r\n        for (var i = start; i < end; ++i)\r\n            s += String.fromCharCode(this.get(i));\r\n        return s;\r\n    };\r\n\r\n    parseStringUTF(start, end) {\r\n        var s = \"\";\r\n        for (var i = start; i < end;) {\r\n            var c = this.get(i++);\r\n            if (c < 128)\r\n                s += String.fromCharCode(c);\r\n            else if ((c > 191) && (c < 224))\r\n                s += String.fromCharCode(((c & 0x1F) << 6) | (this.get(i++) & 0x3F));\r\n            else\r\n                s += String.fromCharCode(((c & 0x0F) << 12) | ((this.get(i++) & 0x3F) << 6) | (this.get(i++) & 0x3F));\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseStringBMP(start, end) {\r\n        var str = \"\"\r\n        for (var i = start; i < end; i += 2) {\r\n            var high_byte = this.get(i);\r\n            var low_byte = this.get(i + 1);\r\n            str += String.fromCharCode((high_byte << 8) + low_byte);\r\n        }\r\n\r\n        return str;\r\n    };\r\n\r\n    parseTime(start, end) {\r\n        var s = this.parseStringISO(start, end),\r\n            m = Stream.reTime.exec(s);\r\n        if (!m)\r\n            return \"Unrecognized time: \" + s;\r\n        s = m[1] + \"-\" + m[2] + \"-\" + m[3] + \" \" + m[4];\r\n        if (m[5]) {\r\n            s += \":\" + m[5];\r\n            if (m[6]) {\r\n                s += \":\" + m[6];\r\n                if (m[7])\r\n                    s += \".\" + m[7];\r\n            }\r\n        }\r\n        if (m[8]) {\r\n            s += \" UTC\";\r\n            if (m[8] != 'Z') {\r\n                s += m[8];\r\n                if (m[9])\r\n                    s += \":\" + m[9];\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseInteger(start, end) {\r\n        //TODO support negative numbers\r\n        var len = end - start;\r\n        if (len > 4) {\r\n            len <<= 3;\r\n            var s = this.get(start);\r\n            if (s === 0)\r\n                len -= 8;\r\n            else\r\n                while (s < 128) {\r\n                    s <<= 1;\r\n                    --len;\r\n                }\r\n            return \"(\" + len + \" bit)\";\r\n        }\r\n        var n = 0;\r\n        for (var i = start; i < end; ++i)\r\n            n = (n << 8) | this.get(i);\r\n        return n;\r\n    };\r\n\r\n    parseBitString(start, end) {\r\n        var unusedBit = this.get(start),\r\n            lenBit = ((end - start - 1) << 3) - unusedBit,\r\n            s = \"(\" + lenBit + \" bit)\";\r\n        if (lenBit <= 20) {\r\n            var skip = unusedBit;\r\n            s += \" \";\r\n            for (var i = end - 1; i > start; --i) {\r\n                var b = this.get(i);\r\n                for (var j = skip; j < 8; ++j)\r\n                    s += (b >> j) & 1 ? \"1\" : \"0\";\r\n                skip = 0;\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n\r\n    parseOctetString(start, end) {\r\n        var len = end - start,\r\n            s = \"(\" + len + \" byte) \";\r\n        if (len > hardLimit)\r\n            end = start + hardLimit;\r\n        for (var i = start; i < end; ++i)\r\n            s += this.hexByte(this.get(i)); //TODO: also try Latin1?\r\n        if (len > hardLimit)\r\n            s += ellipsis;\r\n        return s;\r\n    };\r\n\r\n    parseOID(start, end) {\r\n        var s = '',\r\n            n = 0,\r\n            bits = 0;\r\n        for (var i = start; i < end; ++i) {\r\n            var v = this.get(i);\r\n            n = (n << 7) | (v & 0x7F);\r\n            bits += 7;\r\n            if (!(v & 0x80)) { // finished\r\n                if (s === '') {\r\n                    var m = n < 80 ? n < 40 ? 0 : 1 : 2;\r\n                    s = m + \".\" + (n - m * 40);\r\n                } else\r\n                    s += \".\" + ((bits >= 31) ? \"bigint\" : n);\r\n                n = bits = 0;\r\n            }\r\n        }\r\n        return s;\r\n    };\r\n}\r\n\r\nexport class ASN1 {\r\n    static get reSeemsASCII() {\r\n        return /^[ -~]+$/;\r\n    }\r\n\r\n    constructor(stream, header, length, tag, sub) {\r\n        this.stream = stream;\r\n        this.header = header;\r\n        this.length = length;\r\n        this.tag = tag;\r\n        this.sub = sub;\r\n    }\r\n\r\n    typeName() {\r\n        if (this.tag === undefined)\r\n            return \"unknown\";\r\n        var tagClass = this.tag >> 6,\r\n            tagConstructed = (this.tag >> 5) & 1,\r\n            tagNumber = this.tag & 0x1F;\r\n        switch (tagClass) {\r\n            case 0: // universal\r\n                switch (tagNumber) {\r\n                    case 0x00:\r\n                        return \"EOC\";\r\n                    case 0x01:\r\n                        return \"BOOLEAN\";\r\n                    case 0x02:\r\n                        return \"INTEGER\";\r\n                    case 0x03:\r\n                        return \"BIT_STRING\";\r\n                    case 0x04:\r\n                        return \"OCTET_STRING\";\r\n                    case 0x05:\r\n                        return \"NULL\";\r\n                    case 0x06:\r\n                        return \"OBJECT_IDENTIFIER\";\r\n                    case 0x07:\r\n                        return \"ObjectDescriptor\";\r\n                    case 0x08:\r\n                        return \"EXTERNAL\";\r\n                    case 0x09:\r\n                        return \"REAL\";\r\n                    case 0x0A:\r\n                        return \"ENUMERATED\";\r\n                    case 0x0B:\r\n                        return \"EMBEDDED_PDV\";\r\n                    case 0x0C:\r\n                        return \"UTF8String\";\r\n                    case 0x10:\r\n                        return \"SEQUENCE\";\r\n                    case 0x11:\r\n                        return \"SET\";\r\n                    case 0x12:\r\n                        return \"NumericString\";\r\n                    case 0x13:\r\n                        return \"PrintableString\"; // ASCII subset\r\n                    case 0x14:\r\n                        return \"TeletexString\"; // aka T61String\r\n                    case 0x15:\r\n                        return \"VideotexString\";\r\n                    case 0x16:\r\n                        return \"IA5String\"; // ASCII\r\n                    case 0x17:\r\n                        return \"UTCTime\";\r\n                    case 0x18:\r\n                        return \"GeneralizedTime\";\r\n                    case 0x19:\r\n                        return \"GraphicString\";\r\n                    case 0x1A:\r\n                        return \"VisibleString\"; // ASCII subset\r\n                    case 0x1B:\r\n                        return \"GeneralString\";\r\n                    case 0x1C:\r\n                        return \"UniversalString\";\r\n                    case 0x1E:\r\n                        return \"BMPString\";\r\n                    default:\r\n                        return \"Universal_\" + tagNumber.toString(16);\r\n                }\r\n            case 1:\r\n                return \"Application_\" + tagNumber.toString(16);\r\n            case 2:\r\n                return \"[\" + tagNumber + \"]\"; // Context\r\n            case 3:\r\n                return \"Private_\" + tagNumber.toString(16);\r\n        }\r\n    }\r\n\r\n    content() {\r\n        if (this.tag === undefined)\r\n            return null;\r\n        var tagClass = this.tag >> 6,\r\n            tagNumber = this.tag & 0x1F,\r\n            content = this.posContent(),\r\n            len = Math.abs(this.length);\r\n        if (tagClass !== 0) { // universal\r\n            if (this.sub !== null)\r\n                return \"(\" + this.sub.length + \" elem)\";\r\n            //TODO: TRY TO PARSE ASCII STRING\r\n            var s = this.stream.parseStringISO(content, content + Math.min(len, hardLimit));\r\n            if (ASN1.reSeemsASCII.test(s))\r\n                return s.substring(0, 2 * hardLimit) + ((s.length > 2 * hardLimit) ? ellipsis : \"\");\r\n            else\r\n                return this.stream.parseOctetString(content, content + len);\r\n        }\r\n        switch (tagNumber) {\r\n            case 0x01: // BOOLEAN\r\n                return (this.stream.get(content) === 0) ? \"false\" : \"true\";\r\n            case 0x02: // INTEGER\r\n                return this.stream.parseInteger(content, content + len);\r\n            case 0x03: // BIT_STRING\r\n                return this.sub ? \"(\" + this.sub.length + \" elem)\" :\r\n                    this.stream.parseBitString(content, content + len);\r\n            case 0x04: // OCTET_STRING\r\n                return this.sub ? \"(\" + this.sub.length + \" elem)\" :\r\n                    this.stream.parseOctetString(content, content + len);\r\n            //case 0x05: // NULL\r\n            case 0x06: // OBJECT_IDENTIFIER\r\n                return this.stream.parseOID(content, content + len);\r\n            //case 0x07: // ObjectDescriptor\r\n            //case 0x08: // EXTERNAL\r\n            //case 0x09: // REAL\r\n            //case 0x0A: // ENUMERATED\r\n            //case 0x0B: // EMBEDDED_PDV\r\n            case 0x10: // SEQUENCE\r\n            case 0x11: // SET\r\n                return \"(\" + this.sub.length + \" elem)\";\r\n            case 0x0C: // UTF8String\r\n                return this.stream.parseStringUTF(content, content + len);\r\n            case 0x12: // NumericString\r\n            case 0x13: // PrintableString\r\n            case 0x14: // TeletexString\r\n            case 0x15: // VideotexString\r\n            case 0x16: // IA5String\r\n            //case 0x19: // GraphicString\r\n            case 0x1A: // VisibleString\r\n                //case 0x1B: // GeneralString\r\n                //case 0x1C: // UniversalString\r\n                return this.stream.parseStringISO(content, content + len);\r\n            case 0x1E: // BMPString\r\n                return this.stream.parseStringBMP(content, content + len);\r\n            case 0x17: // UTCTime\r\n            case 0x18: // GeneralizedTime\r\n                return this.stream.parseTime(content, content + len);\r\n        }\r\n        return null;\r\n    };\r\n\r\n    toString() {\r\n        return this.typeName() + \"@\" + this.stream.pos + \"[header:\" + this.header + \",length:\" + this.length + \",sub:\" + ((this.sub === null) ? 'null' : this.sub.length) + \"]\";\r\n    };\r\n\r\n    print(indent) {\r\n        if (indent === undefined) indent = '';\r\n        document.writeln(indent + this);\r\n        if (this.sub !== null) {\r\n            indent += '  ';\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                this.sub[i].print(indent);\r\n        }\r\n    };\r\n\r\n    toPrettyString(indent) {\r\n        if (indent === undefined) indent = '';\r\n        var s = indent + this.typeName() + \" @\" + this.stream.pos;\r\n        if (this.length >= 0)\r\n            s += \"+\";\r\n        s += this.length;\r\n        if (this.tag & 0x20)\r\n            s += \" (constructed)\";\r\n        else if (((this.tag == 0x03) || (this.tag == 0x04)) && (this.sub !== null))\r\n            s += \" (encapsulates)\";\r\n        s += \"\\n\";\r\n        if (this.sub !== null) {\r\n            indent += '  ';\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                s += this.sub[i].toPrettyString(indent);\r\n        }\r\n        return s;\r\n    };\r\n\r\n    toDOM() {\r\n        var node = DOM.tag(\"div\", \"node\");\r\n        node.asn1 = this;\r\n        var head = DOM.tag(\"div\", \"head\");\r\n        var s = this.typeName().replace(/_/g, \" \");\r\n        head.innerHTML = s;\r\n        var content = this.content();\r\n        if (content !== null) {\r\n            content = String(content).replace(/</g, \"&lt;\");\r\n            var preview = DOM.tag(\"span\", \"preview\");\r\n            preview.appendChild(DOM.text(content));\r\n            head.appendChild(preview);\r\n        }\r\n        node.appendChild(head);\r\n        this.node = node;\r\n        this.head = head;\r\n        var value = DOM.tag(\"div\", \"value\");\r\n        s = \"Offset: \" + this.stream.pos + \"<br/>\";\r\n        s += \"Length: \" + this.header + \"+\";\r\n        if (this.length >= 0)\r\n            s += this.length;\r\n        else\r\n            s += (-this.length) + \" (undefined)\";\r\n        if (this.tag & 0x20)\r\n            s += \"<br/>(constructed)\";\r\n        else if (((this.tag == 0x03) || (this.tag == 0x04)) && (this.sub !== null))\r\n            s += \"<br/>(encapsulates)\";\r\n        //TODO if (this.tag == 0x03) s += \"Unused bits: \"\r\n        if (content !== null) {\r\n            s += \"<br/>Value:<br/><b>\" + content + \"</b>\";\r\n            if ((typeof oids === 'object') && (this.tag == 0x06)) {\r\n                var oid = oids[content];\r\n                if (oid) {\r\n                    if (oid.d) s += \"<br/>\" + oid.d;\r\n                    if (oid.c) s += \"<br/>\" + oid.c;\r\n                    if (oid.w) s += \"<br/>(warning!)\";\r\n                }\r\n            }\r\n        }\r\n        value.innerHTML = s;\r\n        node.appendChild(value);\r\n        var sub = DOM.tag(\"div\", \"sub\");\r\n        if (this.sub !== null) {\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                sub.appendChild(this.sub[i].toDOM());\r\n        }\r\n        node.appendChild(sub);\r\n        head.onclick = function () {\r\n            node.className = (node.className == \"node collapsed\") ? \"node\" : \"node collapsed\";\r\n        };\r\n        return node;\r\n    };\r\n\r\n    posStart() {\r\n        return this.stream.pos;\r\n    };\r\n\r\n    posContent() {\r\n        return this.stream.pos + this.header;\r\n    };\r\n\r\n    posEnd() {\r\n        return this.stream.pos + this.header + Math.abs(this.length);\r\n    };\r\n\r\n    fakeHover(current) {\r\n        this.node.className += \" hover\";\r\n        if (current)\r\n            this.head.className += \" hover\";\r\n    };\r\n\r\n    fakeOut(current) {\r\n        var re = / ?hover/;\r\n        this.node.className = this.node.className.replace(re, \"\");\r\n        if (current)\r\n            this.head.className = this.head.className.replace(re, \"\");\r\n    };\r\n\r\n    toHexDOM_sub(node, className, stream, start, end) {\r\n        if (start >= end)\r\n            return;\r\n        var sub = DOM.tag(\"span\", className);\r\n        sub.appendChild(DOM.text(\r\n            stream.hexDump(start, end)));\r\n        node.appendChild(sub);\r\n    };\r\n\r\n    toHexDOM(root) {\r\n        var node = DOM.tag(\"span\", \"hex\");\r\n        if (root === undefined) root = node;\r\n        this.head.hexNode = node;\r\n        this.head.onmouseover = function () {\r\n            this.hexNode.className = \"hexCurrent\";\r\n        };\r\n        this.head.onmouseout = function () {\r\n            this.hexNode.className = \"hex\";\r\n        };\r\n        node.asn1 = this;\r\n        node.onmouseover = function () {\r\n            var current = !root.selected;\r\n            if (current) {\r\n                root.selected = this.asn1;\r\n                this.className = \"hexCurrent\";\r\n            }\r\n            this.asn1.fakeHover(current);\r\n        };\r\n        node.onmouseout = function () {\r\n            var current = (root.selected == this.asn1);\r\n            this.asn1.fakeOut(current);\r\n            if (current) {\r\n                root.selected = null;\r\n                this.className = \"hex\";\r\n            }\r\n        };\r\n        this.toHexDOM_sub(node, \"tag\", this.stream, this.posStart(), this.posStart() + 1);\r\n        this.toHexDOM_sub(node, (this.length >= 0) ? \"dlen\" : \"ulen\", this.stream, this.posStart() + 1, this.posContent());\r\n        if (this.sub === null)\r\n            node.appendChild(DOM.text(\r\n                this.stream.hexDump(this.posContent(), this.posEnd())));\r\n        else if (this.sub.length > 0) {\r\n            var first = this.sub[0];\r\n            var last = this.sub[this.sub.length - 1];\r\n            this.toHexDOM_sub(node, \"intro\", this.stream, this.posContent(), first.posStart());\r\n            for (var i = 0, max = this.sub.length; i < max; ++i)\r\n                node.appendChild(this.sub[i].toHexDOM(root));\r\n            this.toHexDOM_sub(node, \"outro\", this.stream, last.posEnd(), this.posEnd());\r\n        }\r\n        return node;\r\n    };\r\n\r\n    toHexString(root) {\r\n        return this.stream.hexDump(this.posStart(), this.posEnd(), true);\r\n    };\r\n\r\n}\r\n\r\nASN1.decodeLength = function (stream) {\r\n    var buf = stream.get(),\r\n        len = buf & 0x7F;\r\n    if (len == buf)\r\n        return len;\r\n    if (len > 3)\r\n        throw \"Length over 24 bits not supported at position \" + (stream.pos - 1);\r\n    if (len === 0)\r\n        return -1; // undefined\r\n    buf = 0;\r\n    for (var i = 0; i < len; ++i)\r\n        buf = (buf << 8) | stream.get();\r\n    return buf;\r\n};\r\nASN1.hasContent = function (tag, len, stream) {\r\n    if (tag & 0x20) // constructed\r\n        return true;\r\n    if ((tag < 0x03) || (tag > 0x04))\r\n        return false;\r\n    var p = new Stream(stream);\r\n    if (tag == 0x03) p.get(); // BitString unused bits, must be in [0, 7]\r\n    var subTag = p.get();\r\n    if ((subTag >> 6) & 0x01) // not (universal or context)\r\n        return false;\r\n    try {\r\n        var subLength = ASN1.decodeLength(p);\r\n        return ((p.pos - stream.pos) + subLength == len);\r\n    } catch (exception) {\r\n        return false;\r\n    }\r\n};\r\nASN1.decode = function (stream) {\r\n    if (!(stream instanceof Stream))\r\n        stream = new Stream(stream, 0);\r\n    var streamStart = new Stream(stream),\r\n        tag = stream.get(),\r\n        len = ASN1.decodeLength(stream),\r\n        header = stream.pos - streamStart.pos,\r\n        sub = null;\r\n    if (ASN1.hasContent(tag, len, stream)) {\r\n        // it has content, so we decode it\r\n        var start = stream.pos;\r\n        if (tag == 0x03) stream.get(); // skip BitString unused bits, must be in [0, 7]\r\n        sub = [];\r\n        if (len >= 0) {\r\n            // definite length\r\n            var end = start + len;\r\n            while (stream.pos < end)\r\n                sub[sub.length] = ASN1.decode(stream);\r\n            if (stream.pos != end)\r\n                throw \"Content size is not correct for container starting at offset \" + start;\r\n        } else {\r\n            // undefined length\r\n            try {\r\n                for (; ;) {\r\n                    var s = ASN1.decode(stream);\r\n                    if (s.tag === 0)\r\n                        break;\r\n                    sub[sub.length] = s;\r\n                }\r\n                len = start - stream.pos;\r\n            } catch (e) {\r\n                throw \"Exception while decoding undefined length content: \" + e;\r\n            }\r\n        }\r\n    } else\r\n        stream.pos += len; // skip content\r\n    return new ASN1(streamStart, header, len, tag, sub);\r\n};\r\nASN1.test = function () {\r\n    var test = [\r\n        {value: [0x27], expected: 0x27},\r\n        {value: [0x81, 0xC9], expected: 0xC9},\r\n        {value: [0x83, 0xFE, 0xDC, 0xBA], expected: 0xFEDCBA}\r\n    ];\r\n    for (var i = 0, max = test.length; i < max; ++i) {\r\n        var pos = 0,\r\n            stream = new Stream(test[i].value, 0),\r\n            res = ASN1.decodeLength(stream);\r\n        if (res != test[i].expected)\r\n            document.write(\"In test[\" + i + \"] expected \" + test[i].expected + \" got \" + res + \"\\n\");\r\n    }\r\n};","// prng4.js - uses Arcfour as a PRNG\r\n\r\nexport class Arcfour {\r\n  constructor() {\r\n    this.i = 0;\r\n    this.j = 0;\r\n    this.S = [];\r\n  }\r\n}\r\n\r\n// Initialize arcfour context from key, an array of ints, each from [0..255]\r\nfunction ARC4init(key) {\r\n  var i, j, t;\r\n  for(i = 0; i < 256; ++i)\r\n    this.S[i] = i;\r\n  j = 0;\r\n  for(i = 0; i < 256; ++i) {\r\n    j = (j + this.S[i] + key[i % key.length]) & 255;\r\n    t = this.S[i];\r\n    this.S[i] = this.S[j];\r\n    this.S[j] = t;\r\n  }\r\n  this.i = 0;\r\n  this.j = 0;\r\n}\r\n\r\nfunction ARC4next() {\r\n  var t;\r\n  this.i = (this.i + 1) & 255;\r\n  this.j = (this.j + this.S[this.i]) & 255;\r\n  t = this.S[this.i];\r\n  this.S[this.i] = this.S[this.j];\r\n  this.S[this.j] = t;\r\n  return this.S[(t + this.S[this.i]) & 255];\r\n}\r\n\r\nArcfour.prototype.init = ARC4init;\r\nArcfour.prototype.next = ARC4next;\r\n\r\n// Plug in your RNG constructor here\r\nexport function prng_newstate() {\r\n  return new Arcfour();\r\n}\r\n\r\n// Pool size must be a multiple of 4 and greater than 32.\r\n// An array of bytes the size of the pool will be passed to init()\r\nexport var rng_psize = 256;\r\n","import {rng_psize} from \"./prng4\";\r\nimport {prng_newstate} from \"./prng4\";\r\n// Random number generator - requires a PRNG backend, e.g. prng4.js\r\nvar rng_state;\r\nvar rng_pool;\r\nvar rng_pptr;\r\n\r\n// Initialize the pool with junk if needed.\r\nif(rng_pool == null) {\r\n  rng_pool = new Array();\r\n  rng_pptr = 0;\r\n  var t;\r\n  if(window.crypto && window.crypto.getRandomValues) {\r\n    // Extract entropy (2048 bits) from RNG if available\r\n    var z = new Uint32Array(256);\r\n    window.crypto.getRandomValues(z);\r\n    for (t = 0; t < z.length; ++t)\r\n      rng_pool[rng_pptr++] = z[t] & 255;\r\n  }\r\n\r\n  // Use mouse events for entropy, if we do not have enough entropy by the time\r\n  // we need it, entropy will be generated by Math.random.\r\n  var onMouseMoveListener = function(ev) {\r\n    this.count = this.count || 0;\r\n    if (this.count >= 256 || rng_pptr >= rng_psize) {\r\n      if (window.removeEventListener)\r\n        window.removeEventListener(\"mousemove\", onMouseMoveListener, false);\r\n      else if (window.detachEvent)\r\n        window.detachEvent(\"onmousemove\", onMouseMoveListener);\r\n      return;\r\n    }\r\n    try {\r\n      var mouseCoordinates = ev.x + ev.y;\r\n      rng_pool[rng_pptr++] = mouseCoordinates & 255;\r\n      this.count += 1;\r\n    } catch (e) {\r\n      // Sometimes Firefox will deny permission to access event properties for some reason. Ignore.\r\n    }\r\n  };\r\n  if (window.addEventListener)\r\n    window.addEventListener(\"mousemove\", onMouseMoveListener, false);\r\n  else if (window.attachEvent)\r\n    window.attachEvent(\"onmousemove\", onMouseMoveListener);\r\n\r\n}\r\n\r\nfunction rng_get_byte() {\r\n  if(rng_state == null) {\r\n    rng_state = prng_newstate();\r\n    // At this point, we may not have collected enough entropy.  If not, fall back to Math.random\r\n    while (rng_pptr < rng_psize) {\r\n      var random = Math.floor(65536 * Math.random());\r\n      rng_pool[rng_pptr++] = random & 255;\r\n    }\r\n    rng_state.init(rng_pool);\r\n    for(rng_pptr = 0; rng_pptr < rng_pool.length; ++rng_pptr)\r\n      rng_pool[rng_pptr] = 0;\r\n    rng_pptr = 0;\r\n  }\r\n  // TODO: allow reseeding after first request\r\n  return rng_state.next();\r\n}\r\n\r\nfunction rng_get_bytes(ba) {\r\n  var i;\r\n  for(i = 0; i < ba.length; ++i) ba[i] = rng_get_byte();\r\n}\r\n\r\nexport class SecureRandom {\r\n  constructor(){}\r\n}\r\n\r\nSecureRandom.prototype.nextBytes = rng_get_bytes;\r\n","// Copyright (c) 2005  Tom Wu\r\n// All Rights Reserved.\r\n// See \"LICENSE\" for details.\r\n\r\n// Basic JavaScript BN library - subset useful for RSA encryption.\r\n\r\n// Bits per digit\r\nvar dbits;\r\n\r\n// JavaScript engine analysis\r\nvar canary = 0xdeadbeefcafe;\r\nvar j_lm = ((canary&0xffffff)==0xefcafe);\r\n\r\n// (public) Constructor\r\nexport class BigInteger {\r\n  constructor(a,b,c) {\r\n    if (a != null)\r\n      if (\"number\" == typeof a) this.fromNumber(a, b, c);\r\n      else if (b == null && \"string\" != typeof a) this.fromString(a, 256);\r\n      else this.fromString(a, b);\r\n  }\r\n}\r\n\r\n// return new, unset BigInteger\r\nexport function nbi() { return new BigInteger(null); }\r\n\r\n// am: Compute w_j += (x*this_i), propagate carries,\r\n// c is initial carry, returns final carry.\r\n// c < 3*dvalue, x < 2*dvalue, this_i < dvalue\r\n// We need to select the fastest one that works in this environment.\r\n\r\n// am1: use a single mult and divide to get the high bits,\r\n// max digit bits should be 26 because\r\n// max internal value = 2*dvalue^2-2*dvalue (< 2^53)\r\nfunction am1(i,x,w,j,c,n) {\r\n  while(--n >= 0) {\r\n    var v = x*this[i++]+w[j]+c;\r\n    c = Math.floor(v/0x4000000);\r\n    w[j++] = v&0x3ffffff;\r\n  }\r\n  return c;\r\n}\r\n// am2 avoids a big mult-and-extract completely.\r\n// Max digit bits should be <= 30 because we do bitwise ops\r\n// on values up to 2*hdvalue^2-hdvalue-1 (< 2^31)\r\nfunction am2(i,x,w,j,c,n) {\r\n  var xl = x&0x7fff, xh = x>>15;\r\n  while(--n >= 0) {\r\n    var l = this[i]&0x7fff;\r\n    var h = this[i++]>>15;\r\n    var m = xh*l+h*xl;\r\n    l = xl*l+((m&0x7fff)<<15)+w[j]+(c&0x3fffffff);\r\n    c = (l>>>30)+(m>>>15)+xh*h+(c>>>30);\r\n    w[j++] = l&0x3fffffff;\r\n  }\r\n  return c;\r\n}\r\n// Alternately, set max digit bits to 28 since some\r\n// browsers slow down when dealing with 32-bit numbers.\r\nfunction am3(i,x,w,j,c,n) {\r\n  var xl = x&0x3fff, xh = x>>14;\r\n  while(--n >= 0) {\r\n    var l = this[i]&0x3fff;\r\n    var h = this[i++]>>14;\r\n    var m = xh*l+h*xl;\r\n    l = xl*l+((m&0x3fff)<<14)+w[j]+c;\r\n    c = (l>>28)+(m>>14)+xh*h;\r\n    w[j++] = l&0xfffffff;\r\n  }\r\n  return c;\r\n}\r\nif(j_lm && (navigator.appName == \"Microsoft Internet Explorer\")) {\r\n  BigInteger.prototype.am = am2;\r\n  dbits = 30;\r\n}\r\nelse if(j_lm && (navigator.appName != \"Netscape\")) {\r\n  BigInteger.prototype.am = am1;\r\n  dbits = 26;\r\n}\r\nelse { // Mozilla/Netscape seems to prefer am3\r\n  BigInteger.prototype.am = am3;\r\n  dbits = 28;\r\n}\r\n\r\nBigInteger.prototype.DB = dbits;\r\nBigInteger.prototype.DM = ((1<<dbits)-1);\r\nBigInteger.prototype.DV = (1<<dbits);\r\n\r\nvar BI_FP = 52;\r\nBigInteger.prototype.FV = Math.pow(2,BI_FP);\r\nBigInteger.prototype.F1 = BI_FP-dbits;\r\nBigInteger.prototype.F2 = 2*dbits-BI_FP;\r\n\r\n// Digit conversions\r\nvar BI_RM = \"0123456789abcdefghijklmnopqrstuvwxyz\";\r\nvar BI_RC = [];\r\nvar rr,vv;\r\nrr = \"0\".charCodeAt(0);\r\nfor(vv = 0; vv <= 9; ++vv) BI_RC[rr++] = vv;\r\nrr = \"a\".charCodeAt(0);\r\nfor(vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;\r\nrr = \"A\".charCodeAt(0);\r\nfor(vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;\r\n\r\nexport function int2char(n) { return BI_RM.charAt(n); }\r\nexport function intAt(s,i) {\r\n  var c = BI_RC[s.charCodeAt(i)];\r\n  return (c==null)?-1:c;\r\n}\r\n\r\n// (protected) copy this to r\r\nfunction bnpCopyTo(r) {\r\n  for(var i = this.t-1; i >= 0; --i) r[i] = this[i];\r\n  r.t = this.t;\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) set from integer value x, -DV <= x < DV\r\nfunction bnpFromInt(x) {\r\n  this.t = 1;\r\n  this.s = (x<0)?-1:0;\r\n  if(x > 0) this[0] = x;\r\n  else if(x < -1) this[0] = x+this.DV;\r\n  else this.t = 0;\r\n}\r\n\r\n// return bigint initialized to value\r\nexport function nbv(i) { var r = nbi(); r.fromInt(i); return r; }\r\n\r\n// (protected) set from string and radix\r\nfunction bnpFromString(s,b) {\r\n  var k;\r\n  if(b == 16) k = 4;\r\n  else if(b == 8) k = 3;\r\n  else if(b == 256) k = 8; // byte array\r\n  else if(b == 2) k = 1;\r\n  else if(b == 32) k = 5;\r\n  else if(b == 4) k = 2;\r\n  else { this.fromRadix(s,b); return; }\r\n  this.t = 0;\r\n  this.s = 0;\r\n  var i = s.length, mi = false, sh = 0;\r\n  while(--i >= 0) {\r\n    var x = (k==8)?s[i]&0xff:intAt(s,i);\r\n    if(x < 0) {\r\n      if(s.charAt(i) == \"-\") mi = true;\r\n      continue;\r\n    }\r\n    mi = false;\r\n    if(sh == 0)\r\n      this[this.t++] = x;\r\n    else if(sh+k > this.DB) {\r\n      this[this.t-1] |= (x&((1<<(this.DB-sh))-1))<<sh;\r\n      this[this.t++] = (x>>(this.DB-sh));\r\n    }\r\n    else\r\n      this[this.t-1] |= x<<sh;\r\n    sh += k;\r\n    if(sh >= this.DB) sh -= this.DB;\r\n  }\r\n  if(k == 8 && (s[0]&0x80) != 0) {\r\n    this.s = -1;\r\n    if(sh > 0) this[this.t-1] |= ((1<<(this.DB-sh))-1)<<sh;\r\n  }\r\n  this.clamp();\r\n  if(mi) BigInteger.ZERO.subTo(this,this);\r\n}\r\n\r\n// (protected) clamp off excess high words\r\nfunction bnpClamp() {\r\n  var c = this.s&this.DM;\r\n  while(this.t > 0 && this[this.t-1] == c) --this.t;\r\n}\r\n\r\n// (public) return string representation in given radix\r\nfunction bnToString(b) {\r\n  if(this.s < 0) return \"-\"+this.negate().toString(b);\r\n  var k;\r\n  if(b == 16) k = 4;\r\n  else if(b == 8) k = 3;\r\n  else if(b == 2) k = 1;\r\n  else if(b == 32) k = 5;\r\n  else if(b == 4) k = 2;\r\n  else return this.toRadix(b);\r\n  var km = (1<<k)-1, d, m = false, r = \"\", i = this.t;\r\n  var p = this.DB-(i*this.DB)%k;\r\n  if(i-- > 0) {\r\n    if(p < this.DB && (d = this[i]>>p) > 0) { m = true; r = int2char(d); }\r\n    while(i >= 0) {\r\n      if(p < k) {\r\n        d = (this[i]&((1<<p)-1))<<(k-p);\r\n        d |= this[--i]>>(p+=this.DB-k);\r\n      }\r\n      else {\r\n        d = (this[i]>>(p-=k))&km;\r\n        if(p <= 0) { p += this.DB; --i; }\r\n      }\r\n      if(d > 0) m = true;\r\n      if(m) r += int2char(d);\r\n    }\r\n  }\r\n  return m?r:\"0\";\r\n}\r\n\r\n// (public) -this\r\nfunction bnNegate() { var r = nbi(); BigInteger.ZERO.subTo(this,r); return r; }\r\n\r\n// (public) |this|\r\nfunction bnAbs() { return (this.s<0)?this.negate():this; }\r\n\r\n// (public) return + if this > a, - if this < a, 0 if equal\r\nfunction bnCompareTo(a) {\r\n  var r = this.s-a.s;\r\n  if(r != 0) return r;\r\n  var i = this.t;\r\n  r = i-a.t;\r\n  if(r != 0) return (this.s<0)?-r:r;\r\n  while(--i >= 0) if((r=this[i]-a[i]) != 0) return r;\r\n  return 0;\r\n}\r\n\r\n// returns bit length of the integer x\r\nexport function nbits(x) {\r\n  var r = 1, t;\r\n  if((t=x>>>16) != 0) { x = t; r += 16; }\r\n  if((t=x>>8) != 0) { x = t; r += 8; }\r\n  if((t=x>>4) != 0) { x = t; r += 4; }\r\n  if((t=x>>2) != 0) { x = t; r += 2; }\r\n  if((t=x>>1) != 0) { x = t; r += 1; }\r\n  return r;\r\n}\r\n\r\n// (public) return the number of bits in \"this\"\r\nfunction bnBitLength() {\r\n  if(this.t <= 0) return 0;\r\n  return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM));\r\n}\r\n\r\n// (protected) r = this << n*DB\r\nfunction bnpDLShiftTo(n,r) {\r\n  var i;\r\n  for(i = this.t-1; i >= 0; --i) r[i+n] = this[i];\r\n  for(i = n-1; i >= 0; --i) r[i] = 0;\r\n  r.t = this.t+n;\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) r = this >> n*DB\r\nfunction bnpDRShiftTo(n,r) {\r\n  for(var i = n; i < this.t; ++i) r[i-n] = this[i];\r\n  r.t = Math.max(this.t-n,0);\r\n  r.s = this.s;\r\n}\r\n\r\n// (protected) r = this << n\r\nfunction bnpLShiftTo(n,r) {\r\n  var bs = n%this.DB;\r\n  var cbs = this.DB-bs;\r\n  var bm = (1<<cbs)-1;\r\n  var ds = Math.floor(n/this.DB), c = (this.s<<bs)&this.DM, i;\r\n  for(i = this.t-1; i >= 0; --i) {\r\n    r[i+ds+1] = (this[i]>>cbs)|c;\r\n    c = (this[i]&bm)<<bs;\r\n  }\r\n  for(i = ds-1; i >= 0; --i) r[i] = 0;\r\n  r[ds] = c;\r\n  r.t = this.t+ds+1;\r\n  r.s = this.s;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this >> n\r\nfunction bnpRShiftTo(n,r) {\r\n  r.s = this.s;\r\n  var ds = Math.floor(n/this.DB);\r\n  if(ds >= this.t) { r.t = 0; return; }\r\n  var bs = n%this.DB;\r\n  var cbs = this.DB-bs;\r\n  var bm = (1<<bs)-1;\r\n  r[0] = this[ds]>>bs;\r\n  for(var i = ds+1; i < this.t; ++i) {\r\n    r[i-ds-1] |= (this[i]&bm)<<cbs;\r\n    r[i-ds] = this[i]>>bs;\r\n  }\r\n  if(bs > 0) r[this.t-ds-1] |= (this.s&bm)<<cbs;\r\n  r.t = this.t-ds;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this - a\r\nfunction bnpSubTo(a,r) {\r\n  var i = 0, c = 0, m = Math.min(a.t,this.t);\r\n  while(i < m) {\r\n    c += this[i]-a[i];\r\n    r[i++] = c&this.DM;\r\n    c >>= this.DB;\r\n  }\r\n  if(a.t < this.t) {\r\n    c -= a.s;\r\n    while(i < this.t) {\r\n      c += this[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += this.s;\r\n  }\r\n  else {\r\n    c += this.s;\r\n    while(i < a.t) {\r\n      c -= a[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c -= a.s;\r\n  }\r\n  r.s = (c<0)?-1:0;\r\n  if(c < -1) r[i++] = this.DV+c;\r\n  else if(c > 0) r[i++] = c;\r\n  r.t = i;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = this * a, r != this,a (HAC 14.12)\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyTo(a,r) {\r\n  var x = this.abs(), y = a.abs();\r\n  var i = x.t;\r\n  r.t = i+y.t;\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = 0; i < y.t; ++i) r[i+x.t] = x.am(0,y[i],r,i,0,x.t);\r\n  r.s = 0;\r\n  r.clamp();\r\n  if(this.s != a.s) BigInteger.ZERO.subTo(r,r);\r\n}\r\n\r\n// (protected) r = this^2, r != this (HAC 14.16)\r\nfunction bnpSquareTo(r) {\r\n  var x = this.abs();\r\n  var i = r.t = 2*x.t;\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = 0; i < x.t-1; ++i) {\r\n    var c = x.am(i,x[i],r,2*i,0,1);\r\n    if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1)) >= x.DV) {\r\n      r[i+x.t] -= x.DV;\r\n      r[i+x.t+1] = 1;\r\n    }\r\n  }\r\n  if(r.t > 0) r[r.t-1] += x.am(i,x[i],r,2*i,0,1);\r\n  r.s = 0;\r\n  r.clamp();\r\n}\r\n\r\n// (protected) divide this by m, quotient and remainder to q, r (HAC 14.20)\r\n// r != q, this != m.  q or r may be null.\r\nfunction bnpDivRemTo(m,q,r) {\r\n  var pm = m.abs();\r\n  if(pm.t <= 0) return;\r\n  var pt = this.abs();\r\n  if(pt.t < pm.t) {\r\n    if(q != null) q.fromInt(0);\r\n    if(r != null) this.copyTo(r);\r\n    return;\r\n  }\r\n  if(r == null) r = nbi();\r\n  var y = nbi(), ts = this.s, ms = m.s;\r\n  var nsh = this.DB-nbits(pm[pm.t-1]);\t// normalize modulus\r\n  if(nsh > 0) { pm.lShiftTo(nsh,y); pt.lShiftTo(nsh,r); }\r\n  else { pm.copyTo(y); pt.copyTo(r); }\r\n  var ys = y.t;\r\n  var y0 = y[ys-1];\r\n  if(y0 == 0) return;\r\n  var yt = y0*(1<<this.F1)+((ys>1)?y[ys-2]>>this.F2:0);\r\n  var d1 = this.FV/yt, d2 = (1<<this.F1)/yt, e = 1<<this.F2;\r\n  var i = r.t, j = i-ys, t = (q==null)?nbi():q;\r\n  y.dlShiftTo(j,t);\r\n  if(r.compareTo(t) >= 0) {\r\n    r[r.t++] = 1;\r\n    r.subTo(t,r);\r\n  }\r\n  BigInteger.ONE.dlShiftTo(ys,t);\r\n  t.subTo(y,y);\t// \"negative\" y so we can replace sub with am later\r\n  while(y.t < ys) y[y.t++] = 0;\r\n  while(--j >= 0) {\r\n    // Estimate quotient digit\r\n    var qd = (r[--i]==y0)?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);\r\n    if((r[i]+=y.am(0,qd,r,j,0,ys)) < qd) {\t// Try it out\r\n      y.dlShiftTo(j,t);\r\n      r.subTo(t,r);\r\n      while(r[i] < --qd) r.subTo(t,r);\r\n    }\r\n  }\r\n  if(q != null) {\r\n    r.drShiftTo(ys,q);\r\n    if(ts != ms) BigInteger.ZERO.subTo(q,q);\r\n  }\r\n  r.t = ys;\r\n  r.clamp();\r\n  if(nsh > 0) r.rShiftTo(nsh,r);\t// Denormalize remainder\r\n  if(ts < 0) BigInteger.ZERO.subTo(r,r);\r\n}\r\n\r\n// (public) this mod a\r\nfunction bnMod(a) {\r\n  var r = nbi();\r\n  this.abs().divRemTo(a,null,r);\r\n  if(this.s < 0 && r.compareTo(BigInteger.ZERO) > 0) a.subTo(r,r);\r\n  return r;\r\n}\r\n\r\n// Modular reduction using \"classic\" algorithm\r\nexport class Classic{\r\n  constructor(m){\r\n    this.m = m;\r\n  }\r\n}\r\nfunction cConvert(x) {\r\n  if(x.s < 0 || x.compareTo(this.m) >= 0) return x.mod(this.m);\r\n  else return x;\r\n}\r\nfunction cRevert(x) { return x; }\r\nfunction cReduce(x) { x.divRemTo(this.m,null,x); }\r\nfunction cMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\nfunction cSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\nClassic.prototype.convert = cConvert;\r\nClassic.prototype.revert = cRevert;\r\nClassic.prototype.reduce = cReduce;\r\nClassic.prototype.mulTo = cMulTo;\r\nClassic.prototype.sqrTo = cSqrTo;\r\n\r\n// (protected) return \"-1/this % 2^DB\"; useful for Mont. reduction\r\n// justification:\r\n//         xy == 1 (mod m)\r\n//         xy =  1+km\r\n//   xy(2-xy) = (1+km)(1-km)\r\n// x[y(2-xy)] = 1-k^2m^2\r\n// x[y(2-xy)] == 1 (mod m^2)\r\n// if y is 1/x mod m, then y(2-xy) is 1/x mod m^2\r\n// should reduce x and y(2-xy) by m^2 at each step to keep size bounded.\r\n// JS multiply \"overflows\" differently from C/C++, so care is needed here.\r\nfunction bnpInvDigit() {\r\n  if(this.t < 1) return 0;\r\n  var x = this[0];\r\n  if((x&1) == 0) return 0;\r\n  var y = x&3;\t\t// y == 1/x mod 2^2\r\n  y = (y*(2-(x&0xf)*y))&0xf;\t// y == 1/x mod 2^4\r\n  y = (y*(2-(x&0xff)*y))&0xff;\t// y == 1/x mod 2^8\r\n  y = (y*(2-(((x&0xffff)*y)&0xffff)))&0xffff;\t// y == 1/x mod 2^16\r\n  // last step - calculate inverse mod DV directly;\r\n  // assumes 16 < DB <= 32 and assumes ability to handle 48-bit ints\r\n  y = (y*(2-x*y%this.DV))%this.DV;\t\t// y == 1/x mod 2^dbits\r\n  // we really want the negative inverse, and -DV < y < DV\r\n  return (y>0)?this.DV-y:-y;\r\n}\r\n\r\n// Montgomery reduction\r\nexport class Montgomery {\r\n  constructor(m) {\r\n    this.m = m;\r\n    this.mp = m.invDigit();\r\n    this.mpl = this.mp & 0x7fff;\r\n    this.mph = this.mp >> 15;\r\n    this.um = (1 << (m.DB - 15)) - 1;\r\n    this.mt2 = 2 * m.t;\r\n  }\r\n}\r\n\r\n// xR mod m\r\nfunction montConvert(x) {\r\n  var r = nbi();\r\n  x.abs().dlShiftTo(this.m.t,r);\r\n  r.divRemTo(this.m,null,r);\r\n  if(x.s < 0 && r.compareTo(BigInteger.ZERO) > 0) this.m.subTo(r,r);\r\n  return r;\r\n}\r\n\r\n// x/R mod m\r\nfunction montRevert(x) {\r\n  var r = nbi();\r\n  x.copyTo(r);\r\n  this.reduce(r);\r\n  return r;\r\n}\r\n\r\n// x = x/R mod m (HAC 14.32)\r\nfunction montReduce(x) {\r\n  while(x.t <= this.mt2)\t// pad x so am has enough room later\r\n    x[x.t++] = 0;\r\n  for(var i = 0; i < this.m.t; ++i) {\r\n    // faster way of calculating u0 = x[i]*mp mod DV\r\n    var j = x[i]&0x7fff;\r\n    var u0 = (j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;\r\n    // use am to combine the multiply-shift-add into one call\r\n    j = i+this.m.t;\r\n    x[j] += this.m.am(0,u0,x,i,0,this.m.t);\r\n    // propagate carry\r\n    while(x[j] >= x.DV) { x[j] -= x.DV; x[++j]++; }\r\n  }\r\n  x.clamp();\r\n  x.drShiftTo(this.m.t,x);\r\n  if(x.compareTo(this.m) >= 0) x.subTo(this.m,x);\r\n}\r\n\r\n// r = \"x^2/R mod m\"; x != r\r\nfunction montSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\n// r = \"xy/R mod m\"; x,y != r\r\nfunction montMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\n\r\nMontgomery.prototype.convert = montConvert;\r\nMontgomery.prototype.revert = montRevert;\r\nMontgomery.prototype.reduce = montReduce;\r\nMontgomery.prototype.mulTo = montMulTo;\r\nMontgomery.prototype.sqrTo = montSqrTo;\r\n\r\n// (protected) true iff this is even\r\nfunction bnpIsEven() { return ((this.t>0)?(this[0]&1):this.s) == 0; }\r\n\r\n// (protected) this^e, e < 2^32, doing sqr and mul with \"r\" (HAC 14.79)\r\nfunction bnpExp(e,z) {\r\n  if(e > 0xffffffff || e < 1) return BigInteger.ONE;\r\n  var r = nbi(), r2 = nbi(), g = z.convert(this), i = nbits(e)-1;\r\n  g.copyTo(r);\r\n  while(--i >= 0) {\r\n    z.sqrTo(r,r2);\r\n    if((e&(1<<i)) > 0) z.mulTo(r2,g,r);\r\n    else { var t = r; r = r2; r2 = t; }\r\n  }\r\n  return z.revert(r);\r\n}\r\n\r\n// (public) this^e % m, 0 <= e < 2^32\r\nfunction bnModPowInt(e,m) {\r\n  var z;\r\n  if(e < 256 || m.isEven()) z = new Classic(m); else z = new Montgomery(m);\r\n  return this.exp(e,z);\r\n}\r\n\r\n// protected\r\nBigInteger.prototype.copyTo = bnpCopyTo;\r\nBigInteger.prototype.fromInt = bnpFromInt;\r\nBigInteger.prototype.fromString = bnpFromString;\r\nBigInteger.prototype.clamp = bnpClamp;\r\nBigInteger.prototype.dlShiftTo = bnpDLShiftTo;\r\nBigInteger.prototype.drShiftTo = bnpDRShiftTo;\r\nBigInteger.prototype.lShiftTo = bnpLShiftTo;\r\nBigInteger.prototype.rShiftTo = bnpRShiftTo;\r\nBigInteger.prototype.subTo = bnpSubTo;\r\nBigInteger.prototype.multiplyTo = bnpMultiplyTo;\r\nBigInteger.prototype.squareTo = bnpSquareTo;\r\nBigInteger.prototype.divRemTo = bnpDivRemTo;\r\nBigInteger.prototype.invDigit = bnpInvDigit;\r\nBigInteger.prototype.isEven = bnpIsEven;\r\nBigInteger.prototype.exp = bnpExp;\r\n\r\n// public\r\nBigInteger.prototype.toString = bnToString;\r\nBigInteger.prototype.negate = bnNegate;\r\nBigInteger.prototype.abs = bnAbs;\r\nBigInteger.prototype.compareTo = bnCompareTo;\r\nBigInteger.prototype.bitLength = bnBitLength;\r\nBigInteger.prototype.mod = bnMod;\r\nBigInteger.prototype.modPowInt = bnModPowInt;\r\n\r\n// \"constants\"\r\nBigInteger.ZERO = nbv(0);\r\nBigInteger.ONE = nbv(1);\r\n","// Copyright (c) 2005-2009  Tom Wu\r\n// All Rights Reserved.\r\n// See \"LICENSE\" for details.\r\n\r\n// Extended JavaScript BN functions, required for RSA private ops.\r\n\r\n// Version 1.1: new BigInteger(\"0\", 10) returns \"proper\" zero\r\n// Version 1.2: square() API, isProbablePrime fix\r\n\r\nimport {BigInteger, nbi, nbv, nbits, intAt, Classic, Montgomery} from \"./jsbn\";\r\nexport {BigInteger} from \"./jsbn\";\r\n// (public)\r\nfunction bnClone() { var r = nbi(); this.copyTo(r); return r; }\r\n\r\n// (public) return value as integer\r\nfunction bnIntValue() {\r\n  if(this.s < 0) {\r\n    if(this.t == 1) return this[0]-this.DV;\r\n    else if(this.t == 0) return -1;\r\n  }\r\n  else if(this.t == 1) return this[0];\r\n  else if(this.t == 0) return 0;\r\n  // assumes 16 < DB < 32\r\n  return ((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0];\r\n}\r\n\r\n// (public) return value as byte\r\nfunction bnByteValue() { return (this.t==0)?this.s:(this[0]<<24)>>24; }\r\n\r\n// (public) return value as short (assumes DB>=16)\r\nfunction bnShortValue() { return (this.t==0)?this.s:(this[0]<<16)>>16; }\r\n\r\n// (protected) return x s.t. r^x < DV\r\nfunction bnpChunkSize(r) { return Math.floor(Math.LN2*this.DB/Math.log(r)); }\r\n\r\n// (public) 0 if this == 0, 1 if this > 0\r\nfunction bnSigNum() {\r\n  if(this.s < 0) return -1;\r\n  else if(this.t <= 0 || (this.t == 1 && this[0] <= 0)) return 0;\r\n  else return 1;\r\n}\r\n\r\n// (protected) convert to radix string\r\nfunction bnpToRadix(b) {\r\n  if(b == null) b = 10;\r\n  if(this.signum() == 0 || b < 2 || b > 36) return \"0\";\r\n  var cs = this.chunkSize(b);\r\n  var a = Math.pow(b,cs);\r\n  var d = nbv(a), y = nbi(), z = nbi(), r = \"\";\r\n  this.divRemTo(d,y,z);\r\n  while(y.signum() > 0) {\r\n    r = (a+z.intValue()).toString(b).substr(1) + r;\r\n    y.divRemTo(d,y,z);\r\n  }\r\n  return z.intValue().toString(b) + r;\r\n}\r\n\r\n// (protected) convert from radix string\r\nfunction bnpFromRadix(s,b) {\r\n  this.fromInt(0);\r\n  if(b == null) b = 10;\r\n  var cs = this.chunkSize(b);\r\n  var d = Math.pow(b,cs), mi = false, j = 0, w = 0;\r\n  for(var i = 0; i < s.length; ++i) {\r\n    var x = intAt(s,i);\r\n    if(x < 0) {\r\n      if(s.charAt(i) == \"-\" && this.signum() == 0) mi = true;\r\n      continue;\r\n    }\r\n    w = b*w+x;\r\n    if(++j >= cs) {\r\n      this.dMultiply(d);\r\n      this.dAddOffset(w,0);\r\n      j = 0;\r\n      w = 0;\r\n    }\r\n  }\r\n  if(j > 0) {\r\n    this.dMultiply(Math.pow(b,j));\r\n    this.dAddOffset(w,0);\r\n  }\r\n  if(mi) BigInteger.ZERO.subTo(this,this);\r\n}\r\n\r\n// (protected) alternate constructor\r\nfunction bnpFromNumber(a,b,c) {\r\n  if(\"number\" == typeof b) {\r\n    // new BigInteger(int,int,RNG)\r\n    if(a < 2) this.fromInt(1);\r\n    else {\r\n      this.fromNumber(a,c);\r\n      if(!this.testBit(a-1))\t// force MSB set\r\n        this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);\r\n      if(this.isEven()) this.dAddOffset(1,0); // force odd\r\n      while(!this.isProbablePrime(b)) {\r\n        this.dAddOffset(2,0);\r\n        if(this.bitLength() > a) this.subTo(BigInteger.ONE.shiftLeft(a-1),this);\r\n      }\r\n    }\r\n  }\r\n  else {\r\n    // new BigInteger(int,RNG)\r\n    var x = [], t = a&7;\r\n    x.length = (a>>3)+1;\r\n    b.nextBytes(x);\r\n    if(t > 0) x[0] &= ((1<<t)-1); else x[0] = 0;\r\n    this.fromString(x,256);\r\n  }\r\n}\r\n\r\n// (public) convert to bigendian byte array\r\nfunction bnToByteArray() {\r\n  var i = this.t, r = [];\r\n  r[0] = this.s;\r\n  var p = this.DB-(i*this.DB)%8, d, k = 0;\r\n  if(i-- > 0) {\r\n    if(p < this.DB && (d = this[i]>>p) != (this.s&this.DM)>>p)\r\n      r[k++] = d|(this.s<<(this.DB-p));\r\n    while(i >= 0) {\r\n      if(p < 8) {\r\n        d = (this[i]&((1<<p)-1))<<(8-p);\r\n        d |= this[--i]>>(p+=this.DB-8);\r\n      }\r\n      else {\r\n        d = (this[i]>>(p-=8))&0xff;\r\n        if(p <= 0) { p += this.DB; --i; }\r\n      }\r\n      if((d&0x80) != 0) d |= -256;\r\n      if(k == 0 && (this.s&0x80) != (d&0x80)) ++k;\r\n      if(k > 0 || d != this.s) r[k++] = d;\r\n    }\r\n  }\r\n  return r;\r\n}\r\n\r\nfunction bnEquals(a) { return(this.compareTo(a)==0); }\r\nfunction bnMin(a) { return(this.compareTo(a)<0)?this:a; }\r\nfunction bnMax(a) { return(this.compareTo(a)>0)?this:a; }\r\n\r\n// (protected) r = this op a (bitwise)\r\nfunction bnpBitwiseTo(a,op,r) {\r\n  var i, f, m = Math.min(a.t,this.t);\r\n  for(i = 0; i < m; ++i) r[i] = op(this[i],a[i]);\r\n  if(a.t < this.t) {\r\n    f = a.s&this.DM;\r\n    for(i = m; i < this.t; ++i) r[i] = op(this[i],f);\r\n    r.t = this.t;\r\n  }\r\n  else {\r\n    f = this.s&this.DM;\r\n    for(i = m; i < a.t; ++i) r[i] = op(f,a[i]);\r\n    r.t = a.t;\r\n  }\r\n  r.s = op(this.s,a.s);\r\n  r.clamp();\r\n}\r\n\r\n// (public) this & a\r\nfunction op_and(x,y) { return x&y; }\r\nfunction bnAnd(a) { var r = nbi(); this.bitwiseTo(a,op_and,r); return r; }\r\n\r\n// (public) this | a\r\nfunction op_or(x,y) { return x|y; }\r\nfunction bnOr(a) { var r = nbi(); this.bitwiseTo(a,op_or,r); return r; }\r\n\r\n// (public) this ^ a\r\nfunction op_xor(x,y) { return x^y; }\r\nfunction bnXor(a) { var r = nbi(); this.bitwiseTo(a,op_xor,r); return r; }\r\n\r\n// (public) this & ~a\r\nfunction op_andnot(x,y) { return x&~y; }\r\nfunction bnAndNot(a) { var r = nbi(); this.bitwiseTo(a,op_andnot,r); return r; }\r\n\r\n// (public) ~this\r\nfunction bnNot() {\r\n  var r = nbi();\r\n  for(var i = 0; i < this.t; ++i) r[i] = this.DM&~this[i];\r\n  r.t = this.t;\r\n  r.s = ~this.s;\r\n  return r;\r\n}\r\n\r\n// (public) this << n\r\nfunction bnShiftLeft(n) {\r\n  var r = nbi();\r\n  if(n < 0) this.rShiftTo(-n,r); else this.lShiftTo(n,r);\r\n  return r;\r\n}\r\n\r\n// (public) this >> n\r\nfunction bnShiftRight(n) {\r\n  var r = nbi();\r\n  if(n < 0) this.lShiftTo(-n,r); else this.rShiftTo(n,r);\r\n  return r;\r\n}\r\n\r\n// return index of lowest 1-bit in x, x < 2^31\r\nfunction lbit(x) {\r\n  if(x == 0) return -1;\r\n  var r = 0;\r\n  if((x&0xffff) == 0) { x >>= 16; r += 16; }\r\n  if((x&0xff) == 0) { x >>= 8; r += 8; }\r\n  if((x&0xf) == 0) { x >>= 4; r += 4; }\r\n  if((x&3) == 0) { x >>= 2; r += 2; }\r\n  if((x&1) == 0) ++r;\r\n  return r;\r\n}\r\n\r\n// (public) returns index of lowest 1-bit (or -1 if none)\r\nfunction bnGetLowestSetBit() {\r\n  for(var i = 0; i < this.t; ++i)\r\n    if(this[i] != 0) return i*this.DB+lbit(this[i]);\r\n  if(this.s < 0) return this.t*this.DB;\r\n  return -1;\r\n}\r\n\r\n// return number of 1 bits in x\r\nfunction cbit(x) {\r\n  var r = 0;\r\n  while(x != 0) { x &= x-1; ++r; }\r\n  return r;\r\n}\r\n\r\n// (public) return number of set bits\r\nfunction bnBitCount() {\r\n  var r = 0, x = this.s&this.DM;\r\n  for(var i = 0; i < this.t; ++i) r += cbit(this[i]^x);\r\n  return r;\r\n}\r\n\r\n// (public) true iff nth bit is set\r\nfunction bnTestBit(n) {\r\n  var j = Math.floor(n/this.DB);\r\n  if(j >= this.t) return(this.s!=0);\r\n  return((this[j]&(1<<(n%this.DB)))!=0);\r\n}\r\n\r\n// (protected) this op (1<<n)\r\nfunction bnpChangeBit(n,op) {\r\n  var r = BigInteger.ONE.shiftLeft(n);\r\n  this.bitwiseTo(r,op,r);\r\n  return r;\r\n}\r\n\r\n// (public) this | (1<<n)\r\nfunction bnSetBit(n) { return this.changeBit(n,op_or); }\r\n\r\n// (public) this & ~(1<<n)\r\nfunction bnClearBit(n) { return this.changeBit(n,op_andnot); }\r\n\r\n// (public) this ^ (1<<n)\r\nfunction bnFlipBit(n) { return this.changeBit(n,op_xor); }\r\n\r\n// (protected) r = this + a\r\nfunction bnpAddTo(a,r) {\r\n  var i = 0, c = 0, m = Math.min(a.t,this.t);\r\n  while(i < m) {\r\n    c += this[i]+a[i];\r\n    r[i++] = c&this.DM;\r\n    c >>= this.DB;\r\n  }\r\n  if(a.t < this.t) {\r\n    c += a.s;\r\n    while(i < this.t) {\r\n      c += this[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += this.s;\r\n  }\r\n  else {\r\n    c += this.s;\r\n    while(i < a.t) {\r\n      c += a[i];\r\n      r[i++] = c&this.DM;\r\n      c >>= this.DB;\r\n    }\r\n    c += a.s;\r\n  }\r\n  r.s = (c<0)?-1:0;\r\n  if(c > 0) r[i++] = c;\r\n  else if(c < -1) r[i++] = this.DV+c;\r\n  r.t = i;\r\n  r.clamp();\r\n}\r\n\r\n// (public) this + a\r\nfunction bnAdd(a) { var r = nbi(); this.addTo(a,r); return r; }\r\n\r\n// (public) this - a\r\nfunction bnSubtract(a) { var r = nbi(); this.subTo(a,r); return r; }\r\n\r\n// (public) this * a\r\nfunction bnMultiply(a) { var r = nbi(); this.multiplyTo(a,r); return r; }\r\n\r\n// (public) this^2\r\nfunction bnSquare() { var r = nbi(); this.squareTo(r); return r; }\r\n\r\n// (public) this / a\r\nfunction bnDivide(a) { var r = nbi(); this.divRemTo(a,r,null); return r; }\r\n\r\n// (public) this % a\r\nfunction bnRemainder(a) { var r = nbi(); this.divRemTo(a,null,r); return r; }\r\n\r\n// (public) [this/a,this%a]\r\nfunction bnDivideAndRemainder(a) {\r\n  var q = nbi(), r = nbi();\r\n  this.divRemTo(a,q,r);\r\n  return new Array(q,r);\r\n}\r\n\r\n// (protected) this *= n, this >= 0, 1 < n < DV\r\nfunction bnpDMultiply(n) {\r\n  this[this.t] = this.am(0,n-1,this,0,0,this.t);\r\n  ++this.t;\r\n  this.clamp();\r\n}\r\n\r\n// (protected) this += n << w words, this >= 0\r\nfunction bnpDAddOffset(n,w) {\r\n  if(n == 0) return;\r\n  while(this.t <= w) this[this.t++] = 0;\r\n  this[w] += n;\r\n  while(this[w] >= this.DV) {\r\n    this[w] -= this.DV;\r\n    if(++w >= this.t) this[this.t++] = 0;\r\n    ++this[w];\r\n  }\r\n}\r\n\r\n// A \"null\" reducer\r\nfunction NullExp() {}\r\nfunction nNop(x) { return x; }\r\nfunction nMulTo(x,y,r) { x.multiplyTo(y,r); }\r\nfunction nSqrTo(x,r) { x.squareTo(r); }\r\n\r\nNullExp.prototype.convert = nNop;\r\nNullExp.prototype.revert = nNop;\r\nNullExp.prototype.mulTo = nMulTo;\r\nNullExp.prototype.sqrTo = nSqrTo;\r\n\r\n// (public) this^e\r\nfunction bnPow(e) { return this.exp(e,new NullExp()); }\r\n\r\n// (protected) r = lower n words of \"this * a\", a.t <= n\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyLowerTo(a,n,r) {\r\n  var i = Math.min(this.t+a.t,n);\r\n  r.s = 0; // assumes a,this >= 0\r\n  r.t = i;\r\n  while(i > 0) r[--i] = 0;\r\n  var j;\r\n  for(j = r.t-this.t; i < j; ++i) r[i+this.t] = this.am(0,a[i],r,i,0,this.t);\r\n  for(j = Math.min(a.t,n); i < j; ++i) this.am(0,a[i],r,i,0,n-i);\r\n  r.clamp();\r\n}\r\n\r\n// (protected) r = \"this * a\" without lower n words, n > 0\r\n// \"this\" should be the larger one if appropriate.\r\nfunction bnpMultiplyUpperTo(a,n,r) {\r\n  --n;\r\n  var i = r.t = this.t+a.t-n;\r\n  r.s = 0; // assumes a,this >= 0\r\n  while(--i >= 0) r[i] = 0;\r\n  for(i = Math.max(n-this.t,0); i < a.t; ++i)\r\n    r[this.t+i-n] = this.am(n-i,a[i],r,0,0,this.t+i-n);\r\n  r.clamp();\r\n  r.drShiftTo(1,r);\r\n}\r\n\r\n// Barrett modular reduction\r\nfunction Barrett(m) {\r\n  // setup Barrett\r\n  this.r2 = nbi();\r\n  this.q3 = nbi();\r\n  BigInteger.ONE.dlShiftTo(2*m.t,this.r2);\r\n  this.mu = this.r2.divide(m);\r\n  this.m = m;\r\n}\r\n\r\nfunction barrettConvert(x) {\r\n  if(x.s < 0 || x.t > 2*this.m.t) return x.mod(this.m);\r\n  else if(x.compareTo(this.m) < 0) return x;\r\n  else { var r = nbi(); x.copyTo(r); this.reduce(r); return r; }\r\n}\r\n\r\nfunction barrettRevert(x) { return x; }\r\n\r\n// x = x mod m (HAC 14.42)\r\nfunction barrettReduce(x) {\r\n  x.drShiftTo(this.m.t-1,this.r2);\r\n  if(x.t > this.m.t+1) { x.t = this.m.t+1; x.clamp(); }\r\n  this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);\r\n  this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);\r\n  while(x.compareTo(this.r2) < 0) x.dAddOffset(1,this.m.t+1);\r\n  x.subTo(this.r2,x);\r\n  while(x.compareTo(this.m) >= 0) x.subTo(this.m,x);\r\n}\r\n\r\n// r = x^2 mod m; x != r\r\nfunction barrettSqrTo(x,r) { x.squareTo(r); this.reduce(r); }\r\n\r\n// r = x*y mod m; x,y != r\r\nfunction barrettMulTo(x,y,r) { x.multiplyTo(y,r); this.reduce(r); }\r\n\r\nBarrett.prototype.convert = barrettConvert;\r\nBarrett.prototype.revert = barrettRevert;\r\nBarrett.prototype.reduce = barrettReduce;\r\nBarrett.prototype.mulTo = barrettMulTo;\r\nBarrett.prototype.sqrTo = barrettSqrTo;\r\n\r\n// (public) this^e % m (HAC 14.85)\r\nfunction bnModPow(e,m) {\r\n  var i = e.bitLength(), k, r = nbv(1), z;\r\n  if(i <= 0) return r;\r\n  else if(i < 18) k = 1;\r\n  else if(i < 48) k = 3;\r\n  else if(i < 144) k = 4;\r\n  else if(i < 768) k = 5;\r\n  else k = 6;\r\n  if(i < 8)\r\n    z = new Classic(m);\r\n  else if(m.isEven())\r\n    z = new Barrett(m);\r\n  else\r\n    z = new Montgomery(m);\r\n\r\n  // precomputation\r\n  var g = [], n = 3, k1 = k-1, km = (1<<k)-1;\r\n  g[1] = z.convert(this);\r\n  if(k > 1) {\r\n    var g2 = nbi();\r\n    z.sqrTo(g[1],g2);\r\n    while(n <= km) {\r\n      g[n] = nbi();\r\n      z.mulTo(g2,g[n-2],g[n]);\r\n      n += 2;\r\n    }\r\n  }\r\n\r\n  var j = e.t-1, w, is1 = true, r2 = nbi(), t;\r\n  i = nbits(e[j])-1;\r\n  while(j >= 0) {\r\n    if(i >= k1) w = (e[j]>>(i-k1))&km;\r\n    else {\r\n      w = (e[j]&((1<<(i+1))-1))<<(k1-i);\r\n      if(j > 0) w |= e[j-1]>>(this.DB+i-k1);\r\n    }\r\n\r\n    n = k;\r\n    while((w&1) == 0) { w >>= 1; --n; }\r\n    if((i -= n) < 0) { i += this.DB; --j; }\r\n    if(is1) {\t// ret == 1, don't bother squaring or multiplying it\r\n      g[w].copyTo(r);\r\n      is1 = false;\r\n    }\r\n    else {\r\n      while(n > 1) { z.sqrTo(r,r2); z.sqrTo(r2,r); n -= 2; }\r\n      if(n > 0) z.sqrTo(r,r2); else { t = r; r = r2; r2 = t; }\r\n      z.mulTo(r2,g[w],r);\r\n    }\r\n\r\n    while(j >= 0 && (e[j]&(1<<i)) == 0) {\r\n      z.sqrTo(r,r2); t = r; r = r2; r2 = t;\r\n      if(--i < 0) { i = this.DB-1; --j; }\r\n    }\r\n  }\r\n  return z.revert(r);\r\n}\r\n\r\n// (public) gcd(this,a) (HAC 14.54)\r\nfunction bnGCD(a) {\r\n  var x = (this.s<0)?this.negate():this.clone();\r\n  var y = (a.s<0)?a.negate():a.clone();\r\n  if(x.compareTo(y) < 0) { var t = x; x = y; y = t; }\r\n  var i = x.getLowestSetBit(), g = y.getLowestSetBit();\r\n  if(g < 0) return x;\r\n  if(i < g) g = i;\r\n  if(g > 0) {\r\n    x.rShiftTo(g,x);\r\n    y.rShiftTo(g,y);\r\n  }\r\n  while(x.signum() > 0) {\r\n    if((i = x.getLowestSetBit()) > 0) x.rShiftTo(i,x);\r\n    if((i = y.getLowestSetBit()) > 0) y.rShiftTo(i,y);\r\n    if(x.compareTo(y) >= 0) {\r\n      x.subTo(y,x);\r\n      x.rShiftTo(1,x);\r\n    }\r\n    else {\r\n      y.subTo(x,y);\r\n      y.rShiftTo(1,y);\r\n    }\r\n  }\r\n  if(g > 0) y.lShiftTo(g,y);\r\n  return y;\r\n}\r\n\r\n// (protected) this % n, n < 2^26\r\nfunction bnpModInt(n) {\r\n  if(n <= 0) return 0;\r\n  var d = this.DV%n, r = (this.s<0)?n-1:0;\r\n  if(this.t > 0)\r\n    if(d == 0) r = this[0]%n;\r\n    else for(var i = this.t-1; i >= 0; --i) r = (d*r+this[i])%n;\r\n  return r;\r\n}\r\n\r\n// (public) 1/this % m (HAC 14.61)\r\nfunction bnModInverse(m) {\r\n  var ac = m.isEven();\r\n  if((this.isEven() && ac) || m.signum() == 0) return BigInteger.ZERO;\r\n  var u = m.clone(), v = this.clone();\r\n  var a = nbv(1), b = nbv(0), c = nbv(0), d = nbv(1);\r\n  while(u.signum() != 0) {\r\n    while(u.isEven()) {\r\n      u.rShiftTo(1,u);\r\n      if(ac) {\r\n        if(!a.isEven() || !b.isEven()) { a.addTo(this,a); b.subTo(m,b); }\r\n        a.rShiftTo(1,a);\r\n      }\r\n      else if(!b.isEven()) b.subTo(m,b);\r\n      b.rShiftTo(1,b);\r\n    }\r\n    while(v.isEven()) {\r\n      v.rShiftTo(1,v);\r\n      if(ac) {\r\n        if(!c.isEven() || !d.isEven()) { c.addTo(this,c); d.subTo(m,d); }\r\n        c.rShiftTo(1,c);\r\n      }\r\n      else if(!d.isEven()) d.subTo(m,d);\r\n      d.rShiftTo(1,d);\r\n    }\r\n    if(u.compareTo(v) >= 0) {\r\n      u.subTo(v,u);\r\n      if(ac) a.subTo(c,a);\r\n      b.subTo(d,b);\r\n    }\r\n    else {\r\n      v.subTo(u,v);\r\n      if(ac) c.subTo(a,c);\r\n      d.subTo(b,d);\r\n    }\r\n  }\r\n  if(v.compareTo(BigInteger.ONE) != 0) return BigInteger.ZERO;\r\n  if(d.compareTo(m) >= 0) return d.subtract(m);\r\n  if(d.signum() < 0) d.addTo(m,d); else return d;\r\n  if(d.signum() < 0) return d.add(m); else return d;\r\n}\r\n\r\nvar lowprimes = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];\r\nvar lplim = (1<<26)/lowprimes[lowprimes.length-1];\r\n\r\n// (public) test primality with certainty >= 1-.5^t\r\nfunction bnIsProbablePrime(t) {\r\n  var i, x = this.abs();\r\n  if(x.t == 1 && x[0] <= lowprimes[lowprimes.length-1]) {\r\n    for(i = 0; i < lowprimes.length; ++i)\r\n      if(x[0] == lowprimes[i]) return true;\r\n    return false;\r\n  }\r\n  if(x.isEven()) return false;\r\n  i = 1;\r\n  while(i < lowprimes.length) {\r\n    var m = lowprimes[i], j = i+1;\r\n    while(j < lowprimes.length && m < lplim) m *= lowprimes[j++];\r\n    m = x.modInt(m);\r\n    while(i < j) if(m%lowprimes[i++] == 0) return false;\r\n  }\r\n  return x.millerRabin(t);\r\n}\r\n\r\n// (protected) true if probably prime (HAC 4.24, Miller-Rabin)\r\nfunction bnpMillerRabin(t) {\r\n  var n1 = this.subtract(BigInteger.ONE);\r\n  var k = n1.getLowestSetBit();\r\n  if(k <= 0) return false;\r\n  var r = n1.shiftRight(k);\r\n  t = (t+1)>>1;\r\n  if(t > lowprimes.length) t = lowprimes.length;\r\n  var a = nbi();\r\n  for(var i = 0; i < t; ++i) {\r\n    //Pick bases at random, instead of starting at 2\r\n    a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);\r\n    var y = a.modPow(r,this);\r\n    if(y.compareTo(BigInteger.ONE) != 0 && y.compareTo(n1) != 0) {\r\n      var j = 1;\r\n      while(j++ < k && y.compareTo(n1) != 0) {\r\n        y = y.modPowInt(2,this);\r\n        if(y.compareTo(BigInteger.ONE) == 0) return false;\r\n      }\r\n      if(y.compareTo(n1) != 0) return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n// protected\r\nBigInteger.prototype.chunkSize = bnpChunkSize;\r\nBigInteger.prototype.toRadix = bnpToRadix;\r\nBigInteger.prototype.fromRadix = bnpFromRadix;\r\nBigInteger.prototype.fromNumber = bnpFromNumber;\r\nBigInteger.prototype.bitwiseTo = bnpBitwiseTo;\r\nBigInteger.prototype.changeBit = bnpChangeBit;\r\nBigInteger.prototype.addTo = bnpAddTo;\r\nBigInteger.prototype.dMultiply = bnpDMultiply;\r\nBigInteger.prototype.dAddOffset = bnpDAddOffset;\r\nBigInteger.prototype.multiplyLowerTo = bnpMultiplyLowerTo;\r\nBigInteger.prototype.multiplyUpperTo = bnpMultiplyUpperTo;\r\nBigInteger.prototype.modInt = bnpModInt;\r\nBigInteger.prototype.millerRabin = bnpMillerRabin;\r\n\r\n// public\r\nBigInteger.prototype.clone = bnClone;\r\nBigInteger.prototype.intValue = bnIntValue;\r\nBigInteger.prototype.byteValue = bnByteValue;\r\nBigInteger.prototype.shortValue = bnShortValue;\r\nBigInteger.prototype.signum = bnSigNum;\r\nBigInteger.prototype.toByteArray = bnToByteArray;\r\nBigInteger.prototype.equals = bnEquals;\r\nBigInteger.prototype.min = bnMin;\r\nBigInteger.prototype.max = bnMax;\r\nBigInteger.prototype.and = bnAnd;\r\nBigInteger.prototype.or = bnOr;\r\nBigInteger.prototype.xor = bnXor;\r\nBigInteger.prototype.andNot = bnAndNot;\r\nBigInteger.prototype.not = bnNot;\r\nBigInteger.prototype.shiftLeft = bnShiftLeft;\r\nBigInteger.prototype.shiftRight = bnShiftRight;\r\nBigInteger.prototype.getLowestSetBit = bnGetLowestSetBit;\r\nBigInteger.prototype.bitCount = bnBitCount;\r\nBigInteger.prototype.testBit = bnTestBit;\r\nBigInteger.prototype.setBit = bnSetBit;\r\nBigInteger.prototype.clearBit = bnClearBit;\r\nBigInteger.prototype.flipBit = bnFlipBit;\r\nBigInteger.prototype.add = bnAdd;\r\nBigInteger.prototype.subtract = bnSubtract;\r\nBigInteger.prototype.multiply = bnMultiply;\r\nBigInteger.prototype.divide = bnDivide;\r\nBigInteger.prototype.remainder = bnRemainder;\r\nBigInteger.prototype.divideAndRemainder = bnDivideAndRemainder;\r\nBigInteger.prototype.modPow = bnModPow;\r\nBigInteger.prototype.modInverse = bnModInverse;\r\nBigInteger.prototype.pow = bnPow;\r\nBigInteger.prototype.gcd = bnGCD;\r\nBigInteger.prototype.isProbablePrime = bnIsProbablePrime;\r\n\r\n// JSBN-specific extension\r\nBigInteger.prototype.square = bnSquare;\r\n\r\n// BigInteger interfaces not implemented in jsbn:\r\n\r\n// BigInteger(int signum, byte[] magnitude)\r\n// double doubleValue()\r\n// float floatValue()\r\n// int hashCode()\r\n// long longValue()\r\n// static BigInteger valueOf(long val)\r\n","// Version 1.1: support utf-8 encoding in pkcs1pad2\r\n\r\n// convert a (hex) string to a bignum object\r\n\r\nimport {BigInteger} from \"./jsbn2\";\r\nimport {SecureRandom} from \"./rng\";\r\n\r\nexport function parseBigInt(str,r) {\r\n  return new BigInteger(str,r);\r\n}\r\n\r\nfunction linebrk(s,n) {\r\n  var ret = \"\";\r\n  var i = 0;\r\n  while(i + n < s.length) {\r\n    ret += s.substring(i,i+n) + \"\\n\";\r\n    i += n;\r\n  }\r\n  return ret + s.substring(i,s.length);\r\n}\r\n\r\nfunction byte2Hex(b) {\r\n  if(b < 0x10)\r\n    return \"0\" + b.toString(16);\r\n  else\r\n    return b.toString(16);\r\n}\r\n\r\n// PKCS#1 (type 2, random) pad input string s to n bytes, and return a bigint\r\nfunction pkcs1pad2(s,n) {\r\n  if(n < s.length + 11) { // TODO: fix for utf-8\r\n    console.error(\"Message too long for RSA\");\r\n    return null;\r\n  }\r\n  var ba = [];\r\n  var i = s.length - 1;\r\n  while(i >= 0 && n > 0) {\r\n    var c = s.charCodeAt(i--);\r\n    if(c < 128) { // encode using utf-8\r\n      ba[--n] = c;\r\n    }\r\n    else if((c > 127) && (c < 2048)) {\r\n      ba[--n] = (c & 63) | 128;\r\n      ba[--n] = (c >> 6) | 192;\r\n    }\r\n    else {\r\n      ba[--n] = (c & 63) | 128;\r\n      ba[--n] = ((c >> 6) & 63) | 128;\r\n      ba[--n] = (c >> 12) | 224;\r\n    }\r\n  }\r\n  ba[--n] = 0;\r\n  var rng = new SecureRandom();\r\n  var x = [];\r\n  while(n > 2) { // random non-zero pad\r\n    x[0] = 0;\r\n    while(x[0] == 0) rng.nextBytes(x);\r\n    ba[--n] = x[0];\r\n  }\r\n  ba[--n] = 2;\r\n  ba[--n] = 0;\r\n  return new BigInteger(ba);\r\n}\r\n\r\n// \"empty\" RSA key constructor\r\nexport class RSAKey {\r\n  constructor() {\r\n    this.n = null;\r\n    this.e = 0;\r\n    this.d = null;\r\n    this.p = null;\r\n    this.q = null;\r\n    this.dmp1 = null;\r\n    this.dmq1 = null;\r\n    this.coeff = null;\r\n  }\r\n}\r\n\r\n// Set the public key fields N and e from hex strings\r\nfunction RSASetPublic(N,E) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA public key\");\r\n}\r\n\r\n// Perform raw public operation on \"x\": return x^e (mod n)\r\nfunction RSADoPublic(x) {\r\n  return x.modPowInt(this.e, this.n);\r\n}\r\n\r\n// Return the PKCS#1 RSA encryption of \"text\" as an even-length hex string\r\nfunction RSAEncrypt(text) {\r\n  var m = pkcs1pad2(text,(this.n.bitLength()+7)>>3);\r\n  if(m == null) return null;\r\n  var c = this.doPublic(m);\r\n  if(c == null) return null;\r\n  var h = c.toString(16);\r\n  if((h.length & 1) == 0) return h; else return \"0\" + h;\r\n}\r\n\r\n// Return the PKCS#1 RSA encryption of \"text\" as a Base64-encoded string\r\n//function RSAEncryptB64(text) {\r\n//  var h = this.encrypt(text);\r\n//  if(h) return hex2b64(h); else return null;\r\n//}\r\n\r\n// protected\r\nRSAKey.prototype.doPublic = RSADoPublic;\r\n\r\n// public\r\nRSAKey.prototype.setPublic = RSASetPublic;\r\nRSAKey.prototype.encrypt = RSAEncrypt;\r\n//RSAKey.prototype.encrypt_b64 = RSAEncryptB64;\r\n","// Version 1.1: support utf-8 decoding in pkcs1unpad2\r\n\r\n// Undo PKCS#1 (type 2, random) padding and, if valid, return the plaintext\r\n\r\nimport {SecureRandom} from \"./rng\";\r\nimport {BigInteger} from \"./jsbn\";\r\nimport {parseBigInt} from \"./rsa\";\r\nimport {RSAKey} from \"./rsa\";\r\nexport {RSAKey} from \"./rsa\";\r\n\r\nfunction pkcs1unpad2(d,n) {\r\n  var b = d.toByteArray();\r\n  var i = 0;\r\n  while(i < b.length && b[i] == 0) ++i;\r\n  if(b.length-i != n-1 || b[i] != 2)\r\n    return null;\r\n  ++i;\r\n  while(b[i] != 0)\r\n    if(++i >= b.length) return null;\r\n  var ret = \"\";\r\n  while(++i < b.length) {\r\n    var c = b[i] & 255;\r\n    if(c < 128) { // utf-8 decode\r\n      ret += String.fromCharCode(c);\r\n    }\r\n    else if((c > 191) && (c < 224)) {\r\n      ret += String.fromCharCode(((c & 31) << 6) | (b[i+1] & 63));\r\n      ++i;\r\n    }\r\n    else {\r\n      ret += String.fromCharCode(((c & 15) << 12) | ((b[i+1] & 63) << 6) | (b[i+2] & 63));\r\n      i += 2;\r\n    }\r\n  }\r\n  return ret;\r\n}\r\n\r\n// Set the private key fields N, e, and d from hex strings\r\nfunction RSASetPrivate(N,E,D) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n    this.d = parseBigInt(D,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA private key\");\r\n}\r\n\r\n// Set the private key fields N, e, d and CRT params from hex strings\r\nfunction RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C) {\r\n  if(N != null && E != null && N.length > 0 && E.length > 0) {\r\n    this.n = parseBigInt(N,16);\r\n    this.e = parseInt(E,16);\r\n    this.d = parseBigInt(D,16);\r\n    this.p = parseBigInt(P,16);\r\n    this.q = parseBigInt(Q,16);\r\n    this.dmp1 = parseBigInt(DP,16);\r\n    this.dmq1 = parseBigInt(DQ,16);\r\n    this.coeff = parseBigInt(C,16);\r\n  }\r\n  else\r\n    console.error(\"Invalid RSA private key\");\r\n}\r\n\r\n// Generate a new random private key B bits long, using public expt E\r\nfunction RSAGenerate(B,E) {\r\n  var rng = new SecureRandom();\r\n  var qs = B>>1;\r\n  this.e = parseInt(E,16);\r\n  var ee = new BigInteger(E,16);\r\n  for(;;) {\r\n    for(;;) {\r\n      this.p = new BigInteger(B-qs,1,rng);\r\n      if(this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.p.isProbablePrime(10)) break;\r\n    }\r\n    for(;;) {\r\n      this.q = new BigInteger(qs,1,rng);\r\n      if(this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE) == 0 && this.q.isProbablePrime(10)) break;\r\n    }\r\n    if(this.p.compareTo(this.q) <= 0) {\r\n      var t = this.p;\r\n      this.p = this.q;\r\n      this.q = t;\r\n    }\r\n    var p1 = this.p.subtract(BigInteger.ONE);\r\n    var q1 = this.q.subtract(BigInteger.ONE);\r\n    var phi = p1.multiply(q1);\r\n    if(phi.gcd(ee).compareTo(BigInteger.ONE) == 0) {\r\n      this.n = this.p.multiply(this.q);\r\n      this.d = ee.modInverse(phi);\r\n      this.dmp1 = this.d.mod(p1);\r\n      this.dmq1 = this.d.mod(q1);\r\n      this.coeff = this.q.modInverse(this.p);\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\n// Perform raw private operation on \"x\": return x^d (mod n)\r\nfunction RSADoPrivate(x) {\r\n  if(this.p == null || this.q == null)\r\n    return x.modPow(this.d, this.n);\r\n\r\n  // TODO: re-calculate any missing CRT params\r\n  var xp = x.mod(this.p).modPow(this.dmp1, this.p);\r\n  var xq = x.mod(this.q).modPow(this.dmq1, this.q);\r\n\r\n  while(xp.compareTo(xq) < 0)\r\n    xp = xp.add(this.p);\r\n  return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq);\r\n}\r\n\r\n// Return the PKCS#1 RSA decryption of \"ctext\".\r\n// \"ctext\" is an even-length hex string and the output is a plain string.\r\nfunction RSADecrypt(ctext) {\r\n  var c = parseBigInt(ctext, 16);\r\n  var m = this.doPrivate(c);\r\n  if(m == null) return null;\r\n  return pkcs1unpad2(m, (this.n.bitLength()+7)>>3);\r\n}\r\n\r\n// Return the PKCS#1 RSA decryption of \"ctext\".\r\n// \"ctext\" is a Base64-encoded string and the output is a plain string.\r\n//function RSAB64Decrypt(ctext) {\r\n//  var h = b64tohex(ctext);\r\n//  if(h) return this.decrypt(h); else return null;\r\n//}\r\n\r\n// protected\r\nRSAKey.prototype.doPrivate = RSADoPrivate;\r\n\r\n// public\r\nRSAKey.prototype.setPrivate = RSASetPrivate;\r\nRSAKey.prototype.setPrivateEx = RSASetPrivateEx;\r\nRSAKey.prototype.generate = RSAGenerate;\r\nRSAKey.prototype.decrypt = RSADecrypt;\r\n//RSAKey.prototype.b64_decrypt = RSAB64Decrypt;","// Base64 JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\n\r\nexport const Base64 = {};\r\nlet decoder;\r\n\r\nBase64.decode = function (a) {\r\n    var i;\r\n    if (decoder === undefined) {\r\n        var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\r\n            ignore = \"= \\f\\n\\r\\t\\u00A0\\u2028\\u2029\";\r\n        decoder = [];\r\n        for (i = 0; i < 64; ++i)\r\n            decoder[b64.charAt(i)] = i;\r\n        for (i = 0; i < ignore.length; ++i)\r\n            decoder[ignore.charAt(i)] = -1;\r\n    }\r\n    var out = [];\r\n    var bits = 0, char_count = 0;\r\n    for (i = 0; i < a.length; ++i) {\r\n        var c = a.charAt(i);\r\n        if (c == '=')\r\n            break;\r\n        c = decoder[c];\r\n        if (c == -1)\r\n            continue;\r\n        if (c === undefined)\r\n            throw 'Illegal character at offset ' + i;\r\n        bits |= c;\r\n        if (++char_count >= 4) {\r\n            out[out.length] = (bits >> 16);\r\n            out[out.length] = (bits >> 8) & 0xFF;\r\n            out[out.length] = bits & 0xFF;\r\n            bits = 0;\r\n            char_count = 0;\r\n        } else {\r\n            bits <<= 6;\r\n        }\r\n    }\r\n    switch (char_count) {\r\n      case 1:\r\n        throw \"Base64 encoding incomplete: at least 2 bits missing\";\r\n      case 2:\r\n        out[out.length] = (bits >> 10);\r\n        break;\r\n      case 3:\r\n        out[out.length] = (bits >> 16);\r\n        out[out.length] = (bits >> 8) & 0xFF;\r\n        break;\r\n    }\r\n    return out;\r\n};\r\n\r\nBase64.re = /-----BEGIN [^-]+-----([A-Za-z0-9+\\/=\\s]+)-----END [^-]+-----|begin-base64[^\\n]+\\n([A-Za-z0-9+\\/=\\s]+)====/;\r\nBase64.unarmor = function (a) {\r\n    var m = Base64.re.exec(a);\r\n    if (m) {\r\n        if (m[1])\r\n            a = m[1];\r\n        else if (m[2])\r\n            a = m[2];\r\n        else\r\n            throw \"RegExp out of sync\";\r\n    }\r\n    return Base64.decode(a);\r\n};\r\n","// Hex JavaScript decoder\r\n// Copyright (c) 2008-2013 Lapo Luchini <lapo@lapo.it>\r\n\r\n// Permission to use, copy, modify, and/or distribute this software for any\r\n// purpose with or without fee is hereby granted, provided that the above\r\n// copyright notice and this permission notice appear in all copies.\r\n// \r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\r\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\r\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\r\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\r\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\r\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\r\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n\r\n/*jshint browser: true, strict: true, immed: true, latedef: true, undef: true, regexdash: false */\r\nexport const Hex = {};\r\nlet decoder;\r\n\r\nHex.decode = function(a) {\r\n    var i;\r\n    if (decoder === undefined) {\r\n        var hex = \"0123456789ABCDEF\",\r\n            ignore = \" \\f\\n\\r\\t\\u00A0\\u2028\\u2029\";\r\n        decoder = [];\r\n        for (i = 0; i < 16; ++i)\r\n            decoder[hex.charAt(i)] = i;\r\n        hex = hex.toLowerCase();\r\n        for (i = 10; i < 16; ++i)\r\n            decoder[hex.charAt(i)] = i;\r\n        for (i = 0; i < ignore.length; ++i)\r\n            decoder[ignore.charAt(i)] = -1;\r\n    }\r\n    var out = [],\r\n        bits = 0,\r\n        char_count = 0;\r\n    for (i = 0; i < a.length; ++i) {\r\n        var c = a.charAt(i);\r\n        if (c == '=')\r\n            break;\r\n        c = decoder[c];\r\n        if (c == -1)\r\n            continue;\r\n        if (c === undefined)\r\n            throw 'Illegal character at offset ' + i;\r\n        bits |= c;\r\n        if (++char_count >= 2) {\r\n            out[out.length] = bits;\r\n            bits = 0;\r\n            char_count = 0;\r\n        } else {\r\n            bits <<= 4;\r\n        }\r\n    }\r\n    if (char_count)\r\n        throw \"Hex encoding incomplete: 4 bits missing\";\r\n    return out;\r\n};","import {BigInteger} from \"../jsbn/jsbn2\";\r\n/*! asn1-1.0.2.js (c) 2013 Kenji Urushima | kjur.github.com/jsrsasign/license\r\n */\r\n\r\nexport const JSX = /*window.JSX || */{};\r\nJSX.env = JSX.env || {};\r\n\r\nvar L = JSX, OP = Object.prototype, FUNCTION_TOSTRING = '[object Function]',ADD = [\"toString\", \"valueOf\"];\r\n\r\nJSX.env.parseUA = function(agent) {\r\n\r\n    var numberify = function(s) {\r\n        var c = 0;\r\n        return parseFloat(s.replace(/\\./g, function() {\r\n            return (c++ == 1) ? '' : '.';\r\n        }));\r\n    },\r\n\r\n    nav = navigator,\r\n    o = {\r\n        ie: 0,\r\n        opera: 0,\r\n        gecko: 0,\r\n        webkit: 0,\r\n        chrome: 0,\r\n        mobile: null,\r\n        air: 0,\r\n        ipad: 0,\r\n        iphone: 0,\r\n        ipod: 0,\r\n        ios: null,\r\n        android: 0,\r\n        webos: 0,\r\n        caja: nav && nav.cajaVersion,\r\n        secure: false,\r\n        os: null\r\n\r\n    },\r\n\r\n    ua = agent || (navigator && navigator.userAgent),\r\n    loc = window && window.location,\r\n    href = loc && loc.href,\r\n    m;\r\n\r\n    o.secure = href && (href.toLowerCase().indexOf(\"https\") === 0);\r\n\r\n    if (ua) {\r\n\r\n        if ((/windows|win32/i).test(ua)) {\r\n            o.os = 'windows';\r\n        } else if ((/macintosh/i).test(ua)) {\r\n            o.os = 'macintosh';\r\n        } else if ((/rhino/i).test(ua)) {\r\n            o.os = 'rhino';\r\n        }\r\n        if ((/KHTML/).test(ua)) {\r\n            o.webkit = 1;\r\n        }\r\n        m = ua.match(/AppleWebKit\\/([^\\s]*)/);\r\n        if (m && m[1]) {\r\n            o.webkit = numberify(m[1]);\r\n            if (/ Mobile\\//.test(ua)) {\r\n                o.mobile = 'Apple'; // iPhone or iPod Touch\r\n                m = ua.match(/OS ([^\\s]*)/);\r\n                if (m && m[1]) {\r\n                    m = numberify(m[1].replace('_', '.'));\r\n                }\r\n                o.ios = m;\r\n                o.ipad = o.ipod = o.iphone = 0;\r\n                m = ua.match(/iPad|iPod|iPhone/);\r\n                if (m && m[0]) {\r\n                    o[m[0].toLowerCase()] = o.ios;\r\n                }\r\n            } else {\r\n                m = ua.match(/NokiaN[^\\/]*|Android \\d\\.\\d|webOS\\/\\d\\.\\d/);\r\n                if (m) {\r\n                    o.mobile = m[0];\r\n                }\r\n                if (/webOS/.test(ua)) {\r\n                    o.mobile = 'WebOS';\r\n                    m = ua.match(/webOS\\/([^\\s]*);/);\r\n                    if (m && m[1]) {\r\n                        o.webos = numberify(m[1]);\r\n                    }\r\n                }\r\n                if (/ Android/.test(ua)) {\r\n                    o.mobile = 'Android';\r\n                    m = ua.match(/Android ([^\\s]*);/);\r\n                    if (m && m[1]) {\r\n                        o.android = numberify(m[1]);\r\n                    }\r\n                }\r\n            }\r\n            m = ua.match(/Chrome\\/([^\\s]*)/);\r\n            if (m && m[1]) {\r\n                o.chrome = numberify(m[1]); // Chrome\r\n            } else {\r\n                m = ua.match(/AdobeAIR\\/([^\\s]*)/);\r\n                if (m) {\r\n                    o.air = m[0]; // Adobe AIR 1.0 or better\r\n                }\r\n            }\r\n        }\r\n        if (!o.webkit) {\r\n            m = ua.match(/Opera[\\s\\/]([^\\s]*)/);\r\n            if (m && m[1]) {\r\n                o.opera = numberify(m[1]);\r\n                m = ua.match(/Version\\/([^\\s]*)/);\r\n                if (m && m[1]) {\r\n                    o.opera = numberify(m[1]); // opera 10+\r\n                }\r\n                m = ua.match(/Opera Mini[^;]*/);\r\n                if (m) {\r\n                    o.mobile = m[0]; // ex: Opera Mini/2.0.4509/1316\r\n                }\r\n            } else { // not opera or webkit\r\n                m = ua.match(/MSIE\\s([^;]*)/);\r\n                if (m && m[1]) {\r\n                    o.ie = numberify(m[1]);\r\n                } else { // not opera, webkit, or ie\r\n                    m = ua.match(/Gecko\\/([^\\s]*)/);\r\n                    if (m) {\r\n                        o.gecko = 1; // Gecko detected, look for revision\r\n                        m = ua.match(/rv:([^\\s\\)]*)/);\r\n                        if (m && m[1]) {\r\n                            o.gecko = numberify(m[1]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return o;\r\n};\r\n\r\nJSX.env.ua = JSX.env.parseUA();\r\n\r\nJSX.isFunction = function(o) {\r\n    return (typeof o === 'function') || OP.toString.apply(o) === FUNCTION_TOSTRING;\r\n};\r\n\r\nJSX._IEEnumFix = (JSX.env.ua.ie) ? function(r, s) {\r\n    var i, fname, f;\r\n    for (i=0;i<ADD.length;i=i+1) {\r\n\r\n        fname = ADD[i];\r\n        f = s[fname];\r\n\r\n        if (L.isFunction(f) && f!=OP[fname]) {\r\n            r[fname]=f;\r\n        }\r\n    }\r\n} : function(){};\r\n\r\nJSX.extend = function(subc, superc, overrides) {\r\n    if (!superc||!subc) {\r\n        throw new Error(\"extend failed, please check that \" +\r\n                        \"all dependencies are included.\");\r\n    }\r\n    var F = function() {}, i;\r\n    F.prototype=superc.prototype;\r\n    subc.prototype=new F();\r\n    subc.prototype.constructor=subc;\r\n    subc.superclass=superc.prototype;\r\n    if (superc.prototype.constructor == OP.constructor) {\r\n        superc.prototype.constructor=superc;\r\n    }\r\n\r\n    if (overrides) {\r\n        for (i in overrides) {\r\n            if (L.hasOwnProperty(overrides, i)) {\r\n                subc.prototype[i]=overrides[i];\r\n            }\r\n        }\r\n\r\n        L._IEEnumFix(subc.prototype, overrides);\r\n    }\r\n};\r\n\r\n/*\r\n * asn1.js - ASN.1 DER encoder classes\r\n *\r\n * Copyright (c) 2013 Kenji Urushima (kenji.urushima@gmail.com)\r\n *\r\n * This software is licensed under the terms of the MIT License.\r\n * http://kjur.github.com/jsrsasign/license\r\n *\r\n * The above copyright and license notice shall be \r\n * included in all copies or substantial portions of the Software.\r\n */\r\n\r\n/**\r\n * @fileOverview\r\n * @name asn1-1.0.js\r\n * @author Kenji Urushima kenji.urushima@gmail.com\r\n * @version 1.0.2 (2013-May-30)\r\n * @since 2.1\r\n * @license <a href=\"http://kjur.github.io/jsrsasign/license/\">MIT License</a>\r\n */\r\n\r\n/** \r\n * kjur's class library name space\r\n * <p>\r\n * This name space provides following name spaces:\r\n * <ul>\r\n * <li>{@link KJUR.asn1} - ASN.1 primitive hexadecimal encoder</li>\r\n * <li>{@link KJUR.asn1.x509} - ASN.1 structure for X.509 certificate and CRL</li>\r\n * <li>{@link KJUR.crypto} - Java Cryptographic Extension(JCE) style MessageDigest/Signature \r\n * class and utilities</li>\r\n * </ul>\r\n * </p> \r\n * NOTE: Please ignore method summary and document of this namespace. This caused by a bug of jsdoc2.\r\n  * @name KJUR\r\n * @namespace kjur's class library name space\r\n */\r\n// if (typeof KJUR == \"undefined\" || !KJUR)\r\nexport const KJUR = {};\r\n\r\n/**\r\n * kjur's ASN.1 class library name space\r\n * <p>\r\n * This is ITU-T X.690 ASN.1 DER encoder class library and\r\n * class structure and methods is very similar to \r\n * org.bouncycastle.asn1 package of \r\n * well known BouncyCaslte Cryptography Library.\r\n *\r\n * <h4>PROVIDING ASN.1 PRIMITIVES</h4>\r\n * Here are ASN.1 DER primitive classes.\r\n * <ul>\r\n * <li>{@link KJUR.asn1.DERBoolean}</li>\r\n * <li>{@link KJUR.asn1.DERInteger}</li>\r\n * <li>{@link KJUR.asn1.DERBitString}</li>\r\n * <li>{@link KJUR.asn1.DEROctetString}</li>\r\n * <li>{@link KJUR.asn1.DERNull}</li>\r\n * <li>{@link KJUR.asn1.DERObjectIdentifier}</li>\r\n * <li>{@link KJUR.asn1.DERUTF8String}</li>\r\n * <li>{@link KJUR.asn1.DERNumericString}</li>\r\n * <li>{@link KJUR.asn1.DERPrintableString}</li>\r\n * <li>{@link KJUR.asn1.DERTeletexString}</li>\r\n * <li>{@link KJUR.asn1.DERIA5String}</li>\r\n * <li>{@link KJUR.asn1.DERUTCTime}</li>\r\n * <li>{@link KJUR.asn1.DERGeneralizedTime}</li>\r\n * <li>{@link KJUR.asn1.DERSequence}</li>\r\n * <li>{@link KJUR.asn1.DERSet}</li>\r\n * </ul>\r\n *\r\n * <h4>OTHER ASN.1 CLASSES</h4>\r\n * <ul>\r\n * <li>{@link KJUR.asn1.ASN1Object}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractString}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractTime}</li>\r\n * <li>{@link KJUR.asn1.DERAbstractStructured}</li>\r\n * <li>{@link KJUR.asn1.DERTaggedObject}</li>\r\n * </ul>\r\n * </p>\r\n * NOTE: Please ignore method summary and document of this namespace. This caused by a bug of jsdoc2.\r\n * @name KJUR.asn1\r\n * @namespace\r\n */\r\nif (typeof KJUR.asn1 == \"undefined\" || !KJUR.asn1) KJUR.asn1 = {};\r\n\r\n/**\r\n * ASN1 utilities class\r\n * @name KJUR.asn1.ASN1Util\r\n * @classs ASN1 utilities class\r\n * @since asn1 1.0.2\r\n */\r\nKJUR.asn1.ASN1Util = new function() {\r\n    this.integerToByteHex = function(i) {\r\n\tvar h = i.toString(16);\r\n\tif ((h.length % 2) == 1) h = '0' + h;\r\n\treturn h;\r\n    };\r\n    this.bigIntToMinTwosComplementsHex = function(bigIntegerValue) {\r\n\tvar h = bigIntegerValue.toString(16);\r\n\tif (h.substr(0, 1) != '-') {\r\n\t    if (h.length % 2 == 1) {\r\n\t\th = '0' + h;\r\n\t    } else {\r\n\t\tif (! h.match(/^[0-7]/)) {\r\n\t\t    h = '00' + h;\r\n\t\t}\r\n\t    }\r\n\t} else {\r\n\t    var hPos = h.substr(1);\r\n\t    var xorLen = hPos.length;\r\n\t    if (xorLen % 2 == 1) {\r\n\t\txorLen += 1;\r\n\t    } else {\r\n\t\tif (! h.match(/^[0-7]/)) {\r\n\t\t    xorLen += 2;\r\n\t\t}\r\n\t    }\r\n\t    var hMask = '';\r\n\t    for (var i = 0; i < xorLen; i++) {\r\n\t\thMask += 'f';\r\n\t    }\r\n\t    var biMask = new BigInteger(hMask, 16);\r\n\t    var biNeg = biMask.xor(bigIntegerValue).add(BigInteger.ONE);\r\n\t    h = biNeg.toString(16).replace(/^-/, '');\r\n\t}\r\n\treturn h;\r\n    };\r\n    /**\r\n     * get PEM string from hexadecimal data and header string\r\n     * @name getPEMStringFromHex\r\n     * @memberOf KJUR.asn1.ASN1Util\r\n     * @function\r\n     * @param {String} dataHex hexadecimal string of PEM body\r\n     * @param {String} pemHeader PEM header string (ex. 'RSA PRIVATE KEY')\r\n     * @return {String} PEM formatted string of input data\r\n     * @description\r\n     * @example\r\n     * var pem  = KJUR.asn1.ASN1Util.getPEMStringFromHex('616161', 'RSA PRIVATE KEY');\r\n     * // value of pem will be:\r\n     * -----BEGIN PRIVATE KEY-----\r\n     * YWFh\r\n     * -----END PRIVATE KEY-----\r\n     */\r\n    this.getPEMStringFromHex = function(dataHex, pemHeader) {\r\n\tvar dataWA = CryptoJS.enc.Hex.parse(dataHex);\r\n\tvar dataB64 = CryptoJS.enc.Base64.stringify(dataWA);\r\n\tvar pemBody = dataB64.replace(/(.{64})/g, \"$1\\r\\n\");\r\n        pemBody = pemBody.replace(/\\r\\n$/, '');\r\n\treturn \"-----BEGIN \" + pemHeader + \"-----\\r\\n\" + \r\n               pemBody + \r\n               \"\\r\\n-----END \" + pemHeader + \"-----\\r\\n\";\r\n    };\r\n};\r\n\r\n// ********************************************************************\r\n//  Abstract ASN.1 Classes\r\n// ********************************************************************\r\n\r\n// ********************************************************************\r\n\r\n/**\r\n * base class for ASN.1 DER encoder object\r\n * @name KJUR.asn1.ASN1Object\r\n * @class base class for ASN.1 DER encoder object\r\n * @property {Boolean} isModified flag whether internal data was changed\r\n * @property {String} hTLV hexadecimal string of ASN.1 TLV\r\n * @property {String} hT hexadecimal string of ASN.1 TLV tag(T)\r\n * @property {String} hL hexadecimal string of ASN.1 TLV length(L)\r\n * @property {String} hV hexadecimal string of ASN.1 TLV value(V)\r\n * @description\r\n */\r\nKJUR.asn1.ASN1Object = function() {\r\n    var isModified = true;\r\n    var hTLV = null;\r\n    var hT = '00'\r\n    var hL = '00';\r\n    var hV = '';\r\n\r\n    /**\r\n     * get hexadecimal ASN.1 TLV length(L) bytes from TLV value(V)\r\n     * @name getLengthHexFromValue\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV length(L)\r\n     */\r\n    this.getLengthHexFromValue = function() {\r\n\tif (typeof this.hV == \"undefined\" || this.hV == null) {\r\n\t    throw \"this.hV is null or undefined.\";\r\n\t}\r\n\tif (this.hV.length % 2 == 1) {\r\n\t    throw \"value hex must be even length: n=\" + hV.length + \",v=\" + this.hV;\r\n\t}\r\n\tvar n = this.hV.length / 2;\r\n\tvar hN = n.toString(16);\r\n\tif (hN.length % 2 == 1) {\r\n\t    hN = \"0\" + hN;\r\n\t}\r\n\tif (n < 128) {\r\n\t    return hN;\r\n\t} else {\r\n\t    var hNlen = hN.length / 2;\r\n\t    if (hNlen > 15) {\r\n\t\tthrow \"ASN.1 length too long to represent by 8x: n = \" + n.toString(16);\r\n\t    }\r\n\t    var head = 128 + hNlen;\r\n\t    return head.toString(16) + hN;\r\n\t}\r\n    };\r\n\r\n    /**\r\n     * get hexadecimal string of ASN.1 TLV bytes\r\n     * @name getEncodedHex\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV\r\n     */\r\n    this.getEncodedHex = function() {\r\n\tif (this.hTLV == null || this.isModified) {\r\n\t    this.hV = this.getFreshValueHex();\r\n\t    this.hL = this.getLengthHexFromValue();\r\n\t    this.hTLV = this.hT + this.hL + this.hV;\r\n\t    this.isModified = false;\r\n\t    //console.error(\"first time: \" + this.hTLV);\r\n\t}\r\n\treturn this.hTLV;\r\n    };\r\n\r\n    /**\r\n     * get hexadecimal string of ASN.1 TLV value(V) bytes\r\n     * @name getValueHex\r\n     * @memberOf KJUR.asn1.ASN1Object\r\n     * @function\r\n     * @return {String} hexadecimal string of ASN.1 TLV value(V) bytes\r\n     */\r\n    this.getValueHex = function() {\r\n\tthis.getEncodedHex();\r\n\treturn this.hV;\r\n    }\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn '';\r\n    };\r\n};\r\n\r\n// == BEGIN DERAbstractString ================================================\r\n/**\r\n * base class for ASN.1 DER string classes\r\n * @name KJUR.asn1.DERAbstractString\r\n * @class base class for ASN.1 DER string classes\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @property {String} s internal string of value\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERAbstractString = function(params) {\r\n    KJUR.asn1.DERAbstractString.superclass.constructor.call(this);\r\n    var s = null;\r\n    var hV = null;\r\n\r\n    /**\r\n     * get string value of this string object\r\n     * @name getString\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @return {String} string value of this string object\r\n     */\r\n    this.getString = function() {\r\n\treturn this.s;\r\n    };\r\n\r\n    /**\r\n     * set value by a string\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @param {String} newS value by a string to set\r\n     */\r\n    this.setString = function(newS) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = newS;\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    /**\r\n     * set value by a hexadecimal string\r\n     * @name setStringHex\r\n     * @memberOf KJUR.asn1.DERAbstractString\r\n     * @function\r\n     * @param {String} newHexString value by a hexadecimal string to set\r\n     */\r\n    this.setStringHex = function(newHexString) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractString, KJUR.asn1.ASN1Object);\r\n// == END   DERAbstractString ================================================\r\n\r\n// == BEGIN DERAbstractTime ==================================================\r\n/**\r\n * base class for ASN.1 DER Generalized/UTCTime class\r\n * @name KJUR.asn1.DERAbstractTime\r\n * @class base class for ASN.1 DER Generalized/UTCTime class\r\n * @param {Array} params associative array of parameters (ex. {'str': '130430235959Z'})\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERAbstractTime = function(params) {\r\n    KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);\r\n    var s = null;\r\n    var date = null;\r\n\r\n    // --- PRIVATE METHODS --------------------\r\n    this.localDateToUTC = function(d) {\r\n\tutc = d.getTime() + (d.getTimezoneOffset() * 60000);\r\n\tvar utcDate = new Date(utc);\r\n\treturn utcDate;\r\n    };\r\n\r\n    this.formatDate = function(dateObject, type) {\r\n\tvar pad = this.zeroPadding;\r\n\tvar d = this.localDateToUTC(dateObject);\r\n\tvar year = String(d.getFullYear());\r\n\tif (type == 'utc') year = year.substr(2, 2);\r\n\tvar month = pad(String(d.getMonth() + 1), 2);\r\n\tvar day = pad(String(d.getDate()), 2);\r\n\tvar hour = pad(String(d.getHours()), 2);\r\n\tvar min = pad(String(d.getMinutes()), 2);\r\n\tvar sec = pad(String(d.getSeconds()), 2);\r\n\treturn year + month + day + hour + min + sec + 'Z';\r\n    };\r\n\r\n    this.zeroPadding = function(s, len) {\r\n\tif (s.length >= len) return s;\r\n\treturn new Array(len - s.length + 1).join('0') + s;\r\n    };\r\n\r\n    // --- PUBLIC METHODS --------------------\r\n    /**\r\n     * get string value of this string object\r\n     * @name getString\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @return {String} string value of this time object\r\n     */\r\n    this.getString = function() {\r\n\treturn this.s;\r\n    };\r\n\r\n    /**\r\n     * set value by a string\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @param {String} newS value by a string to set such like \"130430235959Z\"\r\n     */\r\n    this.setString = function(newS) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = newS;\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDateValue\r\n     * @memberOf KJUR.asn1.DERAbstractTime\r\n     * @function\r\n     * @param {Integer} year year of date (ex. 2013)\r\n     * @param {Integer} month month of date between 1 and 12 (ex. 12)\r\n     * @param {Integer} day day of month\r\n     * @param {Integer} hour hours of date\r\n     * @param {Integer} min minutes of date\r\n     * @param {Integer} sec seconds of date\r\n     */\r\n    this.setByDateValue = function(year, month, day, hour, min, sec) {\r\n\tvar dateObject = new Date(Date.UTC(year, month - 1, day, hour, min, sec, 0));\r\n\tthis.setByDate(dateObject);\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractTime, KJUR.asn1.ASN1Object);\r\n// == END   DERAbstractTime ==================================================\r\n\r\n// == BEGIN DERAbstractStructured ============================================\r\n/**\r\n * base class for ASN.1 DER structured class\r\n * @name KJUR.asn1.DERAbstractStructured\r\n * @class base class for ASN.1 DER structured class\r\n * @property {Array} asn1Array internal array of ASN1Object\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERAbstractStructured = function(params) {\r\n    KJUR.asn1.DERAbstractString.superclass.constructor.call(this);\r\n    var asn1Array = null;\r\n\r\n    /**\r\n     * set value by array of ASN1Object\r\n     * @name setByASN1ObjectArray\r\n     * @memberOf KJUR.asn1.DERAbstractStructured\r\n     * @function\r\n     * @param {array} asn1ObjectArray array of ASN1Object to set\r\n     */\r\n    this.setByASN1ObjectArray = function(asn1ObjectArray) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.asn1Array = asn1ObjectArray;\r\n    };\r\n\r\n    /**\r\n     * append an ASN1Object to internal array\r\n     * @name appendASN1Object\r\n     * @memberOf KJUR.asn1.DERAbstractStructured\r\n     * @function\r\n     * @param {ASN1Object} asn1Object to add\r\n     */\r\n    this.appendASN1Object = function(asn1Object) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.asn1Array.push(asn1Object);\r\n    };\r\n\r\n    this.asn1Array = new Array();\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['array'] != \"undefined\") {\r\n\t    this.asn1Array = params['array'];\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERAbstractStructured, KJUR.asn1.ASN1Object);\r\n\r\n\r\n// ********************************************************************\r\n//  ASN.1 Object Classes\r\n// ********************************************************************\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Boolean\r\n * @name KJUR.asn1.DERBoolean\r\n * @class class for ASN.1 DER Boolean\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERBoolean = function() {\r\n    KJUR.asn1.DERBoolean.superclass.constructor.call(this);\r\n    this.hT = \"01\";\r\n    this.hTLV = \"0101ff\";\r\n};\r\nJSX.extend(KJUR.asn1.DERBoolean, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Integer\r\n * @name KJUR.asn1.DERInteger\r\n * @class class for ASN.1 DER Integer\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>int - specify initial ASN.1 value(V) by integer value</li>\r\n * <li>bigint - specify initial ASN.1 value(V) by BigInteger object</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERInteger = function(params) {\r\n    KJUR.asn1.DERInteger.superclass.constructor.call(this);\r\n    this.hT = \"02\";\r\n\r\n    /**\r\n     * set value by Tom Wu's BigInteger object\r\n     * @name setByBigInteger\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {BigInteger} bigIntegerValue to set\r\n     */\r\n    this.setByBigInteger = function(bigIntegerValue) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue);\r\n    };\r\n\r\n    /**\r\n     * set value by integer value\r\n     * @name setByInteger\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {Integer} integer value to set\r\n     */\r\n    this.setByInteger = function(intValue) {\r\n\tvar bi = new BigInteger(String(intValue), 10);\r\n\tthis.setByBigInteger(bi);\r\n    };\r\n\r\n    /**\r\n     * set value by integer value\r\n     * @name setValueHex\r\n     * @memberOf KJUR.asn1.DERInteger\r\n     * @function\r\n     * @param {String} hexadecimal string of integer value\r\n     * @description\r\n     * <br/>\r\n     * NOTE: Value shall be represented by minimum octet length of\r\n     * two's complement representation.\r\n     */\r\n    this.setValueHex = function(newHexString) {\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['bigint'] != \"undefined\") {\r\n\t    this.setByBigInteger(params['bigint']);\r\n\t} else if (typeof params['int'] != \"undefined\") {\r\n\t    this.setByInteger(params['int']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setValueHex(params['hex']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERInteger, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER encoded BitString primitive\r\n * @name KJUR.asn1.DERBitString\r\n * @class class for ASN.1 DER encoded BitString primitive\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description \r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>bin - specify binary string (ex. '10111')</li>\r\n * <li>array - specify array of boolean (ex. [true,false,true,true])</li>\r\n * <li>hex - specify hexadecimal string of ASN.1 value(V) including unused bits</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERBitString = function(params) {\r\n    KJUR.asn1.DERBitString.superclass.constructor.call(this);\r\n    this.hT = \"03\";\r\n\r\n    /**\r\n     * set ASN.1 value(V) by a hexadecimal string including unused bits\r\n     * @name setHexValueIncludingUnusedBits\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {String} newHexStringIncludingUnusedBits\r\n     */\r\n    this.setHexValueIncludingUnusedBits = function(newHexStringIncludingUnusedBits) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = newHexStringIncludingUnusedBits;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 value(V) by unused bit and hexadecimal string of value\r\n     * @name setUnusedBitsAndHexValue\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {Integer} unusedBits\r\n     * @param {String} hValue\r\n     */\r\n    this.setUnusedBitsAndHexValue = function(unusedBits, hValue) {\r\n\tif (unusedBits < 0 || 7 < unusedBits) {\r\n\t    throw \"unused bits shall be from 0 to 7: u = \" + unusedBits;\r\n\t}\r\n\tvar hUnusedBits = \"0\" + unusedBits;\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = hUnusedBits + hValue;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 DER BitString by binary string\r\n     * @name setByBinaryString\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {String} binaryString binary value string (i.e. '10111')\r\n     * @description\r\n     * Its unused bits will be calculated automatically by length of \r\n     * 'binaryValue'. <br/>\r\n     * NOTE: Trailing zeros '0' will be ignored.\r\n     */\r\n    this.setByBinaryString = function(binaryString) {\r\n\tbinaryString = binaryString.replace(/0+$/, '');\r\n\tvar unusedBits = 8 - binaryString.length % 8;\r\n\tif (unusedBits == 8) unusedBits = 0;\r\n\tfor (var i = 0; i <= unusedBits; i++) {\r\n\t    binaryString += '0';\r\n\t}\r\n\tvar h = '';\r\n\tfor (var i = 0; i < binaryString.length - 1; i += 8) {\r\n\t    var b = binaryString.substr(i, 8);\r\n\t    var x = parseInt(b, 2).toString(16);\r\n\t    if (x.length == 1) x = '0' + x;\r\n\t    h += x;  \r\n\t}\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.hV = '0' + unusedBits + h;\r\n    };\r\n\r\n    /**\r\n     * set ASN.1 TLV value(V) by an array of boolean\r\n     * @name setByBooleanArray\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {array} booleanArray array of boolean (ex. [true, false, true])\r\n     * @description\r\n     * NOTE: Trailing falses will be ignored.\r\n     */\r\n    this.setByBooleanArray = function(booleanArray) {\r\n\tvar s = '';\r\n\tfor (var i = 0; i < booleanArray.length; i++) {\r\n\t    if (booleanArray[i] == true) {\r\n\t\ts += '1';\r\n\t    } else {\r\n\t\ts += '0';\r\n\t    }\r\n\t}\r\n\tthis.setByBinaryString(s);\r\n    };\r\n\r\n    /**\r\n     * generate an array of false with specified length\r\n     * @name newFalseArray\r\n     * @memberOf KJUR.asn1.DERBitString\r\n     * @function\r\n     * @param {Integer} nLength length of array to generate\r\n     * @return {array} array of boolean faluse\r\n     * @description\r\n     * This static method may be useful to initialize boolean array.\r\n     */\r\n    this.newFalseArray = function(nLength) {\r\n\tvar a = new Array(nLength);\r\n\tfor (var i = 0; i < nLength; i++) {\r\n\t    a[i] = false;\r\n\t}\r\n\treturn a;\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['hex'] != \"undefined\") {\r\n\t    this.setHexValueIncludingUnusedBits(params['hex']);\r\n\t} else if (typeof params['bin'] != \"undefined\") {\r\n\t    this.setByBinaryString(params['bin']);\r\n\t} else if (typeof params['array'] != \"undefined\") {\r\n\t    this.setByBooleanArray(params['array']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERBitString, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER OctetString\r\n * @name KJUR.asn1.DEROctetString\r\n * @class class for ASN.1 DER OctetString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DEROctetString = function(params) {\r\n    KJUR.asn1.DEROctetString.superclass.constructor.call(this, params);\r\n    this.hT = \"04\";\r\n};\r\nJSX.extend(KJUR.asn1.DEROctetString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Null\r\n * @name KJUR.asn1.DERNull\r\n * @class class for ASN.1 DER Null\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * @see KJUR.asn1.ASN1Object - superclass\r\n */\r\nKJUR.asn1.DERNull = function() {\r\n    KJUR.asn1.DERNull.superclass.constructor.call(this);\r\n    this.hT = \"05\";\r\n    this.hTLV = \"0500\";\r\n};\r\nJSX.extend(KJUR.asn1.DERNull, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER ObjectIdentifier\r\n * @name KJUR.asn1.DERObjectIdentifier\r\n * @class class for ASN.1 DER ObjectIdentifier\r\n * @param {Array} params associative array of parameters (ex. {'oid': '2.5.4.5'})\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>oid - specify initial ASN.1 value(V) by a oid string (ex. 2.5.4.13)</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERObjectIdentifier = function(params) {\r\n    var itox = function(i) {\r\n\tvar h = i.toString(16);\r\n\tif (h.length == 1) h = '0' + h;\r\n\treturn h;\r\n    };\r\n    var roidtox = function(roid) {\r\n\tvar h = '';\r\n\tvar bi = new BigInteger(roid, 10);\r\n\tvar b = bi.toString(2);\r\n\tvar padLen = 7 - b.length % 7;\r\n\tif (padLen == 7) padLen = 0;\r\n\tvar bPad = '';\r\n\tfor (var i = 0; i < padLen; i++) bPad += '0';\r\n\tb = bPad + b;\r\n\tfor (var i = 0; i < b.length - 1; i += 7) {\r\n\t    var b8 = b.substr(i, 7);\r\n\t    if (i != b.length - 7) b8 = '1' + b8;\r\n\t    h += itox(parseInt(b8, 2));\r\n\t}\r\n\treturn h;\r\n    }\r\n\r\n    KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this);\r\n    this.hT = \"06\";\r\n\r\n    /**\r\n     * set value by a hexadecimal string\r\n     * @name setValueHex\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} newHexString hexadecimal value of OID bytes\r\n     */\r\n    this.setValueHex = function(newHexString) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = newHexString;\r\n    };\r\n\r\n    /**\r\n     * set value by a OID string\r\n     * @name setValueOidString\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} oidString OID string (ex. 2.5.4.13)\r\n     */\r\n    this.setValueOidString = function(oidString) {\r\n\tif (! oidString.match(/^[0-9.]+$/)) {\r\n\t    throw \"malformed oid string: \" + oidString;\r\n\t}\r\n\tvar h = '';\r\n\tvar a = oidString.split('.');\r\n\tvar i0 = parseInt(a[0]) * 40 + parseInt(a[1]);\r\n\th += itox(i0);\r\n\ta.splice(0, 2);\r\n\tfor (var i = 0; i < a.length; i++) {\r\n\t    h += roidtox(a[i]);\r\n\t}\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.s = null;\r\n\tthis.hV = h;\r\n    };\r\n\r\n    /**\r\n     * set value by a OID name\r\n     * @name setValueName\r\n     * @memberOf KJUR.asn1.DERObjectIdentifier\r\n     * @function\r\n     * @param {String} oidName OID name (ex. 'serverAuth')\r\n     * @since 1.0.1\r\n     * @description\r\n     * OID name shall be defined in 'KJUR.asn1.x509.OID.name2oidList'.\r\n     * Otherwise raise error.\r\n     */\r\n    this.setValueName = function(oidName) {\r\n\tif (typeof KJUR.asn1.x509.OID.name2oidList[oidName] != \"undefined\") {\r\n\t    var oid = KJUR.asn1.x509.OID.name2oidList[oidName];\r\n\t    this.setValueOidString(oid);\r\n\t} else {\r\n\t    throw \"DERObjectIdentifier oidName undefined: \" + oidName;\r\n\t}\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['oid'] != \"undefined\") {\r\n\t    this.setValueOidString(params['oid']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setValueHex(params['hex']);\r\n\t} else if (typeof params['name'] != \"undefined\") {\r\n\t    this.setValueName(params['name']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERObjectIdentifier, KJUR.asn1.ASN1Object);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER UTF8String\r\n * @name KJUR.asn1.DERUTF8String\r\n * @class class for ASN.1 DER UTF8String\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERUTF8String = function(params) {\r\n    KJUR.asn1.DERUTF8String.superclass.constructor.call(this, params);\r\n    this.hT = \"0c\";\r\n};\r\nJSX.extend(KJUR.asn1.DERUTF8String, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER NumericString\r\n * @name KJUR.asn1.DERNumericString\r\n * @class class for ASN.1 DER NumericString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERNumericString = function(params) {\r\n    KJUR.asn1.DERNumericString.superclass.constructor.call(this, params);\r\n    this.hT = \"12\";\r\n};\r\nJSX.extend(KJUR.asn1.DERNumericString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER PrintableString\r\n * @name KJUR.asn1.DERPrintableString\r\n * @class class for ASN.1 DER PrintableString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERPrintableString = function(params) {\r\n    KJUR.asn1.DERPrintableString.superclass.constructor.call(this, params);\r\n    this.hT = \"13\";\r\n};\r\nJSX.extend(KJUR.asn1.DERPrintableString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER TeletexString\r\n * @name KJUR.asn1.DERTeletexString\r\n * @class class for ASN.1 DER TeletexString\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERTeletexString = function(params) {\r\n    KJUR.asn1.DERTeletexString.superclass.constructor.call(this, params);\r\n    this.hT = \"14\";\r\n};\r\nJSX.extend(KJUR.asn1.DERTeletexString, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER IA5String\r\n * @name KJUR.asn1.DERIA5String\r\n * @class class for ASN.1 DER IA5String\r\n * @param {Array} params associative array of parameters (ex. {'str': 'aaa'})\r\n * @extends KJUR.asn1.DERAbstractString\r\n * @description\r\n * @see KJUR.asn1.DERAbstractString - superclass\r\n */\r\nKJUR.asn1.DERIA5String = function(params) {\r\n    KJUR.asn1.DERIA5String.superclass.constructor.call(this, params);\r\n    this.hT = \"16\";\r\n};\r\nJSX.extend(KJUR.asn1.DERIA5String, KJUR.asn1.DERAbstractString);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER UTCTime\r\n * @name KJUR.asn1.DERUTCTime\r\n * @class class for ASN.1 DER UTCTime\r\n * @param {Array} params associative array of parameters (ex. {'str': '130430235959Z'})\r\n * @extends KJUR.asn1.DERAbstractTime\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string (ex.'130430235959Z')</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * <li>date - specify Date object.</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n * <h4>EXAMPLES</h4>\r\n * @example\r\n * var d1 = new KJUR.asn1.DERUTCTime();\r\n * d1.setString('130430125959Z');\r\n *\r\n * var d2 = new KJUR.asn1.DERUTCTime({'str': '130430125959Z'});\r\n *\r\n * var d3 = new KJUR.asn1.DERUTCTime({'date': new Date(Date.UTC(2015, 0, 31, 0, 0, 0, 0))});\r\n */\r\nKJUR.asn1.DERUTCTime = function(params) {\r\n    KJUR.asn1.DERUTCTime.superclass.constructor.call(this, params);\r\n    this.hT = \"17\";\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDate\r\n     * @memberOf KJUR.asn1.DERUTCTime\r\n     * @function\r\n     * @param {Date} dateObject Date object to set ASN.1 value(V)\r\n     */\r\n    this.setByDate = function(dateObject) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.date = dateObject;\r\n\tthis.s = this.formatDate(this.date, 'utc');\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t} else if (typeof params['date'] != \"undefined\") {\r\n\t    this.setByDate(params['date']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERUTCTime, KJUR.asn1.DERAbstractTime);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER GeneralizedTime\r\n * @name KJUR.asn1.DERGeneralizedTime\r\n * @class class for ASN.1 DER GeneralizedTime\r\n * @param {Array} params associative array of parameters (ex. {'str': '20130430235959Z'})\r\n * @extends KJUR.asn1.DERAbstractTime\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>str - specify initial ASN.1 value(V) by a string (ex.'20130430235959Z')</li>\r\n * <li>hex - specify initial ASN.1 value(V) by a hexadecimal string</li>\r\n * <li>date - specify Date object.</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERGeneralizedTime = function(params) {\r\n    KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this, params);\r\n    this.hT = \"18\";\r\n\r\n    /**\r\n     * set value by a Date object\r\n     * @name setByDate\r\n     * @memberOf KJUR.asn1.DERGeneralizedTime\r\n     * @function\r\n     * @param {Date} dateObject Date object to set ASN.1 value(V)\r\n     * @example\r\n     * When you specify UTC time, use 'Date.UTC' method like this:<br/>\r\n     * var o = new DERUTCTime();\r\n     * var date = new Date(Date.UTC(2015, 0, 31, 23, 59, 59, 0)); #2015JAN31 23:59:59\r\n     * o.setByDate(date);\r\n     */\r\n    this.setByDate = function(dateObject) {\r\n\tthis.hTLV = null;\r\n\tthis.isModified = true;\r\n\tthis.date = dateObject;\r\n\tthis.s = this.formatDate(this.date, 'gen');\r\n\tthis.hV = stohex(this.s);\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['str'] != \"undefined\") {\r\n\t    this.setString(params['str']);\r\n\t} else if (typeof params['hex'] != \"undefined\") {\r\n\t    this.setStringHex(params['hex']);\r\n\t} else if (typeof params['date'] != \"undefined\") {\r\n\t    this.setByDate(params['date']);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERGeneralizedTime, KJUR.asn1.DERAbstractTime);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Sequence\r\n * @name KJUR.asn1.DERSequence\r\n * @class class for ASN.1 DER Sequence\r\n * @extends KJUR.asn1.DERAbstractStructured\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>array - specify array of ASN1Object to set elements of content</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERSequence = function(params) {\r\n    KJUR.asn1.DERSequence.superclass.constructor.call(this, params);\r\n    this.hT = \"30\";\r\n    this.getFreshValueHex = function() {\r\n\tvar h = '';\r\n\tfor (var i = 0; i < this.asn1Array.length; i++) {\r\n\t    var asn1Obj = this.asn1Array[i];\r\n\t    h += asn1Obj.getEncodedHex();\r\n\t}\r\n\tthis.hV = h;\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERSequence, KJUR.asn1.DERAbstractStructured);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER Set\r\n * @name KJUR.asn1.DERSet\r\n * @class class for ASN.1 DER Set\r\n * @extends KJUR.asn1.DERAbstractStructured\r\n * @description\r\n * <br/>\r\n * As for argument 'params' for constructor, you can specify one of\r\n * following properties:\r\n * <ul>\r\n * <li>array - specify array of ASN1Object to set elements of content</li>\r\n * </ul>\r\n * NOTE: 'params' can be omitted.\r\n */\r\nKJUR.asn1.DERSet = function(params) {\r\n    KJUR.asn1.DERSet.superclass.constructor.call(this, params);\r\n    this.hT = \"31\";\r\n    this.getFreshValueHex = function() {\r\n\tvar a = new Array();\r\n\tfor (var i = 0; i < this.asn1Array.length; i++) {\r\n\t    var asn1Obj = this.asn1Array[i];\r\n\t    a.push(asn1Obj.getEncodedHex());\r\n\t}\r\n\ta.sort();\r\n\tthis.hV = a.join('');\r\n\treturn this.hV;\r\n    };\r\n};\r\nJSX.extend(KJUR.asn1.DERSet, KJUR.asn1.DERAbstractStructured);\r\n\r\n// ********************************************************************\r\n/**\r\n * class for ASN.1 DER TaggedObject\r\n * @name KJUR.asn1.DERTaggedObject\r\n * @class class for ASN.1 DER TaggedObject\r\n * @extends KJUR.asn1.ASN1Object\r\n * @description\r\n * <br/>\r\n * Parameter 'tagNoNex' is ASN.1 tag(T) value for this object.\r\n * For example, if you find '[1]' tag in a ASN.1 dump, \r\n * 'tagNoHex' will be 'a1'.\r\n * <br/>\r\n * As for optional argument 'params' for constructor, you can specify *ANY* of\r\n * following properties:\r\n * <ul>\r\n * <li>explicit - specify true if this is explicit tag otherwise false \r\n *     (default is 'true').</li>\r\n * <li>tag - specify tag (default is 'a0' which means [0])</li>\r\n * <li>obj - specify ASN1Object which is tagged</li>\r\n * </ul>\r\n * @example\r\n * d1 = new KJUR.asn1.DERUTF8String({'str':'a'});\r\n * d2 = new KJUR.asn1.DERTaggedObject({'obj': d1});\r\n * hex = d2.getEncodedHex();\r\n */\r\nKJUR.asn1.DERTaggedObject = function(params) {\r\n    KJUR.asn1.DERTaggedObject.superclass.constructor.call(this);\r\n    this.hT = \"a0\";\r\n    this.hV = '';\r\n    this.isExplicit = true;\r\n    this.asn1Object = null;\r\n\r\n    /**\r\n     * set value by an ASN1Object\r\n     * @name setString\r\n     * @memberOf KJUR.asn1.DERTaggedObject\r\n     * @function\r\n     * @param {Boolean} isExplicitFlag flag for explicit/implicit tag\r\n     * @param {Integer} tagNoHex hexadecimal string of ASN.1 tag\r\n     * @param {ASN1Object} asn1Object ASN.1 to encapsulate\r\n     */\r\n    this.setASN1Object = function(isExplicitFlag, tagNoHex, asn1Object) {\r\n\tthis.hT = tagNoHex;\r\n\tthis.isExplicit = isExplicitFlag;\r\n\tthis.asn1Object = asn1Object;\r\n\tif (this.isExplicit) {\r\n\t    this.hV = this.asn1Object.getEncodedHex();\r\n\t    this.hTLV = null;\r\n\t    this.isModified = true;\r\n\t} else {\r\n\t    this.hV = null;\r\n\t    this.hTLV = asn1Object.getEncodedHex();\r\n\t    this.hTLV = this.hTLV.replace(/^../, tagNoHex);\r\n\t    this.isModified = false;\r\n\t}\r\n    };\r\n\r\n    this.getFreshValueHex = function() {\r\n\treturn this.hV;\r\n    };\r\n\r\n    if (typeof params != \"undefined\") {\r\n\tif (typeof params['tag'] != \"undefined\") {\r\n\t    this.hT = params['tag'];\r\n\t}\r\n\tif (typeof params['explicit'] != \"undefined\") {\r\n\t    this.isExplicit = params['explicit'];\r\n\t}\r\n\tif (typeof params['obj'] != \"undefined\") {\r\n\t    this.asn1Object = params['obj'];\r\n\t    this.setASN1Object(this.isExplicit, this.hT, this.asn1Object);\r\n\t}\r\n    }\r\n};\r\nJSX.extend(KJUR.asn1.DERTaggedObject, KJUR.asn1.ASN1Object);","import {int2char} from \"./jsbn\";\r\n\r\nvar b64map=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\nvar b64pad=\"=\";\r\n\r\nexport function hex2b64(h) {\r\n  var i;\r\n  var c;\r\n  var ret = \"\";\r\n  for(i = 0; i+3 <= h.length; i+=3) {\r\n    c = parseInt(h.substring(i,i+3),16);\r\n    ret += b64map.charAt(c >> 6) + b64map.charAt(c & 63);\r\n  }\r\n  if(i+1 == h.length) {\r\n    c = parseInt(h.substring(i,i+1),16);\r\n    ret += b64map.charAt(c << 2);\r\n  }\r\n  else if(i+2 == h.length) {\r\n    c = parseInt(h.substring(i,i+2),16);\r\n    ret += b64map.charAt(c >> 2) + b64map.charAt((c & 3) << 4);\r\n  }\r\n  while((ret.length & 3) > 0) ret += b64pad;\r\n  return ret;\r\n}\r\n\r\n// convert a base64 string to hex\r\nexport function b64tohex(s) {\r\n  var ret = \"\";\r\n  var i;\r\n  var k = 0; // b64 state, 0-3\r\n  var slop;\r\n  for(i = 0; i < s.length; ++i) {\r\n    if(s.charAt(i) == b64pad) break;\r\n    let v = b64map.indexOf(s.charAt(i));\r\n    if(v < 0) continue;\r\n    if(k == 0) {\r\n      ret += int2char(v >> 2);\r\n      slop = v & 3;\r\n      k = 1;\r\n    }\r\n    else if(k == 1) {\r\n      ret += int2char((slop << 2) | (v >> 4));\r\n      slop = v & 0xf;\r\n      k = 2;\r\n    }\r\n    else if(k == 2) {\r\n      ret += int2char(slop);\r\n      ret += int2char(v >> 2);\r\n      slop = v & 3;\r\n      k = 3;\r\n    }\r\n    else {\r\n      ret += int2char((slop << 2) | (v >> 4));\r\n      ret += int2char(v & 0xf);\r\n      k = 0;\r\n    }\r\n  }\r\n  if(k == 1)\r\n    ret += int2char(slop << 2);\r\n  return ret;\r\n}\r\n\r\n// convert a base64 string to a byte/number array\r\nexport function b64toBA(s) {\r\n  //piggyback on b64tohex for now, optimize later\r\n  var h = b64tohex(s);\r\n  var i;\r\n  var a = [];\r\n  for(i = 0; 2*i < h.length; ++i) {\r\n    a[i] = parseInt(h.substring(2*i,2*i+2),16);\r\n  }\r\n  return a;\r\n}\r\n","import {ASN1} from \"../lib/asn1js/asn1\";\r\nimport {RSAKey} from \"../lib/jsbn/rsa2\";\r\nimport {Base64} from \"../lib/asn1js/base64\";\r\nimport {Hex} from \"../lib/asn1js/hex\";\r\nimport {parseBigInt} from \"../lib/jsbn/rsa\";\r\nimport {KJUR} from \"../lib/jsrsasign/asn1-1.0\";\r\nimport {hex2b64} from \"../lib/jsbn/base64\";\r\nimport {b64tohex} from \"../lib/jsbn/base64\";\r\n/**\r\n * Retrieve the hexadecimal value (as a string) of the current ASN.1 element\r\n * @returns {string}\r\n * @public\r\n */\r\nASN1.prototype.getHexStringValue = function () {\r\n  var hexString = this.toHexString();\r\n  var offset = this.header * 2;\r\n  var length = this.length * 2;\r\n  return hexString.substr(offset, length);\r\n};\r\n\r\n/**\r\n * Method to parse a pem encoded string containing both a public or private key.\r\n * The method will translate the pem encoded string in a der encoded string and\r\n * will parse private key and public key parameters. This method accepts public key\r\n * in the rsaencryption pkcs #1 format (oid: 1.2.840.113549.1.1.1).\r\n *\r\n * @todo Check how many rsa formats use the same format of pkcs #1.\r\n *\r\n * The format is defined as:\r\n * PublicKeyInfo ::= SEQUENCE {\r\n *   algorithm       AlgorithmIdentifier,\r\n *   PublicKey       BIT STRING\r\n * }\r\n * Where AlgorithmIdentifier is:\r\n * AlgorithmIdentifier ::= SEQUENCE {\r\n *   algorithm       OBJECT IDENTIFIER,     the OID of the enc algorithm\r\n *   parameters      ANY DEFINED BY algorithm OPTIONAL (NULL for PKCS #1)\r\n * }\r\n * and PublicKey is a SEQUENCE encapsulated in a BIT STRING\r\n * RSAPublicKey ::= SEQUENCE {\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER   -- e\r\n * }\r\n * it's possible to examine the structure of the keys obtained from openssl using\r\n * an asn.1 dumper as the one used here to parse the components: http://lapo.it/asn1js/\r\n * @argument {string} pem the pem encoded string, can include the BEGIN/END header/footer\r\n * @private\r\n */\r\nRSAKey.prototype.parseKey = function (pem) {\r\n  try {\r\n    var modulus = 0;\r\n    var public_exponent = 0;\r\n    var reHex = /^\\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\\s*)+$/;\r\n    var der = reHex.test(pem) ? Hex.decode(pem) : Base64.unarmor(pem);\r\n    var asn1 = ASN1.decode(der);\r\n\r\n    //Fixes a bug with OpenSSL 1.0+ private keys\r\n    if(asn1.sub.length === 3){\r\n        asn1 = asn1.sub[2].sub[0];\r\n    }\r\n    if (asn1.sub.length === 9) {\r\n\r\n      // Parse the private key.\r\n      modulus = asn1.sub[1].getHexStringValue(); //bigint\r\n      this.n = parseBigInt(modulus, 16);\r\n\r\n      public_exponent = asn1.sub[2].getHexStringValue(); //int\r\n      this.e = parseInt(public_exponent, 16);\r\n\r\n      var private_exponent = asn1.sub[3].getHexStringValue(); //bigint\r\n      this.d = parseBigInt(private_exponent, 16);\r\n\r\n      var prime1 = asn1.sub[4].getHexStringValue(); //bigint\r\n      this.p = parseBigInt(prime1, 16);\r\n\r\n      var prime2 = asn1.sub[5].getHexStringValue(); //bigint\r\n      this.q = parseBigInt(prime2, 16);\r\n\r\n      var exponent1 = asn1.sub[6].getHexStringValue(); //bigint\r\n      this.dmp1 = parseBigInt(exponent1, 16);\r\n\r\n      var exponent2 = asn1.sub[7].getHexStringValue(); //bigint\r\n      this.dmq1 = parseBigInt(exponent2, 16);\r\n\r\n      var coefficient = asn1.sub[8].getHexStringValue(); //bigint\r\n      this.coeff = parseBigInt(coefficient, 16);\r\n\r\n    }\r\n    else if (asn1.sub.length === 2) {\r\n\r\n      // Parse the public key.\r\n      var bit_string = asn1.sub[1];\r\n      var sequence = bit_string.sub[0];\r\n\r\n      modulus = sequence.sub[0].getHexStringValue();\r\n      this.n = parseBigInt(modulus, 16);\r\n      public_exponent = sequence.sub[1].getHexStringValue();\r\n      this.e = parseInt(public_exponent, 16);\r\n\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Translate rsa parameters in a hex encoded string representing the rsa key.\r\n *\r\n * The translation follow the ASN.1 notation :\r\n * RSAPrivateKey ::= SEQUENCE {\r\n *   version           Version,\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER,  -- e\r\n *   privateExponent   INTEGER,  -- d\r\n *   prime1            INTEGER,  -- p\r\n *   prime2            INTEGER,  -- q\r\n *   exponent1         INTEGER,  -- d mod (p1)\r\n *   exponent2         INTEGER,  -- d mod (q-1)\r\n *   coefficient       INTEGER,  -- (inverse of q) mod p\r\n * }\r\n * @returns {string}  DER Encoded String representing the rsa private key\r\n * @private\r\n */\r\nRSAKey.prototype.getPrivateBaseKey = function () {\r\n  var options = {\r\n    'array': [\r\n      new KJUR.asn1.DERInteger({'int': 0}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.n}),\r\n      new KJUR.asn1.DERInteger({'int': this.e}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.d}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.p}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.q}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.dmp1}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.dmq1}),\r\n      new KJUR.asn1.DERInteger({'bigint': this.coeff})\r\n    ]\r\n  };\r\n  var seq = new KJUR.asn1.DERSequence(options);\r\n  return seq.getEncodedHex();\r\n};\r\n\r\n/**\r\n * base64 (pem) encoded version of the DER encoded representation\r\n * @returns {string} pem encoded representation without header and footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPrivateBaseKeyB64 = function () {\r\n  return hex2b64(this.getPrivateBaseKey());\r\n};\r\n\r\n/**\r\n * Translate rsa parameters in a hex encoded string representing the rsa public key.\r\n * The representation follow the ASN.1 notation :\r\n * PublicKeyInfo ::= SEQUENCE {\r\n *   algorithm       AlgorithmIdentifier,\r\n *   PublicKey       BIT STRING\r\n * }\r\n * Where AlgorithmIdentifier is:\r\n * AlgorithmIdentifier ::= SEQUENCE {\r\n *   algorithm       OBJECT IDENTIFIER,     the OID of the enc algorithm\r\n *   parameters      ANY DEFINED BY algorithm OPTIONAL (NULL for PKCS #1)\r\n * }\r\n * and PublicKey is a SEQUENCE encapsulated in a BIT STRING\r\n * RSAPublicKey ::= SEQUENCE {\r\n *   modulus           INTEGER,  -- n\r\n *   publicExponent    INTEGER   -- e\r\n * }\r\n * @returns {string} DER Encoded String representing the rsa public key\r\n * @private\r\n */\r\nRSAKey.prototype.getPublicBaseKey = function () {\r\n  var options = {\r\n    'array': [\r\n      new KJUR.asn1.DERObjectIdentifier({'oid': '1.2.840.113549.1.1.1'}), //RSA Encryption pkcs #1 oid\r\n      new KJUR.asn1.DERNull()\r\n    ]\r\n  };\r\n  var first_sequence = new KJUR.asn1.DERSequence(options);\r\n\r\n  options = {\r\n    'array': [\r\n      new KJUR.asn1.DERInteger({'bigint': this.n}),\r\n      new KJUR.asn1.DERInteger({'int': this.e})\r\n    ]\r\n  };\r\n  var second_sequence = new KJUR.asn1.DERSequence(options);\r\n\r\n  options = {\r\n    'hex': '00' + second_sequence.getEncodedHex()\r\n  };\r\n  var bit_string = new KJUR.asn1.DERBitString(options);\r\n\r\n  options = {\r\n    'array': [\r\n      first_sequence,\r\n      bit_string\r\n    ]\r\n  };\r\n  var seq = new KJUR.asn1.DERSequence(options);\r\n  return seq.getEncodedHex();\r\n};\r\n\r\n/**\r\n * base64 (pem) encoded version of the DER encoded representation\r\n * @returns {string} pem encoded representation without header and footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPublicBaseKeyB64 = function () {\r\n  return hex2b64(this.getPublicBaseKey());\r\n};\r\n\r\n/**\r\n * wrap the string in block of width chars. The default value for rsa keys is 64\r\n * characters.\r\n * @param {string} str the pem encoded string without header and footer\r\n * @param {Number} [width=64] - the length the string has to be wrapped at\r\n * @returns {string}\r\n * @private\r\n */\r\nRSAKey.prototype.wordwrap = function (str, width) {\r\n  width = width || 64;\r\n  if (!str) {\r\n    return str;\r\n  }\r\n  var regex = '(.{1,' + width + '})( +|$\\n?)|(.{1,' + width + '})';\r\n  return str.match(RegExp(regex, 'g')).join('\\n');\r\n};\r\n\r\n/**\r\n * Retrieve the pem encoded private key\r\n * @returns {string} the pem encoded private key with header/footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPrivateKey = function () {\r\n  var key = \"-----BEGIN RSA PRIVATE KEY-----\\n\";\r\n  key += this.wordwrap(this.getPrivateBaseKeyB64()) + \"\\n\";\r\n  key += \"-----END RSA PRIVATE KEY-----\";\r\n  return key;\r\n};\r\n\r\n/**\r\n * Retrieve the pem encoded public key\r\n * @returns {string} the pem encoded public key with header/footer\r\n * @public\r\n */\r\nRSAKey.prototype.getPublicKey = function () {\r\n  var key = \"-----BEGIN PUBLIC KEY-----\\n\";\r\n  key += this.wordwrap(this.getPublicBaseKeyB64()) + \"\\n\";\r\n  key += \"-----END PUBLIC KEY-----\";\r\n  return key;\r\n};\r\n\r\n/**\r\n * Check if the object contains the necessary parameters to populate the rsa modulus\r\n * and public exponent parameters.\r\n * @param {Object} [obj={}] - An object that may contain the two public key\r\n * parameters\r\n * @returns {boolean} true if the object contains both the modulus and the public exponent\r\n * properties (n and e)\r\n * @todo check for types of n and e. N should be a parseable bigInt object, E should\r\n * be a parseable integer number\r\n * @private\r\n */\r\nRSAKey.prototype.hasPublicKeyProperty = function (obj) {\r\n  obj = obj || {};\r\n  return (\r\n    obj.hasOwnProperty('n') &&\r\n    obj.hasOwnProperty('e')\r\n  );\r\n};\r\n\r\n/**\r\n * Check if the object contains ALL the parameters of an RSA key.\r\n * @param {Object} [obj={}] - An object that may contain nine rsa key\r\n * parameters\r\n * @returns {boolean} true if the object contains all the parameters needed\r\n * @todo check for types of the parameters all the parameters but the public exponent\r\n * should be parseable bigint objects, the public exponent should be a parseable integer number\r\n * @private\r\n */\r\nRSAKey.prototype.hasPrivateKeyProperty = function (obj) {\r\n  obj = obj || {};\r\n  return (\r\n    obj.hasOwnProperty('n') &&\r\n    obj.hasOwnProperty('e') &&\r\n    obj.hasOwnProperty('d') &&\r\n    obj.hasOwnProperty('p') &&\r\n    obj.hasOwnProperty('q') &&\r\n    obj.hasOwnProperty('dmp1') &&\r\n    obj.hasOwnProperty('dmq1') &&\r\n    obj.hasOwnProperty('coeff')\r\n  );\r\n};\r\n\r\n/**\r\n * Parse the properties of obj in the current rsa object. Obj should AT LEAST\r\n * include the modulus and public exponent (n, e) parameters.\r\n * @param {Object} obj - the object containing rsa parameters\r\n * @private\r\n */\r\nRSAKey.prototype.parsePropertiesFrom = function (obj) {\r\n  this.n = obj.n;\r\n  this.e = obj.e;\r\n\r\n  if (obj.hasOwnProperty('d')) {\r\n    this.d = obj.d;\r\n    this.p = obj.p;\r\n    this.q = obj.q;\r\n    this.dmp1 = obj.dmp1;\r\n    this.dmq1 = obj.dmq1;\r\n    this.coeff = obj.coeff;\r\n  }\r\n};\r\n\r\n/**\r\n * Create a new JSEncryptRSAKey that extends Tom Wu's RSA key object.\r\n * This object is just a decorator for parsing the key parameter\r\n * @param {string|Object} key - The key in string format, or an object containing\r\n * the parameters needed to build a RSAKey object.\r\n * @constructor\r\n */\r\nclass JSEncryptRSAKey extends RSAKey {\r\n  constructor(key) {\r\n    // Call the super constructor.\r\n    super();\r\n    // If a key key was provided.\r\n    if (key) {\r\n      // If this is a string...\r\n      if (typeof key === 'string') {\r\n        this.parseKey(key);\r\n      }\r\n      else if (\r\n          this.hasPrivateKeyProperty(key) ||\r\n          this.hasPublicKeyProperty(key)\r\n      ) {\r\n        // Set the values for the key.\r\n        this.parsePropertiesFrom(key);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n * @param {Object} [options = {}] - An object to customize JSEncrypt behaviour\r\n * possible parameters are:\r\n * - default_key_size        {number}  default: 1024 the key size in bit\r\n * - default_public_exponent {string}  default: '010001' the hexadecimal representation of the public exponent\r\n * - log                     {boolean} default: false whether log warn/error or not\r\n * @constructor\r\n */\r\nexport class JSEncrypt{\r\n  constructor (options) {\r\n    options = options || {};\r\n    this.default_key_size = parseInt(options.default_key_size) || 1024;\r\n    this.default_public_exponent = options.default_public_exponent || '010001'; //65537 default openssl public exponent for rsa key type\r\n    this.log = options.log || false;\r\n    // The private and public key.\r\n    this.key = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Method to set the rsa key parameter (one method is enough to set both the public\r\n * and the private key, since the private key contains the public key paramenters)\r\n * Log a warning if logs are enabled\r\n * @param {Object|string} key the pem encoded string or an object (with or without header/footer)\r\n * @public\r\n */\r\nJSEncrypt.prototype.setKey = function (key) {\r\n  if (this.log && this.key) {\r\n    console.warn('A key was already set, overriding existing.');\r\n  }\r\n  this.key = new JSEncryptRSAKey(key);\r\n};\r\n\r\n/**\r\n * Proxy method for setKey, for api compatibility\r\n * @see setKey\r\n * @public\r\n */\r\nJSEncrypt.prototype.setPrivateKey = function (privkey) {\r\n  // Create the key.\r\n  this.setKey(privkey);\r\n};\r\n\r\n/**\r\n * Proxy method for setKey, for api compatibility\r\n * @see setKey\r\n * @public\r\n */\r\nJSEncrypt.prototype.setPublicKey = function (pubkey) {\r\n  // Sets the public key.\r\n  this.setKey(pubkey);\r\n};\r\n\r\n/**\r\n * Proxy method for RSAKey object's decrypt, decrypt the string using the private\r\n * components of the rsa key object. Note that if the object was not set will be created\r\n * on the fly (by the getKey method) using the parameters passed in the JSEncrypt constructor\r\n * @param {string} string base64 encoded crypted string to decrypt\r\n * @return {string} the decrypted string\r\n * @public\r\n */\r\nJSEncrypt.prototype.decrypt = function (string) {\r\n  // Return the decrypted string.\r\n  try {\r\n    return this.getKey().decrypt(b64tohex(string));\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Proxy method for RSAKey object's encrypt, encrypt the string using the public\r\n * components of the rsa key object. Note that if the object was not set will be created\r\n * on the fly (by the getKey method) using the parameters passed in the JSEncrypt constructor\r\n * @param {string} string the string to encrypt\r\n * @return {string} the encrypted string encoded in base64\r\n * @public\r\n */\r\nJSEncrypt.prototype.encrypt = function (string) {\r\n  // Return the encrypted string.\r\n  try {\r\n    return hex2b64(this.getKey().encrypt(string));\r\n  }\r\n  catch (ex) {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Getter for the current JSEncryptRSAKey object. If it doesn't exists a new object\r\n * will be created and returned\r\n * @param {callback} [cb] the callback to be called if we want the key to be generated\r\n * in an async fashion\r\n * @returns {JSEncryptRSAKey} the JSEncryptRSAKey object\r\n * @public\r\n */\r\nJSEncrypt.prototype.getKey = function (cb) {\r\n  // Only create new if it does not exist.\r\n  if (!this.key) {\r\n    // Get a new private key.\r\n    this.key = new JSEncryptRSAKey();\r\n    if (cb && {}.toString.call(cb) === '[object Function]') {\r\n      this.key.generateAsync(this.default_key_size, this.default_public_exponent, cb);\r\n      return;\r\n    }\r\n    // Generate the key.\r\n    this.key.generate(this.default_key_size, this.default_public_exponent);\r\n  }\r\n  return this.key;\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the private key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the private key WITH header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPrivateKey = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPrivateKey();\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the private key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the private key WITHOUT header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPrivateKeyB64 = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPrivateBaseKeyB64();\r\n};\r\n\r\n\r\n/**\r\n * Returns the pem encoded representation of the public key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the public key WITH header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPublicKey = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPublicKey();\r\n};\r\n\r\n/**\r\n * Returns the pem encoded representation of the public key\r\n * If the key doesn't exists a new key will be created\r\n * @returns {string} pem encoded representation of the public key WITHOUT header and footer\r\n * @public\r\n */\r\nJSEncrypt.prototype.getPublicKeyB64 = function () {\r\n  // Return the private representation of this key.\r\n  return this.getKey().getPublicBaseKeyB64();\r\n};\r\n\r\n","// export * from 'jsencrypt';\r\nexport * from '../../node_modules/jsencrypt/src/jsencrypt.js';","import {EventEmitter} from \"../deps/bp_event.js\";\r\n\r\nexport class BaseRequest {\r\n    constructor(data) {\r\n        this.data = data;\r\n        this.before = (data)=>{return Promise.resolve(data)};\r\n    }\r\n\r\n    send() {\r\n        return this.before(this.data);\r\n    }\r\n\r\n    before(fn) {\r\n        return Promise.resolve\r\n    }\r\n}\r\n\r\nexport class BaseTransport {\r\n    constructor(endpoint, stream_type, config={}) {\r\n        this.stream_type = stream_type;\r\n        this.endpoint = endpoint;\r\n        this.eventSource = new EventEmitter();\r\n        this.dataQueue = [];\r\n    }\r\n\r\n    static canTransfer(stream_type) {\r\n        return BaseTransport.streamTypes().includes(stream_type);\r\n    }\r\n    \r\n    static streamTypes() {\r\n        return [];\r\n    }\r\n\r\n    destroy() {\r\n        this.eventSource.destroy();\r\n    }\r\n\r\n    connect() {\r\n        // TO be impemented\r\n    }\r\n\r\n    disconnect() {\r\n        // TO be impemented\r\n    }\r\n\r\n    reconnect() {\r\n        return this.disconnect().then(()=>{\r\n            return this.connect();\r\n        });\r\n    }\r\n\r\n    setEndpoint(endpoint) {\r\n        this.endpoint = endpoint;\r\n        return this.reconnect();\r\n    }\r\n\r\n    send(data) {\r\n        // TO be impemented\r\n        // return this.prepare(data).send();\r\n    }\r\n\r\n    prepare(data) {\r\n        // TO be impemented\r\n        // return new Request(data);\r\n    }\r\n\r\n    // onData(type, data) {\r\n    //     this.eventSource.dispatchEvent(type, data);\r\n    // }\r\n}","export const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n\r\nexport const CPU_CORES = 1;//navigator.hardwareConcurrency || 3;","import {getTagged} from '../deps/bp_logger.js';\r\nimport {JSEncrypt} from '../deps/jsencrypt.js';\r\nimport {BaseTransport} from \"../core/base_transport.js\";\r\nimport {CPU_CORES} from \"../core/util/browser.js\";\r\n\r\nconst LOG_TAG = \"transport:ws\";\r\nconst Log = getTagged(LOG_TAG);\r\nconst WORKER_COUNT = CPU_CORES;\r\n\r\nexport default class WebsocketTransport extends BaseTransport {\r\n    constructor(endpoint, stream_type, options={\r\n        socket:`${location.protocol.replace('http', 'ws')}//${location.host}/ws/`,\r\n        workers: 1\r\n    }) {\r\n        super(endpoint, stream_type);\r\n        this.proxies = [];\r\n        this.currentProxy = 0;\r\n        this.workers = 1;\r\n        this.socket_url = options.socket;\r\n        this.ready = this.connect();\r\n    }\r\n\r\n    destroy() {\r\n        return this.disconnect().then(()=>{\r\n            return super.destroy();\r\n        });\r\n\r\n    }\r\n\r\n    static canTransfer(stream_type) {\r\n        return WebsocketTransport.streamTypes().includes(stream_type);\r\n    }\r\n\r\n    static streamTypes() {\r\n        return ['hls', 'rtsp'];\r\n    }\r\n\r\n    connect() {\r\n        return this.disconnect().then(()=>{\r\n            let promises = [];\r\n            // TODO: get mirror list\r\n            for (let i=0; i<this.workers; ++i) {\r\n                let proxy = new WebSocketProxy(this.socket_url, this.endpoint, this.stream_type);\r\n\r\n                proxy.set_disconnect_handler((e)=> {\r\n                    this.eventSource.dispatchEvent('disconnected', {code: e.code, reason: e.reason});\r\n                    // TODO: only reconnect on demand\r\n                    if ([1000, 1006, 1013, 1011].includes(e.code)) {\r\n                        setTimeout(()=> {\r\n                            if (this.ready && this.ready.reject) {\r\n                                this.ready.reject();\r\n                            }\r\n                            this.ready = this.connect();\r\n                        }, 3000);\r\n                    }\r\n                });\r\n\r\n                proxy.set_data_handler((data)=> {\r\n                    this.dataQueue.push(new Uint8Array(data));\r\n                    this.eventSource.dispatchEvent('data');\r\n                });\r\n\r\n                promises.push(proxy.connect().then(()=> {\r\n                    this.eventSource.dispatchEvent('connected');\r\n                }).catch((e)=> {\r\n                    this.eventSource.dispatchEvent('error');\r\n                    throw new Error(e);\r\n                }));\r\n                this.proxies.push(proxy);\r\n            }\r\n            return Promise.all(promises);\r\n        });\r\n    }\r\n\r\n    disconnect() {\r\n        let promises = [];\r\n        for (let i=0; i<this.proxies.length; ++i) {\r\n            promises.push(this.proxies[i].close());\r\n        }\r\n        this.proxies= [];\r\n        if (this.proxies.length) {\r\n            return Promise.all(promises);\r\n        } else {\r\n            return Promise.resolve();\r\n        }\r\n    }\r\n\r\n    socket() {\r\n        return this.proxies[(this.currentProxy++)%this.proxies.length];\r\n    }\r\n\r\n    send(_data, fn) {\r\n        let res = this.socket().send(_data);\r\n        if (fn) {\r\n            fn(res.seq);\r\n        }\r\n        return res.promise;\r\n    }\r\n}\r\n\r\nclass WSPProtocol {\r\n    static get PROTO() {return  'WSP';}\r\n\r\n    static get V1_1() {return '1.1';}\r\n\r\n    static get CMD_INIT() {return 'INIT';}\r\n    static get CMD_JOIN() {return  'JOIN';}\r\n    static get CMD_WRAP() {return  'WRAP';}\r\n\r\n\r\n    constructor(ver){\r\n        this.ver = ver;\r\n    }\r\n\r\n    build(cmd, data, payload=''){\r\n        let data_str='';\r\n        if (!data.seq) {\r\n            data.seq = ++WSPProtocol.seq;\r\n        }\r\n        for (let k in data) {\r\n            data_str += `${k}: ${data[k]}\\r\\n`;\r\n        }\r\n        return `${WSPProtocol.PROTO}/${this.ver} ${cmd}\\r\\n${data_str}\\r\\n${payload}`;\r\n    }\r\n\r\n    static parse(data) {\r\n        let payIdx = data.indexOf('\\r\\n\\r\\n');\r\n        let lines = data.substr(0, payIdx).split('\\r\\n');\r\n        let hdr = lines.shift().match(new RegExp(`${WSPProtocol.PROTO}/${WSPProtocol.V1_1}\\\\s+(\\\\d+)\\\\s+(.+)`));\r\n        if (hdr) {\r\n            let res = {\r\n                code: Number(hdr[1]),\r\n                msg:  hdr[2],\r\n                data: {},\r\n                payload: ''\r\n            };\r\n            while (lines.length) {\r\n                let line = lines.shift();\r\n                if (line) {\r\n                    let [k,v] = line.split(':');\r\n                    res.data[k.trim()] = v.trim();\r\n                } else {\r\n                    break;\r\n                }\r\n            }\r\n            res.payload = data.substr(payIdx+4);\r\n            return res;\r\n        }\r\n        return null;\r\n    }\r\n}\r\nWSPProtocol.seq = 0;\r\n\r\nclass WebSocketProxy {\r\n    static get CHN_CONTROL() {return 'control';}\r\n    static get CHN_DATA() {return  'data';}\r\n\r\n    constructor(wsurl, endpoint, stream_type) {\r\n        this.url = wsurl;\r\n        this.stream_type = stream_type;\r\n        this.endpoint = endpoint;\r\n        this.data_handler = ()=>{};\r\n        this.disconnect_handler = ()=>{};\r\n        this.builder = new WSPProtocol(WSPProtocol.V1_1);\r\n        this.awaitingPromises = {};\r\n        this.seq = 0;\r\n        this.encryptor = new JSEncrypt();\r\n    }\r\n\r\n    set_data_handler(handler) {\r\n        this.data_handler = handler;\r\n    }\r\n\r\n    set_disconnect_handler(handler) {\r\n        this.disconnect_handler = handler;\r\n    }\r\n\r\n    close() {\r\n        Log.log('closing connection');\r\n        return new Promise((resolve)=>{\r\n            this.ctrlChannel.onclose = ()=>{\r\n                if (this.dataChannel) {\r\n                    this.dataChannel.onclose = ()=>{\r\n                        Log.log('closed');\r\n                        resolve();\r\n                    };\r\n                    this.dataChannel.close();\r\n                } else {\r\n                    Log.log('closed');\r\n                    resolve();\r\n                }\r\n            };\r\n            this.ctrlChannel.close();\r\n        });\r\n    }\r\n\r\n    onDisconnect(){\r\n        this.ctrlChannel.onclose=null;\r\n        this.ctrlChannel.close();\r\n        if (this.dataChannel) {\r\n            this.dataChannel.onclose = null;\r\n            this.dataChannel.close();\r\n        }\r\n        this.disconnect_handler(this);\r\n    }\r\n\r\n    initDataChannel(channel_id) {\r\n        return new Promise((resolve, reject)=>{\r\n            this.dataChannel = new WebSocket(this.url, WebSocketProxy.CHN_DATA);\r\n            this.dataChannel.binaryType = 'arraybuffer';\r\n            this.dataChannel.onopen = ()=>{\r\n                let msg = this.builder.build(WSPProtocol.CMD_JOIN, {\r\n                    channel: channel_id\r\n                });\r\n                Log.debug(msg);\r\n                this.dataChannel.send(msg);\r\n            };\r\n            this.dataChannel.onmessage = (ev)=>{\r\n                Log.debug(`[data]\\r\\n${ev.data}`);\r\n                let res = WSPProtocol.parse(ev.data);\r\n                if (!res) {\r\n                    return reject();\r\n                }\r\n\r\n                this.dataChannel.onmessage=(e)=>{\r\n                    // Log.debug('got data');\r\n                    if (this.data_handler) {\r\n                        this.data_handler(e.data);\r\n                    }\r\n                };\r\n                resolve();\r\n            };\r\n            this.dataChannel.onerror = (e)=>{\r\n                Log.error(`[data] ${e.type}`);\r\n                this.dataChannel.close();\r\n            };\r\n            this.dataChannel.onclose = (e)=>{\r\n                Log.error(`[data] ${e.type}. code: ${e.code}, reason: ${e.reason || 'unknown reason'}`);\r\n                this.onDisconnect(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    connect() {\r\n        this.encryptionKey = null;\r\n        return new Promise((resolve, reject)=>{\r\n            this.ctrlChannel = new WebSocket(this.url, WebSocketProxy.CHN_CONTROL);\r\n\r\n            this.connected = false;\r\n\r\n            this.ctrlChannel.onopen = ()=>{\r\n                let headers = {\r\n                    proto: this.stream_type\r\n                };\r\n                if (this.endpoint.socket) {\r\n                    headers.socket = this.endpoint.socket;\r\n                } else {\r\n                    Object.assign(headers, {\r\n                        host:  this.endpoint.host,\r\n                        port:  this.endpoint.port\r\n                    })\r\n                }\r\n                let msg = this.builder.build(WSPProtocol.CMD_INIT, headers);\r\n                Log.debug(msg);\r\n                this.ctrlChannel.send(msg);\r\n            };\r\n\r\n            this.ctrlChannel.onmessage = (ev)=>{\r\n                Log.debug(`[ctrl]\\r\\n${ev.data}`);\r\n\r\n                let res = WSPProtocol.parse(ev.data);\r\n                if (!res) {\r\n                    return reject();\r\n                }\r\n\r\n                if (res.code >= 300) {\r\n                    Log.error(`[ctrl]\\r\\n${res.code}: ${res.msg}`);\r\n                    return reject();\r\n                }\r\n                this.ctrlChannel.onmessage = (e)=> {\r\n                    let res = WSPProtocol.parse(e.data);\r\n                    Log.debug(`[ctrl]\\r\\n${e.data}`);\r\n                    if (res.data.seq in this.awaitingPromises) {\r\n                        if (res.code < 300) {\r\n                            this.awaitingPromises[res.data.seq].resolve(res);\r\n                        } else {\r\n                            this.awaitingPromises[res.data.seq].reject(res);\r\n                        }\r\n                        delete this.awaitingPromises[res.data.seq];\r\n                    }\r\n                };\r\n                this.encryptionKey = res.data.pubkey || null;\r\n                if (this.encryptionKey) {\r\n                    this.encryptor.setPublicKey(this.encryptionKey);\r\n                    // TODO: check errors\r\n                }\r\n                this.initDataChannel(res.data.channel).then(resolve).catch(reject);\r\n            };\r\n\r\n            this.ctrlChannel.onerror = (e)=>{\r\n                Log.error(`[ctrl] ${e.type}`);\r\n                this.ctrlChannel.close();\r\n            };\r\n            this.ctrlChannel.onclose = (e)=>{\r\n                Log.error(`[ctrl] ${e.type}. code: ${e.code} ${e.reason || 'unknown reason'}`);\r\n                this.onDisconnect(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    encrypt(msg) {\r\n        if (this.encryptionKey) {\r\n            let crypted = this.encryptor.encrypt(msg);\r\n            if (crypted === false) {\r\n                throw new Error(\"Encryption failed. Stopping\")\r\n            }\r\n            return crypted;\r\n        }\r\n        return msg;\r\n    }\r\n\r\n    send(payload) {\r\n        if (this.ctrlChannel.readyState != WebSocket.OPEN) {\r\n            this.close();\r\n            // .then(this.connect.bind(this));\r\n            // return;\r\n            throw new Error('disconnected');\r\n        }\r\n        // Log.debug(payload);\r\n        let data = {\r\n            contentLength: payload.length,\r\n            seq: ++WSPProtocol.seq\r\n        };\r\n        return {\r\n            seq:data.seq,\r\n            promise: new Promise((resolve, reject)=>{\r\n                this.awaitingPromises[data.seq] = {resolve, reject};\r\n                let msg = this.builder.build(WSPProtocol.CMD_WRAP, data, payload);\r\n                Log.debug(msg);\r\n                this.ctrlChannel.send(this.encrypt(msg));\r\n            })};\r\n    }\r\n}","import {getTagged} from './deps/bp_logger.js';\r\nimport {Url} from './core/util/url.js';\r\nimport {Remuxer} from './core/remuxer/remuxer.js';\r\nimport DEFAULT_CLIENT from './client/rtsp/client.js';\r\nimport DEFAULT_TRANSPORT from './transport/websocket.js';\r\n\r\nconst Log = getTagged('wsp');\r\n\r\nexport class StreamType {\r\n    static get HLS() {return 'hls';}\r\n    static get RTSP() {return 'rtsp';}\r\n\r\n    static isSupported(type) {\r\n        return [StreamType.HLS, StreamType.RTSP].includes(type);\r\n    }\r\n\r\n    static fromUrl(url) {\r\n        let parsed;\r\n        try {\r\n            parsed = Url.parse(url);\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n        switch (parsed.protocol) {\r\n            case 'rtsp':\r\n                return StreamType.RTSP;\r\n            case 'http':\r\n            case 'https':\r\n                if (url.indexOf('.m3u8')>=0) {\r\n                    return StreamType.HLS;\r\n                } else {\r\n                    return null;\r\n                }\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    static fromMime(mime) {\r\n        switch (mime) {\r\n            case 'application/x-rtsp':\r\n                return StreamType.RTSP;\r\n            case 'application/vnd.apple.mpegurl':\r\n            case 'application/x-mpegurl':\r\n                return StreamType.HLS;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}\r\n\r\nexport class WSPlayer {\r\n\r\n    constructor(node, opts) {\r\n        if (typeof node == typeof '') {\r\n            this.player = document.getElementById(node);\r\n        } else {\r\n            this.player = node;\r\n        }\r\n\r\n        let modules = opts.modules || {\r\n            client: DEFAULT_CLIENT,\r\n            transport: {\r\n                constructor: DEFAULT_TRANSPORT\r\n            }\r\n        };\r\n        this.errorHandler = opts.errorHandler || null;\r\n        this.queryCredentials = opts.queryCredentials || null;\r\n\r\n        this.modules = {};\r\n        for (let module of modules) {\r\n            let transport = module.transport || DEFAULT_TRANSPORT;\r\n            let client = module.client || DEFAULT_CLIENT;\r\n            if (transport.constructor.canTransfer(client.streamType())) {\r\n                this.modules[client.streamType()] = {\r\n                    client: client,\r\n                    transport: transport\r\n                }\r\n            } else {\r\n                Log.warn(`Client stream type ${client.streamType()} is incompatible with transport types [${transport.streamTypes().join(', ')}]. Skip`)\r\n            }\r\n        }\r\n        \r\n        this.type = StreamType.RTSP;\r\n        this.url = null;\r\n        if (opts.url && opts.type) {\r\n            this.url = opts.url;\r\n            this.type = opts.type;\r\n        } else {\r\n            if (!this._checkSource(this.player)) {\r\n                for (let i=0; i<this.player.children.length; ++i) {\r\n                    if (this._checkSource(this.player.children[i])) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            // if (!this.url) {\r\n            //      throw new Error('No playable endpoint found');\r\n            // }\r\n        }\r\n\r\n        if (this.url) {\r\n            this.setSource(this.url, this.type);\r\n        }\r\n\r\n        this.player.addEventListener('play', ()=>{\r\n            if (!this.isPlaying()) {\r\n                this.client.start();\r\n            }\r\n        }, false);\r\n\r\n        this.player.addEventListener('pause', ()=>{\r\n            this.client.stop();\r\n        }, false);\r\n    }\r\n\r\n    // TODO: check native support\r\n\r\n    isPlaying() {\r\n        return !(this.player.paused || this.client.paused);\r\n    }\r\n\r\n    static canPlayWithModules(mimeType, modules) {\r\n\r\n        let filteredModules = {};\r\n        for (let module of modules) {\r\n            let transport = module.transport || DEFAULT_TRANSPORT;\r\n            let client = module.client || DEFAULT_CLIENT;\r\n            if (transport.canTransfer(client.streamType())) {\r\n                filteredModules[client.streamType()] = true;\r\n            }\r\n        }\r\n\r\n        for (let type in filteredModules) {\r\n            if (type == StreamType.fromMime(mimeType)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /// TODO: deprecate it?\r\n    static canPlay(resource) {\r\n        return StreamType.fromMime(resource.type) || StreamType.fromUrl(resource.src);\r\n    }\r\n\r\n    canPlayUrl(src) {\r\n        let type = StreamType.fromUrl(src);\r\n        return (type in this.modules);\r\n    }\r\n\r\n    _checkSource(src) {\r\n        if (!src.dataset['ignore'] && src.src && !this.player.canPlayType(src.type) && (StreamType.fromMime(src.type) || StreamType.fromUrl(src.src))) {\r\n            this.url = src.src;\r\n            this.type = src.type ? StreamType.fromMime(src.type) : StreamType.fromUrl(src.src);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async setSource(url, type) {\r\n        if (this.transport) {\r\n            if (this.client) {\r\n                await this.client.detachTransport();\r\n            }\r\n            await this.transport.destroy();\r\n        }\r\n        try {\r\n            this.endpoint = Url.parse(url);\r\n        } catch (e) {\r\n            return;\r\n        }\r\n        this.url = url;\r\n        let transport = this.modules[type].transport;\r\n        this.transport = new transport.constructor(this.endpoint, this.type, transport.options);\r\n\r\n\r\n        let lastType = this.type;\r\n        this.type = (StreamType.isSupported(type)?type:false) || StreamType.fromMime(type);\r\n        if (!this.type) {\r\n            throw new Error(\"Bad stream type\");\r\n        }\r\n\r\n        if (lastType!=this.type || !this.client) {\r\n            if (this.client) {\r\n                await this.client.destroy();\r\n            }\r\n            let client = this.modules[type].client;\r\n            this.client = new client();\r\n        } else {\r\n            this.client.reset();\r\n        }\r\n\r\n        if (this.queryCredentials) {\r\n            this.client.queryCredentials = this.queryCredentials;\r\n        }\r\n        if (this.remuxer) {\r\n            this.remuxer.destroy();\r\n            this.remuxer = null;\r\n        }\r\n        this.remuxer = new Remuxer(this.player);\r\n        this.remuxer.attachClient(this.client);\r\n\r\n        this.client.attachTransport(this.transport);\r\n        this.client.setSource(this.endpoint);\r\n\r\n        if (this.player.autoplay) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    start() {\r\n        if (this.client) {\r\n            this.client.start().catch((e)=>{\r\n                if (this.errorHandler) {\r\n                    this.errorHandler(e);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        if (this.client) {\r\n            this.client.stop();\r\n        }\r\n    }\r\n\r\n    async destroy() {\r\n        if (this.transport) {\r\n            if (this.client) {\r\n                await this.client.detachTransport();\r\n            }\r\n            await this.transport.destroy();\r\n        }\r\n        if (this.client) {\r\n            await this.client.destroy();\r\n        }\r\n        if (this.remuxer) {\r\n            this.remuxer.destroy();\r\n            this.remuxer = null;\r\n        }\r\n    }\r\n\r\n}\r\n","import {appendByteArray} from '../util/binary.js';\r\n\r\nexport class PESAsm {\r\n\r\n    constructor() {\r\n        this.fragments = [];\r\n        this.pesLength=0;\r\n        this.pesPkt = null;\r\n    }\r\n\r\n    parse(frag) {\r\n\r\n        if (this.extPresent) {\r\n            let ext = this.parseExtension(frag);\r\n            ext.data = frag.subarray(ext.offset);\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    parseHeader() {\r\n        let hdr = this.fragments[0];\r\n        let pesPrefix = (hdr[0] << 16) + (hdr[1] << 8) + hdr[2];\r\n        this.extPresent = ![0xbe, 0xbf].includes(hdr[3]);\r\n        if (pesPrefix === 1) {\r\n            let pesLength = (hdr[4] << 8) + hdr[5];\r\n            if (pesLength) {\r\n                this.pesLength = pesLength;\r\n                this.hasLength = true;\r\n            } else {\r\n                this.hasLength = false;\r\n                this.pesPkt = null;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    static PTSNormalize(value, reference) {\r\n\r\n        let offset;\r\n        if (reference === undefined) {\r\n            return value;\r\n        }\r\n        if (reference < value) {\r\n            // - 2^33\r\n            offset = -8589934592;\r\n        } else {\r\n            // + 2^33\r\n            offset = 8589934592;\r\n        }\r\n        /* PTS is 33bit (from 0 to 2^33 -1)\r\n         if diff between value and reference is bigger than half of the amplitude (2^32) then it means that\r\n         PTS looping occured. fill the gap */\r\n        while (Math.abs(value - reference) > 4294967296) {\r\n            value += offset;\r\n        }\r\n        return value;\r\n    }\r\n\r\n    parseExtension(frag) {\r\n        let  pesFlags, pesPrefix, pesLen, pesHdrLen, pesPts, pesDts, payloadStartOffset;\r\n            pesFlags = frag[1];\r\n            if (pesFlags & 0xC0) {\r\n                /* PES header described here : http://dvd.sourceforge.net/dvdinfo/pes-hdr.html\r\n                 as PTS / DTS is 33 bit we cannot use bitwise operator in JS,\r\n                 as Bitwise operators treat their operands as a sequence of 32 bits */\r\n                pesPts = (frag[3] & 0x0E) * 536870912 +// 1 << 29\r\n                    (frag[4] & 0xFF) * 4194304 +// 1 << 22\r\n                    (frag[5] & 0xFE) * 16384 +// 1 << 14\r\n                    (frag[6] & 0xFF) * 128 +// 1 << 7\r\n                    (frag[7] & 0xFE) / 2;\r\n                // check if greater than 2^32 -1\r\n                if (pesPts > 4294967295) {\r\n                    // decrement 2^33\r\n                    pesPts -= 8589934592;\r\n                }\r\n                if (pesFlags & 0x40) {\r\n                    pesDts = (frag[8] & 0x0E ) * 536870912 +// 1 << 29\r\n                        (frag[9] & 0xFF ) * 4194304 +// 1 << 22\r\n                        (frag[10] & 0xFE ) * 16384 +// 1 << 14\r\n                        (frag[11] & 0xFF ) * 128 +// 1 << 7\r\n                        (frag[12] & 0xFE ) / 2;\r\n                    // check if greater than 2^32 -1\r\n                    if (pesDts > 4294967295) {\r\n                        // decrement 2^33\r\n                        pesDts -= 8589934592;\r\n                    }\r\n                } else {\r\n                    pesDts = pesPts;\r\n                }\r\n\r\n            pesHdrLen = frag[2];\r\n            payloadStartOffset = pesHdrLen + 9;\r\n\r\n            // TODO: normalize pts/dts\r\n            return {offset: payloadStartOffset, pts: pesPts, dts: pesDts};\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    \r\n    feed(frag, shouldParse) {\r\n\r\n        let res = null;\r\n        if (shouldParse && this.fragments.length) {\r\n            if (!this.parseHeader()) {\r\n                throw new Error(\"Invalid PES packet\");\r\n            }\r\n\r\n            let offset = 6;\r\n            let parsed = {};\r\n            if (this.extPresent) {\r\n                // TODO: make sure fragment have necessary length\r\n                parsed = this.parseExtension(this.fragments[0].subarray(6));\r\n                offset = parsed.offset;\r\n            }\r\n            if (!this.pesPkt) {\r\n                this.pesPkt = new Uint8Array(this.pesLength);\r\n            }\r\n\r\n            let poffset = 0;\r\n            while (this.pesLength && this.fragments.length) {\r\n                let data = this.fragments.shift();\r\n                if (offset) {\r\n                    if (data.byteLength < offset) {\r\n                        offset -= data.byteLength;\r\n                        continue;\r\n                    } else {\r\n                        data = data.subarray(offset);\r\n                        this.pesLength -= offset - (this.hasLength?6:0);\r\n                        offset = 0;\r\n                    }\r\n                }\r\n                this.pesPkt.set(data, poffset);\r\n                poffset += data.byteLength;\r\n                this.pesLength -= data.byteLength;\r\n            }\r\n            res = {data:this.pesPkt, pts: parsed.pts, dts: parsed.dts};\r\n        } else {\r\n            this.pesPkt = null;\r\n        }\r\n        this.pesLength += frag.byteLength;\r\n\r\n        if (this.fragments.length && this.fragments[this.fragments.length-1].byteLength < 6) {\r\n            this.fragments[this.fragments.length-1] = appendByteArray(this.fragments[0], frag);\r\n        } else {\r\n            this.fragments.push(frag);\r\n        }\r\n\r\n        return res;\r\n    }\r\n}","import {BitArray} from '../util/binary.js';\r\nimport {PESAsm} from './pes.js';\r\nimport {PayloadType} from '../defs.js';\r\n\r\nexport class PESType {\r\n    static get AAC() {return  0x0f;}  // ISO/IEC 13818-7 ADTS AAC (MPEG-2 lower bit-rate audio)\r\n    static get ID3() {return  0x15;}  // Packetized metadata (ID3)\r\n    static get H264() {return  0x1b;}  // ITU-T Rec. H.264 and ISO/IEC 14496-10 (lower bit-rate video)\r\n}\r\n\r\nexport class TSParser {\r\n    static get PACKET_LENGTH() {return  188;}\r\n\r\n    constructor() {\r\n        this.pmtParsed = false;\r\n        this.pesParserTypes = new Map();\r\n        this.pesParsers = new Map();\r\n        this.pesAsms = {};\r\n        this.ontracks = null;\r\n        this.toSkip = 0;\r\n    }\r\n\r\n    addPesParser(pesType, constructor) {\r\n        this.pesParserTypes.set(pesType, constructor);\r\n    }\r\n\r\n    parse(packet) {\r\n        let bits = new BitArray(packet);\r\n        if (packet[0] === 0x47) {\r\n            bits.skipBits(9);\r\n            let payStart = bits.readBits(1);\r\n            bits.skipBits(1);\r\n            let pid = bits.readBits(13);\r\n            bits.skipBits(2);\r\n            let adaptFlag = bits.readBits(1);\r\n            let payFlag = bits.readBits(1);\r\n            bits.skipBits(4);\r\n            if (adaptFlag) {\r\n                let adaptSize = bits.readBits(8);\r\n                this.toSkip = bits.skipBits(adaptSize*8);\r\n                if (bits.finished()) {\r\n                    return;\r\n                }\r\n            }\r\n            if (!payFlag) return;\r\n\r\n            let payload = packet.subarray(bits.bytepos);//bitSlice(packet, bits.bitpos+bits.bytepos*8);\r\n\r\n            if (this.pmtParsed && this.pesParsers.has(pid)) {\r\n                let pes = this.pesAsms[pid].feed(payload, payStart);\r\n                if (pes) {\r\n                    return this.pesParsers.get(pid).parse(pes);\r\n                }\r\n            } else {\r\n                if (pid === 0) {\r\n                    this.pmtId = this.parsePAT(payload);\r\n                } else if (pid === this.pmtId) {\r\n                    this.parsePMT(payload);\r\n                    this.pmtParsed = true;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    parsePAT(data) {\r\n        let bits = new BitArray(data);\r\n        let ptr = bits.readBits(8);\r\n        bits.skipBits(8*ptr+83);\r\n        return bits.readBits(13);\r\n    }\r\n\r\n    parsePMT(data) {\r\n        let bits = new BitArray(data);\r\n        let ptr = bits.readBits(8);\r\n        bits.skipBits(8*ptr + 8);\r\n        bits.skipBits(6);\r\n        let secLen = bits.readBits(10);\r\n        bits.skipBits(62);\r\n        let pil = bits.readBits(10);\r\n        bits.skipBits(pil*8);\r\n\r\n        let tracks = new Set();\r\n        let readLen = secLen-13-pil;\r\n        while (readLen>0) {\r\n            let pesType = bits.readBits(8);\r\n            bits.skipBits(3);\r\n            let pid = bits.readBits(13);\r\n            bits.skipBits(6);\r\n            let il = bits.readBits(10);\r\n            bits.skipBits(il*8);\r\n            if ([PESType.AAC, PESType.H264].includes(pesType)) {\r\n                if (this.pesParserTypes.has(pesType) && !this.pesParsers.has(pid)) {\r\n                    this.pesParsers.set(pid, new (this.pesParserTypes.get(pesType)));\r\n                    this.pesAsms[pid] = new PESAsm();\r\n                    switch (pesType) {\r\n                        case PESType.H264: tracks.add({type: PayloadType.H264, offset: 0});break;\r\n                        case PESType.AAC: tracks.add({type: PayloadType.AAC, offset: 0});break;\r\n                    }\r\n                }\r\n            }\r\n            readLen -= 5+il;\r\n        }\r\n        // TODO: notify about tracks\r\n        if (this.ontracks) {\r\n            this.ontracks(tracks);\r\n        }\r\n    }\r\n}","import {NALUAsm} from \"../../core/elementary/NALUAsm.js\";\r\nimport {NALU} from \"../../core/elementary/NALU.js\";\r\nimport {appendByteArray} from \"../../core/util/binary.js\";\r\nimport {StreamType, PayloadType} from '../../core/defs.js';\r\n\r\nexport class AVCPES {\r\n    constructor() {\r\n        this.naluasm = new NALUAsm();\r\n        this.lastUnit = null;\r\n    }\r\n\r\n    parse(pes) {\r\n        let array = pes.data;\r\n        let i = 0, len = array.byteLength, value, overflow, state = 0;\r\n        let units = [], lastUnitStart;\r\n        while (i < len) {\r\n            value = array[i++];\r\n            // finding 3 or 4-byte start codes (00 00 01 OR 00 00 00 01)\r\n            switch (state) {\r\n                case 0:\r\n                    if (value === 0) {\r\n                        state = 1;\r\n                    }\r\n                    break;\r\n                case 1:\r\n                    if( value === 0) {\r\n                        state = 2;\r\n                    } else {\r\n                        state = 0;\r\n                    }\r\n                    break;\r\n                case 2:\r\n                case 3:\r\n                    if( value === 0) {\r\n                        state = 3;\r\n                    } else if (value === 1 && i < len) {\r\n                        if (lastUnitStart) {\r\n                            let nalu = this.naluasm.onNALUFragment(array.subarray(lastUnitStart, i - state - 1), pes.dts);\r\n                            if (nalu && (nalu.type() in NALU.TYPES)) {\r\n                                units.push(nalu);\r\n                            }\r\n                        } else {\r\n                            // If NAL units are not starting right at the beginning of the PES packet, push preceding data into previous NAL unit.\r\n                            overflow  = i - state - 1;\r\n                            if (overflow) {\r\n                                if (this.lastUnit) {\r\n                                    this.lastUnit.data = appendByteArray(this.lastUnit.data.byteLength, array.subarray(0, overflow));\r\n                                }\r\n                            }\r\n                        }\r\n                        lastUnitStart = i;\r\n                        state = 0;\r\n                    } else {\r\n                        state = 0;\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        if (lastUnitStart) {\r\n            let nalu = this.naluasm.onNALUFragment(array.subarray(lastUnitStart, len), pes.dts, pes.pts);\r\n            if (nalu) {\r\n                units.push(nalu);\r\n            }\r\n        }\r\n        this.lastUnit = units[units.length-1];\r\n        return {units: units, type: StreamType.VIDEO, pay: PayloadType.H264};\r\n    }\r\n}","import {BitArray} from '../../core/util/binary.js';\r\nimport {AACParser} from '../../core/parsers/aac.js';\r\n\r\nexport class ADTS {\r\n\r\n    static parseHeader(data) {\r\n        let bits = new BitArray(data);\r\n        bits.skipBits(15);\r\n        let protectionAbs = bits.readBits(1);\r\n        bits.skipBits(14);\r\n        let len = bits.readBits(13);\r\n        bits.skipBits(11);\r\n        let cnt = bits.readBits(2);\r\n        if (!protectionAbs) {\r\n            bits.skipBits(16);\r\n        }\r\n        return {size: len-bits.bytepos, frameCount: cnt, offset: bits.bytepos}\r\n    }\r\n\r\n    static parseHeaderConfig(data) {\r\n        let bits = new BitArray(data);\r\n        bits.skipBits(15);\r\n        let protectionAbs = bits.readBits(1);\r\n        let profile = bits.readBits(2) + 1;\r\n        let freq = bits.readBits(4);\r\n        bits.skipBits(1);\r\n        let channels = bits.readBits(3);\r\n        bits.skipBits(4);\r\n        let len = bits.readBits(13);\r\n        bits.skipBits(11);\r\n        let cnt = bits.readBits(2);\r\n        if (!protectionAbs) {\r\n            bits.skipBits(16);\r\n        }\r\n\r\n        let userAgent = navigator.userAgent.toLowerCase();\r\n        let configLen = 4;\r\n        let extSamplingIdx;\r\n\r\n        // firefox: freq less than 24kHz = AAC SBR (HE-AAC)\r\n        if (userAgent.indexOf('firefox') !== -1) {\r\n            if (freq >= 6) {\r\n                profile = 5;\r\n                configLen = 4;\r\n                // HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies\r\n                // there is a factor 2 between frame sample rate and output sample rate\r\n                // multiply frequency by 2 (see table below, equivalent to substract 3)\r\n                extSamplingIdx = freq - 3;\r\n            } else {\r\n                profile = 2;\r\n                configLen = 2;\r\n                extSamplingIdx = freq;\r\n            }\r\n            // Android : always use AAC\r\n        } else if (userAgent.indexOf('android') !== -1) {\r\n            profile = 2;\r\n            configLen = 2;\r\n            extSamplingIdx = freq;\r\n        } else {\r\n            /*  for other browsers (chrome ...)\r\n             always force audio type to be HE-AAC SBR, as some browsers do not support audio codec switch properly (like Chrome ...)\r\n             */\r\n            profile = 5;\r\n            configLen = 4;\r\n            // if (manifest codec is HE-AAC or HE-AACv2) OR (manifest codec not specified AND frequency less than 24kHz)\r\n            if (freq >= 6) {\r\n                // HE-AAC uses SBR (Spectral Band Replication) , high frequencies are constructed from low frequencies\r\n                // there is a factor 2 between frame sample rate and output sample rate\r\n                // multiply frequency by 2 (see table below, equivalent to substract 3)\r\n                extSamplingIdx = freq - 3;\r\n            } else {\r\n                // if (manifest codec is AAC) AND (frequency less than 24kHz OR nb channel is 1) OR (manifest codec not specified and mono audio)\r\n                // Chrome fails to play back with AAC LC mono when initialized with HE-AAC.  This is not a problem with stereo.\r\n                if (channels === 1) {\r\n                    profile = 2;\r\n                    configLen = 2;\r\n                }\r\n                extSamplingIdx = freq;\r\n            }\r\n        }\r\n\r\n\r\n        let config = new Uint8Array(configLen);\r\n\r\n        config[0] = profile << 3;\r\n        // samplingFrequencyIndex\r\n        config[0] |= (freq & 0x0E) >> 1;\r\n        config[1] |= (freq & 0x01) << 7;\r\n        // channelConfiguration\r\n        config[1] |= channels << 3;\r\n        if (profile === 5) {\r\n            // adtsExtensionSampleingIndex\r\n            config[1] |= (extSamplingIdx & 0x0E) >> 1;\r\n            config[2] = (extSamplingIdx & 0x01) << 7;\r\n            // adtsObjectType (force to 2, chrome is checking that object type is less than 5 ???\r\n            //    https://chromium.googlesource.com/chromium/src.git/+/master/media/formats/mp4/aac.cc\r\n            config[2] |= 2 << 2;\r\n            config[3] = 0;\r\n        }\r\n        return {\r\n            config: {\r\n                config: config,\r\n                codec: `mp4a.40.${profile}`,\r\n                samplerate: AACParser.SampleRates[freq],\r\n                channels: channels,\r\n            },\r\n            size: len-bits.bytepos,\r\n            frameCount: cnt,\r\n            offset: bits.bytepos\r\n        };\r\n    }\r\n}","import {Log} from '../../deps/bp_logger.js';\r\nimport {ADTS} from './adts.js';\r\nimport {StreamType, PayloadType} from '../../core/defs.js';\r\nimport {AACFrame} from '../../core/elementary/AACFrame.js';\r\n\r\nexport class AACPES {\r\n    constructor() {\r\n        this.aacOverFlow = null;\r\n        this.lastAacPTS = null;\r\n        this.track = {};\r\n        this.config = null;\r\n    }\r\n\r\n    parse(pes) {\r\n            let data = pes.data;\r\n            let pts = pes.pts;\r\n            let startOffset = 0;\r\n            let aacOverFlow = this.aacOverFlow;\r\n            let lastAacPTS = this.lastAacPTS;\r\n            var config, frameDuration, frameIndex, offset, stamp, len;\r\n\r\n        if (aacOverFlow) {\r\n            var tmp = new Uint8Array(aacOverFlow.byteLength + data.byteLength);\r\n            tmp.set(aacOverFlow, 0);\r\n            tmp.set(data, aacOverFlow.byteLength);\r\n            Log.debug(`AAC: append overflowing ${aacOverFlow.byteLength} bytes to beginning of new PES`);\r\n            data = tmp;\r\n        }\r\n\r\n        // look for ADTS header (0xFFFx)\r\n        for (offset = startOffset, len = data.length; offset < len - 1; offset++) {\r\n            if ((data[offset] === 0xff) && (data[offset+1] & 0xf0) === 0xf0) {\r\n                break;\r\n            }\r\n        }\r\n        // if ADTS header does not start straight from the beginning of the PES payload, raise an error\r\n        if (offset) {\r\n            var reason, fatal;\r\n            if (offset < len - 1) {\r\n                reason = `AAC PES did not start with ADTS header,offset:${offset}`;\r\n                fatal = false;\r\n            } else {\r\n                reason = 'no ADTS header found in AAC PES';\r\n                fatal = true;\r\n            }\r\n            Log.error(reason);\r\n            if (fatal) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let hdr = null;\r\n        let res = {units:[], type: StreamType.AUDIO, pay: PayloadType.AAC};\r\n        if (!this.config) {\r\n            hdr = ADTS.parseHeaderConfig(data.subarray(offset));\r\n            this.config = hdr.config;\r\n            res.config = hdr.config;\r\n            hdr.config = null;\r\n            Log.debug(`parsed codec:${this.config.codec},rate:${this.config.samplerate},nb channel:${this.config.channels}`);\r\n        }\r\n        frameIndex = 0;\r\n        frameDuration = 1024 * 90000 / this.config.samplerate;\r\n\r\n        // if last AAC frame is overflowing, we should ensure timestamps are contiguous:\r\n        // first sample PTS should be equal to last sample PTS + frameDuration\r\n        if(aacOverFlow && lastAacPTS) {\r\n            var newPTS = lastAacPTS+frameDuration;\r\n            if(Math.abs(newPTS-pts) > 1) {\r\n                Log.debug(`AAC: align PTS for overlapping frames by ${Math.round((newPTS-pts)/90)}`);\r\n                pts=newPTS;\r\n            }\r\n        }\r\n\r\n        while ((offset + 5) < len) {\r\n            if (!hdr) {\r\n                hdr = ADTS.parseHeader(data.subarray(offset));\r\n            }\r\n            if ((hdr.size > 0) && ((offset + hdr.offset + hdr.size) <= len)) {\r\n                stamp = pts + frameIndex * frameDuration;\r\n                res.units.push(new AACFrame(data.subarray(offset + hdr.offset, offset + hdr.offset + hdr.size), stamp));\r\n                offset += hdr.offset + hdr.size;\r\n                frameIndex++;\r\n                // look for ADTS header (0xFFFx)\r\n                for ( ; offset < (len - 1); offset++) {\r\n                    if ((data[offset] === 0xff) && ((data[offset + 1] & 0xf0) === 0xf0)) {\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                break;\r\n            }\r\n            hdr = null;\r\n        }\r\n        if ((offset < len) && (data[offset]==0xff)) {   // TODO: check it\r\n            aacOverFlow = data.subarray(offset, len);\r\n            //logger.log(`AAC: overflow detected:${len-offset}`);\r\n        } else {\r\n            aacOverFlow = null;\r\n        }\r\n        this.aacOverFlow = aacOverFlow;\r\n        this.lastAacPTS = stamp;\r\n\r\n        return res;\r\n    }\r\n}","// adapted from https://github.com/kanongil/node-m3u8parse/blob/master/attrlist.js\r\nclass AttrList {\r\n\r\n    constructor(attrs) {\r\n        if (typeof attrs === 'string') {\r\n            attrs = AttrList.parseAttrList(attrs);\r\n        }\r\n        for(var attr in attrs){\r\n            if(attrs.hasOwnProperty(attr)) {\r\n                this[attr] = attrs[attr];\r\n            }\r\n        }\r\n        this.attrs = attrs;\r\n    }\r\n\r\n    decimalInteger(attrName) {\r\n        const intValue = parseInt(this[attrName], 10);\r\n        if (intValue > Number.MAX_SAFE_INTEGER) {\r\n            return Infinity;\r\n        }\r\n        return intValue;\r\n    }\r\n\r\n    hexadecimalInteger(attrName) {\r\n        if(this[attrName]) {\r\n            let stringValue = (this[attrName] || '0x').slice(2);\r\n            stringValue = ((stringValue.length & 1) ? '0' : '') + stringValue;\r\n\r\n            const value = new Uint8Array(stringValue.length / 2);\r\n            for (let i = 0; i < stringValue.length / 2; i++) {\r\n                value[i] = parseInt(stringValue.slice(i * 2, i * 2 + 2), 16);\r\n            }\r\n            return value;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    hexadecimalIntegerAsNumber(attrName) {\r\n        const intValue = parseInt(this[attrName], 16);\r\n        if (intValue > Number.MAX_SAFE_INTEGER) {\r\n            return Infinity;\r\n        }\r\n        return intValue;\r\n    }\r\n\r\n    decimalFloatingPoint(attrName) {\r\n        return parseFloat(this[attrName]);\r\n    }\r\n\r\n    enumeratedString(attrName) {\r\n        return this[attrName];\r\n    }\r\n\r\n    decimalResolution(attrName) {\r\n        const res = /^(\\d+)x(\\d+)$/.exec(this[attrName]);\r\n        if (res === null) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            width: parseInt(res[1], 10),\r\n            height: parseInt(res[2], 10)\r\n        };\r\n    }\r\n\r\n    static parseAttrList(input) {\r\n        const re = /\\s*(.+?)\\s*=((?:\\\".*?\\\")|.*?)(?:,|$)/g;\r\n        var match, attrs = {};\r\n        while ((match = re.exec(input)) !== null) {\r\n            var value = match[2], quote = '\"';\r\n\r\n            if (value.indexOf(quote) === 0 &&\r\n                value.lastIndexOf(quote) === (value.length-1)) {\r\n                value = value.slice(1, -1);\r\n            }\r\n            attrs[match[1]] = value;\r\n        }\r\n        return attrs;\r\n    }\r\n\r\n}\r\n\r\nexport class M3U8Parser {\r\n    static get TYPE_CHUNK() {return  0;}\r\n    static get TYPE_PLAYLIST() {return  1;}\r\n    // TODO: parse master playlists\r\n    static parse(playlist, baseUrl='') {\r\n        playlist = playlist.replace(/\\r/, '').split('\\n');\r\n        if (playlist.shift().indexOf('#EXTM3U') < 0) {\r\n            throw new Error(\"Bad playlist\");\r\n        }\r\n        let chunkList = [];\r\n        let playlistList = [];\r\n        let expectedUrl = false;\r\n        let cont = {};\r\n        let urlType=null;\r\n        while (playlist.length) {\r\n            let entry = playlist.shift().replace(/\\r/, '');\r\n            if (expectedUrl) {\r\n                if (entry) {\r\n                    cont.url = entry.startsWith('http')?entry:`${baseUrl}/${entry}`;\r\n                    switch (urlType) {\r\n                        case M3U8Parser.TYPE_CHUNK:\r\n                            chunkList.push(cont);\r\n                            break;\r\n                        case M3U8Parser.TYPE_PLAYLIST:\r\n                            playlistList.push(cont);\r\n                            break;\r\n                    }\r\n                    cont={};\r\n                    expectedUrl = false;\r\n                }\r\n            } else {\r\n                if (entry.startsWith('#EXTINF')) {\r\n                    // TODO: it's unsafe\r\n                    cont.duration = Number(entry.split(':')[1].split(',')[0]);\r\n                    urlType = M3U8Parser.TYPE_CHUNK;\r\n                    expectedUrl = true;\r\n                } else if (entry.startsWith('#EXT-X-STREAM-INF')){\r\n                    let props = entry.split(':')[1];\r\n                    let al = new AttrList(props);\r\n                    for (let prop in al.attrs) {\r\n                        cont[prop.toLowerCase()]= al.attrs[prop];\r\n                    }\r\n                    urlType = M3U8Parser.TYPE_PLAYLIST;\r\n                    expectedUrl = true;\r\n                }\r\n            }\r\n        }\r\n        return {chunks: chunkList, playlists: playlistList}\r\n    }\r\n}","import {getTagged} from '../../deps/bp_logger.js';\r\nimport {BaseClient} from '../../core/base_client.js';\r\nimport {TSParser, PESType} from '../../core/parsers/ts.js';\r\nimport {AVCPES} from '../../client/hls/pes_avc.js';\r\nimport {AACPES} from '../../client/hls/pes_aac.js';\r\nimport {StreamType} from '../../core/defs.js';\r\nimport {M3U8Parser} from '../../core/parsers/m3u8.js';\r\nimport {CPU_CORES} from '../../core/util/browser.js';\r\n\r\nconst LOG_TAG = \"client:hls\";\r\nconst Log = getTagged(LOG_TAG);\r\n\r\n\r\nexport default class HLSClient extends BaseClient {\r\n    static get CHUNKS_TO_LOAD() {return  CPU_CORES;}\r\n\r\n    constructor(transport, options) {\r\n        super(transport, options);\r\n\r\n        this.parser = new TSParser();\r\n        this.parser.addPesParser(PESType.H264, AVCPES);\r\n        this.parser.addPesParser(PESType.AAC, AACPES);\r\n        this.parser.ontracks = (tracks)=>{\r\n            let duration = 0;\r\n            for (let chunk of this.chunks) {\r\n                duration+=chunk.duration;\r\n            }\r\n            for (let track of tracks) {\r\n                track.duration = duration;\r\n                this.sampleQueues[track.type]=[];\r\n            }\r\n\r\n            this.eventSource.dispatchEvent('tracks', tracks);\r\n            this.startStreamFlush();\r\n        };\r\n\r\n        this.playlists = [];\r\n        this.chunks = [];\r\n        this.loadedChunks = [];\r\n        this.pendingChunks = new Set();\r\n        this.chunkIdx = 0;\r\n        this.seqMap = new Map();\r\n        this.sampleQueues = {};\r\n        this.chunkSeq = new Map();\r\n\r\n        this.eventSource.addEventListener('needData', this.loadChunks.bind(this, HLSClient.CHUNKS_TO_LOAD));\r\n        this.resume = false;\r\n\r\n        this.parsing = false;\r\n    }\r\n\r\n    static streamType() {\r\n        return 'hls';\r\n    }\r\n\r\n    parse(data) {\r\n        let seq = new DataView(data.buffer, data.byteOffset, 4).getUint32(0);\r\n        // console.log(`data for ${seq}`);\r\n        // console.log('begin parse');\r\n        let offset = 4;\r\n        while (offset < data.byteLength) {\r\n            let parsed = this.parser.parse(data.subarray(offset, offset + TSParser.PACKET_LENGTH));\r\n            if (parsed) {\r\n                if (parsed.config) {\r\n                    this.eventSource.dispatchEvent(`${StreamType.map[parsed.type]}_config`, {\r\n                        config: parsed.config,\r\n                        pay: parsed.pay\r\n                    });\r\n                }\r\n                this.sampleQueues[parsed.type].push(parsed.units);\r\n                this.eventSource.dispatchEvent('samples', {pay: parsed.pay});\r\n            }\r\n            offset += TSParser.PACKET_LENGTH;\r\n        }\r\n        // this.eventSource.dispatchEvent('flush');\r\n        // console.log('end parse');\r\n        this.parsing = false;\r\n        if (this.loadedChunks.length) {\r\n            this.onData(this.loadedChunks.shift());\r\n        }\r\n    }\r\n\r\n    checkSeq(seq, data) {\r\n        seq = Number(seq);\r\n        if (this.seqMap.has(seq)) {\r\n            // parse data\r\n            let cs = this.chunkSeq.get(seq);\r\n            this.pendingChunks.delete(cs.idx);\r\n            this.chunkSeq.delete(seq);\r\n            this.parse(data?data:this.seqMap.get(seq));\r\n            this.seqMap.delete(seq);\r\n            cs.promise.resolve();\r\n        } else {\r\n            this.seqMap.set(seq, data);\r\n        }\r\n    }\r\n\r\n    onData(data) {\r\n        if (this.parsing) {\r\n            this.loadedChunks.push(data);\r\n        } else {\r\n            this.parsing = true;\r\n            let seq = new DataView(data.buffer, data.byteOffset, 4).getUint32(0);\r\n            // TODO: store seq & check if data ready\r\n            this.checkSeq(seq, data);\r\n        }\r\n    }\r\n\r\n    onConnected() {\r\n        super.onConnected();\r\n        Log.debug('HLS connected');\r\n        if (!this.paused) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    onDisconnected() {\r\n        super.onDisconnected();\r\n        Log.debug('HLS disconnected');\r\n        this.parsing = false;\r\n        this.seqMap.clear();\r\n        this.chunkSeq.clear();\r\n        // this.stop();\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        if (this.resume) {\r\n            this.eventSource.dispatchEvent('needData');\r\n        } else {\r\n            this.resume = true;\r\n            this.eventSource.dispatchEvent('clear');\r\n            Log.debug('waiting for transport ready');\r\n            this.transport.ready.then(()=> {\r\n                Log.debug('loading playlist');\r\n                this.loadPlaylist();\r\n            }).catch((e)=>{\r\n                Log.debug('reject transport', e);\r\n            });\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        super.stop();\r\n    }\r\n\r\n    setSource(source) {\r\n        this.resume = false;\r\n        super.setSource(source);\r\n    }\r\n\r\n    send(request, beforeSend) {\r\n        try {\r\n            return this.transport.send(request, beforeSend);\r\n        } catch (e) {\r\n            Log.error(e);\r\n            this.onDisconnected();\r\n            this.transport.connect();\r\n            return Promise.reject();\r\n        }\r\n    }\r\n\r\n    loadPlaylist(playlist=null) {\r\n        let url = playlist?playlist.url:this.sourceUrl;\r\n        this.send(`GET ${url} HTTP/1.1\\r\\nHost: ${this.transport.endpoint.host}\\r\\n\\r\\n`).then((data)=>{\r\n            let entries = data.payload.split('\\r\\n\\r\\n');\r\n            let http = entries[0].split('\\r\\n');\r\n            let status = http[0].match(new RegExp(`HTTP/\\\\d\\\\.\\\\d\\\\s+(\\\\d+)\\\\s+(\\\\w+)`));\r\n            if (!status || status[1]>=400) {\r\n                Log.error('bad playlist response');\r\n                return;\r\n            }\r\n            Log.debug(status);\r\n            let baseUrl = url.substr(0, url.lastIndexOf('/'));\r\n            let playlist = M3U8Parser.parse(entries[1], baseUrl);\r\n            if (playlist.chunks.length) {\r\n                this.chunks = playlist.chunks;\r\n                this.resume = true;\r\n                // Load first chunk to detect initial timestamps\r\n                this.loadChunks(1);\r\n            } else if (playlist.playlists) {\r\n                this.playlists = playlist.playlists;\r\n                // TODO: check playlist support\r\n                this.loadPlaylist(this.playlists[0])\r\n            }\r\n            // this.chunks = entries[1].split('\\n').map((e)=>{e.replace(/\\r/, ''); return e;});\r\n            // this.loadChunk();\r\n        }).catch((e)=>{\r\n            this.resume = false;\r\n        });\r\n    }\r\n\r\n    loadChunk(chunk, idx) {\r\n        return new Promise((resolve, reject)=>{\r\n            this.send(`GET ${chunk.url}?${Math.random()} HTTP/1.1\\r\\nHost: ${this.transport.endpoint.host}\\r\\n\\r\\n`, (seq)=>{\r\n                this.chunkSeq.set(seq, {\r\n                    idx: idx,\r\n                    promise: {resolve, reject}\r\n                });\r\n            }).then((res)=>{\r\n                let lines = res.payload.split('\\r\\n');\r\n                let [version, code, msg] = lines[0].split(' ');\r\n                if (Number(code) >= 300) {\r\n                    throw new Error(`Load error: ${code} ${msg}`);\r\n                }\r\n\r\n                // TODO: store seq & check if data ready\r\n                this.checkSeq(res.data.seq, null);\r\n            });\r\n        });\r\n    }\r\n\r\n    loadChunks(count) {\r\n        if (this.chunkIdx>= this.chunks.length) return;\r\n        let promises = [];\r\n        if (this.pendingChunks.size) {\r\n            Log.debug(`Reload chunks: ${Array.from(this.pendingChunks)}`);\r\n            for (let i of this.pendingChunks) {\r\n                let chunk = this.chunks[i];\r\n                Log.log(`Loading ${chunk.url} (${i+1} of ${this.chunks.length})`);\r\n                promises.push(this.loadChunk(chunk, i));\r\n            }\r\n        } else {\r\n            for (let i = this.chunkIdx; i < this.chunkIdx+count; ++i) {\r\n                let chunk = this.chunks[i];//.shift();\r\n                Log.log(`Loading ${chunk.url} (${i+1} of ${this.chunks.length})`);\r\n                this.pendingChunks.add(i);\r\n\r\n                promises.push(this.loadChunk(chunk, i));\r\n                if (i+1 >= this.chunks.length) return;\r\n            }\r\n        }\r\n        return Promise.all(promises).then(()=>{\r\n            Log.log('chunk loaded');\r\n            // TODO: check queue overflow\r\n            this.chunkIdx+=HLSClient.CHUNKS_TO_LOAD;\r\n            if (!this.paused) {\r\n                this.eventSource.dispatchEvent('needData');\r\n            }\r\n        }).catch((e)=>{\r\n            Log.error(e);\r\n            // this.stop();\r\n        });\r\n    }\r\n}","import videojs from 'video.js';\r\nimport * as streamedian from 'streamedian/player';\r\nimport WebsocketTransport from 'streamedian/transport/websocket';\r\nimport RTSPClient from 'streamedian/client/rtsp/client';\r\nimport HLSClient from 'streamedian/client/hls/client';\r\n\r\nclass StreamedianVideojs{\r\n\r\n    constructor(source, tech, techOptions){\r\n\r\n        var player = videojs.getPlayer(techOptions.playerId);\r\n        this.playerOptions = player.options_;\r\n        this.tech    = tech;\r\n\r\n        this.transport = {\r\n            constructor: WebsocketTransport,\r\n            options: {\r\n                socket: this.playerOptions.rtsp_config.websocket_url\r\n            }\r\n        };\r\n        this.player = new streamedian.WSPlayer(tech.el(), {\r\n            modules: [\r\n                {\r\n                    client: RTSPClient,\r\n                    transport: this.transport\r\n                },\r\n                {\r\n                    client: HLSClient,\r\n                    transport: this.transport\r\n                }\r\n            ]\r\n        });\r\n    }\r\n}\r\n\r\nvar StreamedianSourceHandler = {\r\n    canHandleSource: function (source) {\r\n        return this.canPlayType(source.type);\r\n    },\r\n    handleSource: function (source, tech, options) {\r\n        return new StreamedianVideojs(source, tech, options);\r\n    },\r\n    canPlayType: function (type) {\r\n        var canPlayType = '';\r\n        if (streamedian.WSPlayer.canPlayWithModules(type,[\r\n                {\r\n                    client: RTSPClient,\r\n                    transport: WebsocketTransport\r\n                },\r\n                {\r\n                    client: HLSClient,\r\n                    transport: WebsocketTransport\r\n                }\r\n            ])) {\r\n            canPlayType = 'probably';\r\n        }\r\n        return canPlayType;\r\n    }\r\n};\r\n\r\nvideojs.getTech('Html5').registerSourceHandler(StreamedianSourceHandler, 0);"],"names":["LogLevel","Error","Warn","Log","Debug","DEFAULT_LOG_LEVEL","Logger","level","tag","setLevel","lvl","args","Array","prototype","slice","call","unshift","console","level_map","apply","_log","arguments","taggedLoggers","Map","getTagged","has","set","get","Url","url","ret","regex","result","exec","full","protocol","urlpath","parts","split","basename","pop","basepath","join","loginSplit","hostport","userpass","length","user","pass","host","auth","port","protocolDefaultPort","portDefined","location","socket","undefined","parsed","test","listener","Symbol","listeners","DestructibleEventListener","eventListener","entry","fn","removeEventListener","clear","event","selector","addEventListener","e","target","matches","Set","add","ev","delete","size","dispatchEvent","EventEmitter","element","document","createElement","destroy","on","data","CustomEvent","detail","EventSourceWrapper","eventSource","MP4","types","avc1","avcC","btrt","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","sdtp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","i","hasOwnProperty","charCodeAt","videoHdlr","Uint8Array","audioHdlr","HDLR_TYPES","STTS","STSC","STCO","STSZ","VMHD","SMHD","STSD","majorBrand","avc1Brand","minorVersion","FTYP","box","DINF","type","payload","len","byteLength","timescale","duration","track","sequenceNumber","sn","baseMediaDecodeTime","tracks","boxes","concat","bytes","samples","flags","dependsOn","isDependedOn","hasRedundancy","sps","pps","push","avcc","width","height","configlen","config","audiosamplerate","channelCount","id","volume","sampleDependencyTable","offset","arraylen","array","sample","cts","isLeading","paddingValue","isNonSync","degradPrio","init","movie","LOG_TAG","MSEBuffer","parent","codec","mediaSource","players","cleaning","queue","cleanResolvers","cleanRanges","debug","sourceBuffer","addSourceBuffer","buffered","currentTime","start","resolver","shift","doCleanup","feedNext","readyState","sourceBuffers","removeSourceBuffer","updating","promises","Promise","resolve","reject","remove","end","onupdateend","all","is_live","doAppend","range","removeBound","removeStart","removeEnd","err","error","MSE","ErrorNotes","code","forEach","video","stop","endOfStream","appendBuffer","name","initCleanup","message","codecs","window","MediaSource","isTypeSupported","MediaError","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","playing","map","idx","onplaying","onpause","paused","reset","play","buffers","setLive","pause","values","buffer","then","clearLiveSeekableRange","src","URL","createObjectURL","setupEvents","resolved","mediaReady","_sourceOpen","_sourceEnded","_sourceClose","ready","mimeCodec","feed","track_id","BaseRemuxer","scaleFactor","params","timeOffset","readyToDecode","seq","tsAlign","timestamp","unit","pts","dts","initPTS","initDTS","shouldInitialize","Math","min","unscaled","initialized","mp4track","sampleFunction","setupSample","sort","dtsSortFunc","a","b","AACRemuxer","codecstring","CODEC_AAC","units","nextAacPts","lastPts","firstDTS","firstPTS","getTrackID","fragmented","setConfig","channels","samplerate","MP4_TIMESCALE","expectedSampleDuration","aac","babelHelpers.get","getSize","mp4Sample","lastDTS","nextDts","delta","round","scaled","abs","log","max","getData","ExpGolomb","bytesAvailable","word","bitsAvailable","position","workingBytes","availableBytes","subarray","DataView","byteOffset","getUint32","count","skipBytes","loadWord","bits","valu","logger","readBits","leadingZeroCount","skipLZ","skipBits","clz","readUEG","appendByteArray","buffer1","buffer2","tmp","base64ToArrayBuffer","base64","binary_string","atob","hexToByteArray","hex","bufView","parseInt","substr","bitSlice","bytearray","byteLen","ceil","res","startByte","endByte","bitOffset","nBitOffset","endOffset","tail","BitArray","bitpos","byte","getUint8","bytepos","finished","NALU","nalu","ntype","TYPES","IDR","SEI","SPS","PPS","NDR","nri","sliceType","idata","getNri","header","view","setUint32","setUint8","H264Parser","remuxer","firstFound","readSPS","codecarray","h","toString","parceSliceHeader","isKeyframe","parsePPS","parseSPS","byte_idx","pay_type","pay_size","sz","uuid","from","EOSEQ","EOSTR","decoder","first_mb","slice_type","ppsid","frame_num","readUByte","lastScale","nextScale","deltaScale","j","readEG","frameCropLeftOffset","frameCropRightOffset","frameCropTopOffset","frameCropBottomOffset","sarScale","profileIdc","profileCompat","levelIdc","numRefFramesInPicOrderCntCycle","picWidthInMbsMinus1","picHeightInMapUnitsMinus1","frameMbsOnlyFlag","scalingListCount","skipUEG","chromaFormatIdc","readBoolean","skipScalingList","picOrderCntType","skipEG","sarRatio","aspectRatioIdc","unitsInTick","readUInt","timeScale","fixedFrameRate","frameDuration","H264Remuxer","lastSampleDuration","lastDurations","lastGopDTS","gop","firstUnit","h264","arr","setSPS","warn","setPPS","parseNAL","getPayloadBase","sampleDuration","toMS","avgDuration","reduce","navigator","userAgent","toLowerCase","indexOf","StreamType","VIDEO","AUDIO","PayloadType","H264","AAC","Remuxer","mediaElement","mse","mseEventSource","mse_ready","errorListener","mseClose","bind","closeListener","errorDecodeListener","mseErrorDecode","initSegments","streams","enabled","initMSEHandlers","detachClient","TrackConverters","TrackTimescale","TrackScaleFactor","client","seekable","initmse","initPts","Infinity","initDts","track_type","isSupported","initSegment","initMSE","setCodec","onSamples","Object","keys","pay","getPayload","flush","qidx","sampleQueues","chunk","remux","clientEventSource","samplesListener","audioConfigListener","onTracks","State","stateMachine","transitions","StateMachine","storage","currentState","states","activate","finishTransition","deactivate","state","fromName","toName","ReferenceError","promise","stateName","_promisify","catch","failHandler","SDPParser","version","origin","sessionName","timing","sessionBlock","media","mediaMap","content","dataString","success","currentMediaBlock","line","replace","charAt","_parseVersion","_parseOrigin","_parseSessionName","_parseTiming","rtpmap","_parseMediaDescription","_parseAttribute","match","username","sessionid","sessionversion","nettype","addresstype","unicastaddress","proto","fmt","index","mediaType","pt","m","separator","attribute","mode","Number","control","attrs","toUpperCase","clock","encparams","ptype","string_map","fmtp","param","trim","RTSPStream","rtpChannel","stopKeepAlive","keepaliveInterval","keepaliveTime","forgetRTPChannel","sendSetup","sendTeardown","sdp","getSessionBlock","isAbsolute","contentBase","ctrl","methods","includes","sendRequest","getSetupURL","session","clearInterval","setInterval","sendKeepalive","RTSPError","reconnect","_cmd","_params","assign","getControlURL","RTSPClient","STATE_SETUP","interleaveChannelIndex","interleavedChannels","Date","toUTCString","_data","headers","transport","interleaved","sessionParamsChunks","sessionParams","kv","useRTPChannel","startKeepAlive","safeAdd","x","y","lsw","msw","bitRotateLeft","num","cnt","md5cmn","q","s","t","md5ff","c","d","md5gg","md5hh","md5ii","binlMD5","olda","oldb","oldc","oldd","binl2rstr","input","output","length32","String","fromCharCode","rstr2binl","length8","rstrMD5","rstrHMACMD5","key","bkey","ipad","opad","hash","rstr2hex","hexTab","str2rstrUTF8","unescape","encodeURIComponent","rawMD5","hexMD5","rawHMACMD5","k","hexHMACMD5","md5","string","raw","RTP","pkt","padding","has_extension","csrc","marker","sequence","getUint16","ssrc","csrcs","pktIndex","extension","ehl","header_data","headerLength","padLength","getMediaBlockByPayloadType","RTPFactory","tsOffsets","last","overflow","rtp","tsOffset","RTSPMessage","_rtsp_version","_host","_payload","requestString","lines","body","statusLine","RegExp","lineIdx","v","MessageBuilder","RTSP_1_0","NALUAsm","fragmented_nalu","rawData","nal_start_idx","don","STAP_B","parseNALHeader","getInt8","parseSingleNALUPacket","fu_header","is_start","is_end","payload_type","FU_B","appendData","FU_A","parseFragmentationUnit","STAP_A","parseAggregationPacket","hdr","AACFrame","AACAsm","sizeLength","indexLength","indexDeltaLength","CTSDeltaLength","DTSDeltaLength","RandomAccessIndication","StreamStateIndication","AuxiliaryDataSizeLength","configHeaderLength","auHeadersLengthPadded","ts","getTimestampMS","auHeadersLengthInBits","frames","frameOffset","ctsPresent","dtsPresent","aacData","RTPPayloadParser","h264parser","RTPH264Parser","aacparser","RTPAACParser","parse","naluasm","onNALUFragment","scale","asm","conf","onAACFragment","BaseClient","options","defineProperties","sourceUrl","value","writable","connected","_onData","dataQueue","onData","_onConnect","onConnected","_onDisconnect","onDisconnected","detachTransport","source","endpoint","flushInterval","password","AACParser","bytesOrBits","prof","sfi","SampleRates","parseAudioSpecificConfig","RTSPSession","sessionId","sendPlay","STATE_PLAY","STATE_PLAYING","supports","STATE_PAUSE","STATE_PAUSED","STATE_TEARDOWN","clientSM","RTSPClientSM","ontracks","startStreamFlush","setSource","AuthError","msg","payParser","rtp_channels","sessions","addState","STATE_INITIAL","STATE_OPTIONS","sendOptions","onOptions","STATE_DESCRIBE","sendDescribe","onDescribe","onSetup","STATE_STREAMS","started","transitionTo","addTransition","shouldReconnect","rtpFactory","channel","onRTP","packet","sendPause","authenticator","rtpBuffer","stream","lastTimestamp","method","cSeq","CSeq","USER_AGENT","send","build","_method","response","substring","chunks","ep","queryCredentials","parsedChunks","ha1","realm","ha2","nonce","btoa","getMediaBlockList","getMediaBlock","setupPromise","rtp_info","val","sps_pps","has_config","generic","parseStreamMuxConfig","sessionPromises","hardLimit","ellipsis","DOM","tagName","className","text","str","createTextNode","Stream","enc","pos","hexDigits","hexByte","high_byte","low_byte","parseStringISO","reTime","n","unusedBit","lenBit","skip","ASN1","sub","tagClass","tagConstructed","tagNumber","posContent","reSeemsASCII","parseOctetString","parseInteger","parseBitString","parseOID","parseStringUTF","parseStringBMP","parseTime","typeName","indent","writeln","print","toPrettyString","node","asn1","head","innerHTML","preview","appendChild","oids","oid","w","toDOM","onclick","current","re","hexDump","root","hexNode","onmouseover","onmouseout","selected","fakeHover","fakeOut","toHexDOM_sub","posStart","posEnd","first","toHexDOM","decodeLength","buf","hasContent","p","subTag","subLength","exception","decode","streamStart","expected","write","Arcfour","S","ARC4init","ARC4next","next","prng_newstate","rng_psize","rng_state","rng_pool","rng_pptr","crypto","getRandomValues","z","Uint32Array","onMouseMoveListener","detachEvent","mouseCoordinates","attachEvent","rng_get_byte","random","floor","rng_get_bytes","ba","SecureRandom","nextBytes","dbits","BigInteger","fromNumber","fromString","nbi","am1","am2","xl","xh","l","am3","j_lm","appName","am","DB","DM","DV","BI_FP","FV","pow","F1","F2","BI_RM","BI_RC","rr","vv","int2char","intAt","bnpCopyTo","r","bnpFromInt","nbv","fromInt","bnpFromString","fromRadix","mi","sh","clamp","ZERO","subTo","bnpClamp","bnToString","negate","toRadix","km","bnNegate","bnAbs","bnCompareTo","nbits","bnBitLength","bnpDLShiftTo","bnpDRShiftTo","bnpLShiftTo","bs","cbs","bm","ds","bnpRShiftTo","bnpSubTo","bnpMultiplyTo","bnpSquareTo","bnpDivRemTo","pm","copyTo","ms","nsh","lShiftTo","ys","y0","yt","d1","d2","dlShiftTo","compareTo","ONE","qd","drShiftTo","rShiftTo","bnMod","divRemTo","Classic","cConvert","mod","cRevert","cReduce","cMulTo","multiplyTo","cSqrTo","squareTo","convert","revert","mulTo","sqrTo","bnpInvDigit","Montgomery","mp","invDigit","mpl","mph","um","mt2","montConvert","montRevert","montReduce","u0","montSqrTo","montMulTo","bnpIsEven","bnpExp","r2","g","bnModPowInt","isEven","exp","bitLength","modPowInt","bnClone","bnIntValue","bnByteValue","bnShortValue","bnpChunkSize","LN2","bnSigNum","bnpToRadix","signum","cs","chunkSize","intValue","bnpFromRadix","dMultiply","dAddOffset","bnpFromNumber","testBit","bitwiseTo","shiftLeft","op_or","isProbablePrime","bnToByteArray","bnEquals","bnMin","bnMax","bnpBitwiseTo","op","f","op_and","bnAnd","bnOr","op_xor","bnXor","op_andnot","bnAndNot","bnNot","bnShiftLeft","bnShiftRight","lbit","bnGetLowestSetBit","cbit","bnBitCount","bnTestBit","bnpChangeBit","bnSetBit","changeBit","bnClearBit","bnFlipBit","bnpAddTo","bnAdd","addTo","bnSubtract","bnMultiply","bnSquare","bnDivide","bnRemainder","bnDivideAndRemainder","bnpDMultiply","bnpDAddOffset","NullExp","nNop","nMulTo","nSqrTo","bnPow","bnpMultiplyLowerTo","bnpMultiplyUpperTo","Barrett","q3","mu","divide","barrettConvert","barrettRevert","barrettReduce","multiplyUpperTo","multiplyLowerTo","barrettSqrTo","barrettMulTo","bnModPow","k1","g2","is1","bnGCD","clone","getLowestSetBit","bnpModInt","bnModInverse","ac","u","subtract","lowprimes","lplim","bnIsProbablePrime","modInt","millerRabin","bnpMillerRabin","n1","shiftRight","modPow","byteValue","shortValue","toByteArray","equals","and","or","xor","andNot","not","bitCount","setBit","clearBit","flipBit","multiply","remainder","divideAndRemainder","modInverse","gcd","square","parseBigInt","pkcs1pad2","rng","RSAKey","dmp1","dmq1","coeff","RSASetPublic","N","E","RSADoPublic","RSAEncrypt","doPublic","setPublic","encrypt","pkcs1unpad2","RSASetPrivate","D","RSASetPrivateEx","P","Q","DP","DQ","C","RSAGenerate","B","qs","ee","p1","q1","phi","RSADoPrivate","xp","xq","RSADecrypt","ctext","doPrivate","setPrivate","setPrivateEx","generate","decrypt","Base64","b64","ignore","out","char_count","unarmor","Hex","JSX","env","L","OP","FUNCTION_TOSTRING","ADD","parseUA","agent","numberify","parseFloat","nav","o","ie","opera","gecko","webkit","chrome","mobile","air","iphone","ipod","ios","android","webos","caja","cajaVersion","secure","os","ua","loc","href","isFunction","_IEEnumFix","fname","extend","subc","superc","overrides","F","constructor","superclass","KJUR","ASN1Util","integerToByteHex","bigIntToMinTwosComplementsHex","bigIntegerValue","hPos","xorLen","hMask","biMask","biNeg","getPEMStringFromHex","dataHex","pemHeader","dataWA","CryptoJS","dataB64","stringify","pemBody","ASN1Object","hV","getLengthHexFromValue","hN","hNlen","getEncodedHex","hTLV","isModified","getFreshValueHex","hL","hT","getValueHex","DERAbstractString","getString","setString","newS","stohex","setStringHex","newHexString","DERAbstractTime","localDateToUTC","utc","getTime","getTimezoneOffset","utcDate","formatDate","dateObject","pad","zeroPadding","year","getFullYear","month","getMonth","day","getDate","hour","getHours","getMinutes","sec","getSeconds","setByDateValue","UTC","setByDate","DERAbstractStructured","setByASN1ObjectArray","asn1ObjectArray","asn1Array","appendASN1Object","asn1Object","DERBoolean","DERInteger","setByBigInteger","setByInteger","bi","setValueHex","DERBitString","setHexValueIncludingUnusedBits","newHexStringIncludingUnusedBits","setUnusedBitsAndHexValue","unusedBits","hValue","hUnusedBits","setByBinaryString","binaryString","setByBooleanArray","booleanArray","newFalseArray","nLength","DEROctetString","DERNull","DERObjectIdentifier","itox","roidtox","roid","padLen","bPad","b8","setValueOidString","oidString","i0","splice","setValueName","oidName","x509","OID","name2oidList","DERUTF8String","DERNumericString","DERPrintableString","DERTeletexString","DERIA5String","DERUTCTime","date","DERGeneralizedTime","DERSequence","asn1Obj","DERSet","DERTaggedObject","isExplicit","setASN1Object","isExplicitFlag","tagNoHex","b64map","b64pad","hex2b64","b64tohex","slop","getHexStringValue","hexString","toHexString","parseKey","pem","modulus","public_exponent","reHex","der","private_exponent","prime1","prime2","exponent1","exponent2","coefficient","bit_string","ex","getPrivateBaseKey","getPrivateBaseKeyB64","getPublicBaseKey","first_sequence","second_sequence","getPublicBaseKeyB64","wordwrap","getPrivateKey","getPublicKey","hasPublicKeyProperty","obj","hasPrivateKeyProperty","parsePropertiesFrom","JSEncryptRSAKey","JSEncrypt","default_key_size","default_public_exponent","setKey","setPrivateKey","privkey","setPublicKey","pubkey","getKey","cb","generateAsync","getPrivateKeyB64","getPublicKeyB64","BaseRequest","before","BaseTransport","stream_type","disconnect","connect","streamTypes","isSafari","CPU_CORES","WebsocketTransport","workers","proxies","currentProxy","socket_url","proxy","WebSocketProxy","set_disconnect_handler","reason","setTimeout","set_data_handler","close","WSPProtocol","ver","cmd","data_str","PROTO","payIdx","V1_1","wsurl","data_handler","disconnect_handler","builder","awaitingPromises","encryptor","handler","ctrlChannel","onclose","dataChannel","channel_id","WebSocket","CHN_DATA","binaryType","onopen","CMD_JOIN","onmessage","onerror","onDisconnect","encryptionKey","CHN_CONTROL","CMD_INIT","initDataChannel","crypted","OPEN","contentLength","CMD_WRAP","HLS","RTSP","mime","WSPlayer","opts","player","getElementById","modules","DEFAULT_CLIENT","DEFAULT_TRANSPORT","errorHandler","module","canTransfer","streamType","_checkSource","children","isPlaying","fromUrl","dataset","canPlayType","fromMime","lastType","attachClient","attachTransport","autoplay","mimeType","filteredModules","resource","PESAsm","fragments","pesLength","pesPkt","frag","extPresent","ext","parseExtension","pesPrefix","hasLength","pesFlags","pesHdrLen","pesPts","pesDts","payloadStartOffset","shouldParse","parseHeader","poffset","reference","PESType","TSParser","pmtParsed","pesParserTypes","pesParsers","pesAsms","toSkip","pesType","payStart","pid","adaptFlag","payFlag","adaptSize","pes","pmtId","parsePAT","parsePMT","ptr","secLen","pil","readLen","il","AVCPES","lastUnit","lastUnitStart","ADTS","protectionAbs","frameCount","profile","freq","configLen","extSamplingIdx","AACPES","aacOverFlow","lastAacPTS","startOffset","frameIndex","stamp","fatal","parseHeaderConfig","newPTS","AttrList","parseAttrList","attr","attrName","MAX_SAFE_INTEGER","stringValue","quote","lastIndexOf","M3U8Parser","playlist","baseUrl","chunkList","playlistList","expectedUrl","cont","urlType","startsWith","TYPE_CHUNK","TYPE_PLAYLIST","props","al","prop","playlists","HLSClient","parser","addPesParser","loadedChunks","pendingChunks","chunkIdx","seqMap","chunkSeq","loadChunks","CHUNKS_TO_LOAD","resume","parsing","PACKET_LENGTH","checkSeq","loadPlaylist","request","beforeSend","entries","http","status","loadChunk","StreamedianVideojs","tech","techOptions","videojs","getPlayer","playerId","playerOptions","options_","rtsp_config","websocket_url","streamedian","el","StreamedianSourceHandler","canHandleSource","handleSource","canPlayWithModules","getTech","registerSourceHandler"],"mappings":"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"}